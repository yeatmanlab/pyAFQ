
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/plot_optic_radiations.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_examples_plot_optic_radiations.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_plot_optic_radiations.py:


=============================
Plotting the Optic Radiations
=============================

pyAFQ is designed to be customizable and extensible. This example shows how you
can customize it to define a new bundle based on a definition of waypoint and
endpoint ROIs of your design.

In this case, we add the optic radiations, based on work by Caffara et al. [1]_,
[2]_. The optic radiations (OR) are the primary projection of visual information
from the lateral geniculate nucleus of the thalamus to the primary visual
cortex. Studying the optic radiations with dMRI provides a linkage between white
matter tissue properties, visual perception and behavior, and physiological
responses of the visual cortex to visual stimulation.

We start by importing some of the components that we need for this example and
fixing the random seed for reproducibility

.. GENERATED FROM PYTHON SOURCE LINES 21-35

.. code-block:: default


    import os.path as op
    import plotly
    import numpy as np
    import shutil

    from AFQ.api.group import GroupAFQ
    import AFQ.api.bundle_dict as abd
    import AFQ.data.fetch as afd
    from AFQ.definitions.image import ImageFile, RoiImage
    import AFQ.utils.streamlines as aus
    np.random.seed(1234)









.. GENERATED FROM PYTHON SOURCE LINES 36-43

Get dMRI data
---------------
We will analyze one subject from the Healthy Brain Network Processed Open
Diffusion Derivatives dataset (HBN-POD2) [3]_, [4]_. We'll use a fetcher to
get preprocessed dMRI data for one of the >2,000 subjects in that study. The
data gets organized into a BIDS-compatible format in the `~/AFQ_data/HBN`
folder:

.. GENERATED FROM PYTHON SOURCE LINES 43-46

.. code-block:: default


    study_dir = afd.fetch_hbn_preproc(["NDARAA948VFH"])[1]





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/36 [00:00<?, ?it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_desc-brain_mask.nii.gz:   0%|          | 0/36 [00:00<?, ?it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_desc-preproc_T1w.nii.gz:   3%|2         | 1/36 [00:00<00:03, 10.42it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_desc-preproc_T1w.nii.gz:   6%|5         | 2/36 [00:00<00:16,  2.02it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_dseg.nii.gz:   6%|5         | 2/36 [00:00<00:16,  2.02it/s]                Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_from-MNI152NLin2009cAsym_to-T1w_mode-image_xfm.h5:   8%|8         | 3/36 [00:01<00:16,  2.02it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_from-MNI152NLin2009cAsym_to-T1w_mode-image_xfm.h5:  11%|#1        | 4/36 [00:01<00:12,  2.51it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_from-T1w_to-MNI152NLin2009cAsym_mode-image_xfm.h5:  11%|#1        | 4/36 [00:01<00:12,  2.51it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_from-T1w_to-MNI152NLin2009cAsym_mode-image_xfm.h5:  14%|#3        | 5/36 [00:01<00:11,  2.63it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_label-CSF_probseg.nii.gz:  14%|#3        | 5/36 [00:01<00:11,  2.63it/s]                             Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_label-CSF_probseg.nii.gz:  17%|#6        | 6/36 [00:02<00:09,  3.10it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_label-GM_probseg.nii.gz:  17%|#6        | 6/36 [00:02<00:09,  3.10it/s]     Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_label-WM_probseg.nii.gz:  19%|#9        | 7/36 [00:02<00:09,  3.10it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_label-WM_probseg.nii.gz:  22%|##2       | 8/36 [00:02<00:06,  4.10it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz:  22%|##2       | 8/36 [00:02<00:06,  4.10it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_space-MNI152NLin2009cAsym_desc-preproc_T1w.nii.gz:  25%|##5       | 9/36 [00:02<00:06,  4.10it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_space-MNI152NLin2009cAsym_desc-preproc_T1w.nii.gz:  28%|##7       | 10/36 [00:02<00:04,  5.39it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_space-MNI152NLin2009cAsym_dseg.nii.gz:  28%|##7       | 10/36 [00:02<00:04,  5.39it/s]                Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_space-MNI152NLin2009cAsym_label-CSF_probseg.nii.gz:  31%|###       | 11/36 [00:02<00:04,  5.39it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_space-MNI152NLin2009cAsym_label-CSF_probseg.nii.gz:  33%|###3      | 12/36 [00:02<00:03,  6.57it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_space-MNI152NLin2009cAsym_label-GM_probseg.nii.gz:  33%|###3      | 12/36 [00:02<00:03,  6.57it/s]     Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_space-MNI152NLin2009cAsym_label-GM_probseg.nii.gz:  36%|###6      | 13/36 [00:02<00:03,  6.85it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_space-MNI152NLin2009cAsym_label-WM_probseg.nii.gz:  36%|###6      | 13/36 [00:02<00:03,  6.85it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_space-MNI152NLin2009cAsym_label-WM_probseg.nii.gz:  39%|###8      | 14/36 [00:03<00:03,  7.32it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/figures/sub-NDARAA948VFH_seg_brainmask.svg:  39%|###8      | 14/36 [00:03<00:03,  7.32it/s]                                 Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/figures/sub-NDARAA948VFH_seg_brainmask.svg:  42%|####1     | 15/36 [00:03<00:02,  7.09it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/figures/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_carpetplot.svg:  42%|####1     | 15/36 [00:03<00:02,  7.09it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/figures/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_coreg.svg:  44%|####4     | 16/36 [00:03<00:02,  7.09it/s]         Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/figures/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_coreg.svg:  47%|####7     | 17/36 [00:03<00:01,  9.51it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/figures/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_desc-resampled_b0ref.svg:  47%|####7     | 17/36 [00:03<00:01,  9.51it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/figures/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_desc-sdc_b0.svg:  50%|#####     | 18/36 [00:03<00:01,  9.51it/s]             Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/figures/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_desc-sdc_b0.svg:  53%|#####2    | 19/36 [00:03<00:01, 11.24it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/figures/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_dwi_denoise_ses_HBNsiteRU_acq_64dir_dwi_wf_biascorr.svg:  53%|#####2    | 19/36 [00:03<00:01, 11.24it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/figures/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_dwi_denoise_ses_HBNsiteRU_acq_64dir_dwi_wf_denoising.svg:  56%|#####5    | 20/36 [00:03<00:01, 11.24it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/figures/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_dwi_denoise_ses_HBNsiteRU_acq_64dir_dwi_wf_denoising.svg:  58%|#####8    | 21/36 [00:03<00:01, 10.41it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/figures/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_dwi_denoise_ses_HBNsiteRU_acq_64dir_dwi_wf_unringing.svg:  58%|#####8    | 21/36 [00:03<00:01, 10.41it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/figures/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_sampling_scheme.gif:  61%|######1   | 22/36 [00:03<00:01, 10.41it/s]                                         Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/figures/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_sampling_scheme.gif:  64%|######3   | 23/36 [00:03<00:01, 11.14it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/figures/sub-NDARAA948VFH_t1_2_mni.svg:  64%|######3   | 23/36 [00:03<00:01, 11.14it/s]                                   Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/anat/sub-NDARAA948VFH_ses-HBNsiteRU_acq-HCP_from-orig_to-T1w_mode-image_xfm.txt:  67%|######6   | 24/36 [00:03<00:01, 11.14it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/anat/sub-NDARAA948VFH_ses-HBNsiteRU_acq-HCP_from-orig_to-T1w_mode-image_xfm.txt:  69%|######9   | 25/36 [00:03<00:00, 12.67it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_confounds.tsv:  69%|######9   | 25/36 [00:03<00:00, 12.67it/s]                         Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_desc-ImageQC_dwi.csv:  72%|#######2  | 26/36 [00:04<00:00, 12.67it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_desc-ImageQC_dwi.csv:  75%|#######5  | 27/36 [00:04<00:00, 14.13it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_desc-SliceQC_dwi.json:  75%|#######5  | 27/36 [00:04<00:00, 14.13it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_dwiqc.json:  78%|#######7  | 28/36 [00:04<00:00, 14.13it/s]               Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_dwiqc.json:  81%|########  | 29/36 [00:04<00:00, 11.28it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_space-T1w_desc-brain_mask.nii.gz:  81%|########  | 29/36 [00:04<00:00, 11.28it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_space-T1w_desc-eddy_cnr.nii.gz:  83%|########3 | 30/36 [00:04<00:00, 11.28it/s]      Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_space-T1w_desc-preproc_dwi.b:  86%|########6 | 31/36 [00:04<00:00, 11.28it/s]      Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_space-T1w_desc-preproc_dwi.b:  89%|########8 | 32/36 [00:04<00:00, 14.05it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_space-T1w_desc-preproc_dwi.bval:  89%|########8 | 32/36 [00:04<00:00, 14.05it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_space-T1w_desc-preproc_dwi.bvec:  92%|#########1| 33/36 [00:04<00:00, 14.05it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_space-T1w_desc-preproc_dwi.nii.gz:  94%|#########4| 34/36 [00:04<00:00, 14.05it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_space-T1w_desc-preproc_dwi.nii.gz:  97%|#########7| 35/36 [00:05<00:00,  4.83it/s]    Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_space-T1w_dwiref.nii.gz:  97%|#########7| 35/36 [00:05<00:00,  4.83it/s]              Downloading /home/runner/AFQ_data/HBN/derivatives/qsiprep/sub-NDARAA948VFH/ses-HBNsiteRU/dwi/sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_space-T1w_dwiref.nii.gz: 100%|##########| 36/36 [00:05<00:00,  6.05it/s]




.. GENERATED FROM PYTHON SOURCE LINES 47-57

Define custom `BundleDict` object
--------------------------------
The `BundleDict` object holds information about "include" and "exclude" ROIs,
as well as endpoint ROIS, and whether the bundle crosses the midline. In this
case, the ROIs are all defined in the MNI template space that is used as the
default template space in pyAFQ, but, in principle, other template spaces
could be used.

The ROIs for the case can be downloaded using a custom fetcher and then read
into a dict as follows:

.. GENERATED FROM PYTHON SOURCE LINES 57-88

.. code-block:: default


    or_rois = afd.read_or_templates()

    bundles = abd.BundleDict({
        "L_OR": {
            "include": [
                or_rois["left_OR_1"],
                or_rois["left_OR_2"]],
            "exclude": [
                or_rois["left_OP_MNI"],
                or_rois["left_TP_MNI"],
                or_rois["left_pos_thal_MNI"]],
            "start": or_rois['left_thal_MNI'],
            "end": or_rois['left_V1_MNI'],
            "cross_midline": False,
        },
        "R_OR": {
            "include": [
                or_rois["right_OR_1"],
                or_rois["right_OR_2"]],
            "exclude": [
                or_rois["right_OP_MNI"],
                or_rois["right_TP_MNI"],
                or_rois["right_pos_thal_MNI"]],
            "start": or_rois['right_thal_MNI'],
            "end": or_rois['right_V1_MNI'],
            "cross_midline": False
        }
    })






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/2 [00:00<?, ? MB/s]    100%|##########| 2/2 [00:00<00:00, 4561.51 MB/s]
      0%|          | 0/1 [00:00<?, ? MB/s]    100%|##########| 1/1 [00:00<00:00, 2213.35 MB/s]
      0%|          | 0/2 [00:00<?, ? MB/s]    100%|##########| 2/2 [00:00<00:00, 4573.94 MB/s]
      0%|          | 0/1 [00:00<?, ? MB/s]    100%|##########| 1/1 [00:00<00:00, 2057.04 MB/s]
      0%|          | 0/1 [00:00<?, ? MB/s]    100%|##########| 1/1 [00:00<00:00, 2576.35 MB/s]
      0%|          | 0/19 [00:00<?, ? MB/s]     21%|##1       | 4/19 [00:00<00:00, 28.79 MB/s]     89%|########9 | 17/19 [00:00<00:00, 66.35 MB/s]    100%|##########| 19/19 [00:00<00:00, 67.71 MB/s]
      0%|          | 0/19 [00:00<?, ? MB/s]     21%|##1       | 4/19 [00:00<00:00, 28.37 MB/s]     68%|######8   | 13/19 [00:00<00:00, 54.75 MB/s]    100%|##########| 19/19 [00:00<00:00, 66.87 MB/s]
      0%|          | 0/1 [00:00<?, ? MB/s]    100%|##########| 1/1 [00:00<00:00, 2295.73 MB/s]
      0%|          | 0/1 [00:00<?, ? MB/s]    100%|##########| 1/1 [00:00<00:00, 2259.86 MB/s]
      0%|          | 0/1 [00:00<?, ? MB/s]    100%|##########| 1/1 [00:00<00:00, 2389.92 MB/s]
      0%|          | 0/19 [00:00<?, ? MB/s]     21%|##1       | 4/19 [00:00<00:00, 28.42 MB/s]     79%|#######8  | 15/19 [00:00<00:00, 57.47 MB/s]    100%|##########| 19/19 [00:00<00:00, 67.08 MB/s]
      0%|          | 0/19 [00:00<?, ? MB/s]     21%|##1       | 4/19 [00:00<00:00, 28.41 MB/s]     84%|########4 | 16/19 [00:00<00:00, 61.55 MB/s]    100%|##########| 19/19 [00:00<00:00, 67.01 MB/s]
      0%|          | 0/1 [00:00<?, ? MB/s]    100%|##########| 1/1 [00:00<00:00, 2383.13 MB/s]
      0%|          | 0/1 [00:00<?, ? MB/s]    100%|##########| 1/1 [00:00<00:00, 2414.68 MB/s]
    Downloading https://templateflow.s3.amazonaws.com/tpl-MNI152NLin2009cAsym/tpl-MNI152NLin2009cAsym_res-01_T2w.nii.gz
      0%|          | 0.00/13.3M [00:00<?, ?B/s]     50%|####9     | 6.63M/13.3M [00:00<00:00, 66.3MB/s]    100%|##########| 13.3M/13.3M [00:00<00:00, 76.4MB/s]




.. GENERATED FROM PYTHON SOURCE LINES 89-96

Custom bundle definitions such as the OR, and the standard BundleDict can be
combined through addition. To get both the OR and the standard bundles, we
would execute the following code::

    bundles = bundles + abd.BundleDict()

In this case, we will skip this and generate just the OR.

.. GENERATED FROM PYTHON SOURCE LINES 99-114

Define GroupAFQ object
----------------------
HBN POD2 have been processed with qsiprep [5]_. This means that a brain mask
has already been computer for them. As you can see in other examples, these
data also have a mapping calculated for them, which can also be incorporated
into processing. However, in this case, we will let pyAFQ calculate its own
SyN-based mapping so that the `combine_bundle` method can be used below to
create a montage visualization.

For tractography, we use CSD-based probabilistic tractography seeding
extensively (`n_seeds=4` means 81 seeds per voxel!), but only within the ROIs
and not throughout the white matter. This is controlled by passing
`"seed_mask": RoiImage()` in the `tracking_params` dict. The custom bundles
are passed as `bundle_info=bundles`. The call to `my_afq.export_all()`
initiates the pipeline.

.. GENERATED FROM PYTHON SOURCE LINES 114-134

.. code-block:: default


    brain_mask_definition = ImageFile(
        suffix="mask",
        filters={'desc': 'brain',
                 'space': 'T1w',
                 'scope': 'qsiprep'})

    my_afq = GroupAFQ(
        bids_path=study_dir,
        preproc_pipeline="qsiprep",
        output_dir=op.join(study_dir, "derivatives", "afq_or"),
        brain_mask_definition=brain_mask_definition,
        tracking_params={"n_seeds": 4,
                         "directions": "prob",
                         "odf_model": "CSD",
                         "seed_mask": RoiImage()},
        bundle_info=bundles)

    my_afq.export_all()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    /opt/hostedtoolcache/Python/3.8.15/x64/lib/python3.8/site-packages/bids/layout/validation.py:156: UserWarning:

    The PipelineDescription field was superseded by GeneratedBy in BIDS 1.4.0. You can use ``pybids upgrade`` to update your derivative dataset.

      0%|          | 0/234119.0 [00:00<?, ?it/s]      0%|          | 48/234119.0 [00:00<08:09, 477.75it/s]      0%|          | 346/234119.0 [00:00<02:00, 1937.91it/s]      0%|          | 723/234119.0 [00:00<01:24, 2769.25it/s]      0%|          | 1084/234119.0 [00:00<01:15, 3099.33it/s]      1%|          | 1451/234119.0 [00:00<01:10, 3301.67it/s]      1%|          | 1817/234119.0 [00:00<01:07, 3422.77it/s]      1%|          | 2187/234119.0 [00:00<01:06, 3510.57it/s]      1%|1         | 2559/234119.0 [00:00<01:04, 3575.70it/s]      1%|1         | 2945/234119.0 [00:00<01:03, 3661.90it/s]      1%|1         | 3312/234119.0 [00:01<01:04, 3598.33it/s]      2%|1         | 3683/234119.0 [00:01<01:03, 3631.86it/s]      2%|1         | 4061/234119.0 [00:01<01:02, 3674.36it/s]      2%|1         | 4429/234119.0 [00:01<01:02, 3669.08it/s]      2%|2         | 4797/234119.0 [00:01<01:02, 3658.34it/s]      2%|2         | 5179/234119.0 [00:01<01:01, 3706.26it/s]      2%|2         | 5557/234119.0 [00:01<01:01, 3727.01it/s]      3%|2         | 5934/234119.0 [00:01<01:01, 3739.18it/s]      3%|2         | 6308/234119.0 [00:01<01:01, 3732.88it/s]      3%|2         | 6682/234119.0 [00:01<01:01, 3707.73it/s]      3%|3         | 7055/234119.0 [00:02<01:01, 3711.89it/s]      3%|3         | 7427/234119.0 [00:02<01:01, 3711.12it/s]      3%|3         | 7799/234119.0 [00:02<01:01, 3693.91it/s]      3%|3         | 8188/234119.0 [00:02<01:00, 3751.27it/s]      4%|3         | 8595/234119.0 [00:02<00:58, 3846.00it/s]      4%|3         | 8980/234119.0 [00:02<00:58, 3847.06it/s]      4%|4         | 9365/234119.0 [00:02<00:58, 3837.10it/s]      4%|4         | 9749/234119.0 [00:02<00:58, 3817.31it/s]      4%|4         | 10131/234119.0 [00:02<00:59, 3781.87it/s]      5%|4         | 10536/234119.0 [00:02<00:57, 3860.52it/s]      5%|4         | 10923/234119.0 [00:03<00:58, 3843.54it/s]      5%|4         | 11320/234119.0 [00:03<00:57, 3879.59it/s]      5%|5         | 11716/234119.0 [00:03<00:57, 3901.47it/s]      5%|5         | 12116/234119.0 [00:03<00:56, 3930.62it/s]      5%|5         | 12510/234119.0 [00:03<00:57, 3887.61it/s]      6%|5         | 12921/234119.0 [00:03<00:55, 3951.93it/s]      6%|5         | 13317/234119.0 [00:03<00:55, 3943.90it/s]      6%|5         | 13712/234119.0 [00:03<00:57, 3863.29it/s]      6%|6         | 14111/234119.0 [00:03<00:56, 3898.05it/s]      6%|6         | 14520/234119.0 [00:03<00:55, 3952.56it/s]      6%|6         | 14916/234119.0 [00:04<00:55, 3927.78it/s]      7%|6         | 15320/234119.0 [00:04<00:55, 3960.65it/s]      7%|6         | 15718/234119.0 [00:04<00:55, 3964.83it/s]      7%|6         | 16115/234119.0 [00:04<00:55, 3934.15it/s]      7%|7         | 16514/234119.0 [00:04<00:55, 3948.28it/s]      7%|7         | 16909/234119.0 [00:04<00:55, 3946.54it/s]      7%|7         | 17304/234119.0 [00:04<00:54, 3947.24it/s]      8%|7         | 17699/234119.0 [00:04<00:55, 3894.98it/s]      8%|7         | 18112/234119.0 [00:04<00:54, 3963.81it/s]      8%|7         | 18528/234119.0 [00:04<00:53, 4021.85it/s]      8%|8         | 18934/234119.0 [00:05<00:53, 4032.66it/s]      8%|8         | 19338/234119.0 [00:05<00:53, 4030.06it/s]      8%|8         | 19759/234119.0 [00:05<00:52, 4083.62it/s]      9%|8         | 20168/234119.0 [00:05<00:52, 4058.51it/s]      9%|8         | 20574/234119.0 [00:05<00:53, 4005.31it/s]      9%|8         | 21012/234119.0 [00:05<00:51, 4113.60it/s]      9%|9         | 21436/234119.0 [00:05<00:51, 4148.42it/s]      9%|9         | 21869/234119.0 [00:05<00:50, 4200.59it/s]     10%|9         | 22290/234119.0 [00:05<00:50, 4172.09it/s]     10%|9         | 22722/234119.0 [00:05<00:50, 4215.49it/s]     10%|9         | 23144/234119.0 [00:06<00:50, 4168.48it/s]     10%|#         | 23562/234119.0 [00:06<00:51, 4074.91it/s]     10%|#         | 23980/234119.0 [00:06<00:51, 4105.35it/s]     10%|#         | 24397/234119.0 [00:06<00:50, 4121.55it/s]     11%|#         | 24819/234119.0 [00:06<00:50, 4149.33it/s]     11%|#         | 25243/234119.0 [00:06<00:50, 4174.49it/s]     11%|#         | 25661/234119.0 [00:06<00:50, 4113.60it/s]     11%|#1        | 26073/234119.0 [00:06<00:50, 4104.96it/s]     11%|#1        | 26484/234119.0 [00:06<00:51, 4046.91it/s]     11%|#1        | 26889/234119.0 [00:06<00:51, 4024.86it/s]     12%|#1        | 27314/234119.0 [00:07<00:50, 4089.40it/s]     12%|#1        | 27724/234119.0 [00:07<00:50, 4080.17it/s]     12%|#2        | 28133/234119.0 [00:07<00:51, 4034.48it/s]     12%|#2        | 28537/234119.0 [00:07<00:50, 4033.78it/s]     12%|#2        | 28941/234119.0 [00:07<00:51, 4017.58it/s]     13%|#2        | 29365/234119.0 [00:07<00:50, 4081.37it/s]     13%|#2        | 29782/234119.0 [00:07<00:49, 4105.66it/s]     13%|#2        | 30193/234119.0 [00:07<00:50, 4054.92it/s]     13%|#3        | 30599/234119.0 [00:07<00:50, 4038.22it/s]     13%|#3        | 31016/234119.0 [00:07<00:49, 4074.79it/s]     13%|#3        | 31449/234119.0 [00:08<00:48, 4148.36it/s]     14%|#3        | 31873/234119.0 [00:08<00:48, 4174.01it/s]     14%|#3        | 32291/234119.0 [00:08<00:48, 4146.90it/s]     14%|#3        | 32716/234119.0 [00:08<00:48, 4175.93it/s]     14%|#4        | 33146/234119.0 [00:08<00:47, 4210.97it/s]     14%|#4        | 33568/234119.0 [00:08<00:47, 4196.40it/s]     15%|#4        | 33994/234119.0 [00:08<00:47, 4214.37it/s]     15%|#4        | 34418/234119.0 [00:08<00:47, 4219.31it/s]     15%|#4        | 34840/234119.0 [00:08<00:47, 4214.06it/s]     15%|#5        | 35282/234119.0 [00:09<00:46, 4273.74it/s]     15%|#5        | 35710/234119.0 [00:09<00:47, 4199.82it/s]     15%|#5        | 36133/234119.0 [00:09<00:47, 4205.94it/s]     16%|#5        | 36570/234119.0 [00:09<00:46, 4252.16it/s]     16%|#5        | 37006/234119.0 [00:09<00:46, 4281.01it/s]     16%|#5        | 37435/234119.0 [00:10<02:51, 1150.14it/s]     16%|#6        | 37870/234119.0 [00:10<02:12, 1478.30it/s]     16%|#6        | 38305/234119.0 [00:10<01:46, 1845.05it/s]     17%|#6        | 38750/234119.0 [00:10<01:26, 2247.21it/s]     17%|#6        | 39191/234119.0 [00:10<01:13, 2637.98it/s]     17%|#6        | 39625/234119.0 [00:10<01:05, 2986.75it/s]     17%|#7        | 40070/234119.0 [00:11<00:58, 3317.21it/s]     17%|#7        | 40512/234119.0 [00:11<00:54, 3584.95it/s]     17%|#7        | 40942/234119.0 [00:11<00:51, 3738.98it/s]     18%|#7        | 41374/234119.0 [00:11<00:49, 3894.14it/s]     18%|#7        | 41802/234119.0 [00:11<00:48, 3956.55it/s]     18%|#8        | 42238/234119.0 [00:11<00:47, 4069.37it/s]     18%|#8        | 42684/234119.0 [00:11<00:45, 4178.85it/s]     18%|#8        | 43117/234119.0 [00:11<00:45, 4199.44it/s]     19%|#8        | 43547/234119.0 [00:11<00:45, 4166.77it/s]     19%|#8        | 43976/234119.0 [00:11<00:45, 4202.29it/s]     19%|#8        | 44405/234119.0 [00:12<00:44, 4227.98it/s]     19%|#9        | 44832/234119.0 [00:12<00:45, 4170.59it/s]     19%|#9        | 45252/234119.0 [00:12<00:45, 4146.20it/s]     20%|#9        | 45669/234119.0 [00:12<00:45, 4143.88it/s]     20%|#9        | 46089/234119.0 [00:12<00:45, 4158.43it/s]     20%|#9        | 46507/234119.0 [00:12<00:45, 4163.84it/s]     20%|##        | 46938/234119.0 [00:12<00:44, 4205.05it/s]     20%|##        | 47370/234119.0 [00:12<00:44, 4237.03it/s]     20%|##        | 47815/234119.0 [00:12<00:43, 4298.97it/s]     21%|##        | 48246/234119.0 [00:12<00:43, 4281.10it/s]     21%|##        | 48675/234119.0 [00:13<00:43, 4262.58it/s]     21%|##        | 49102/234119.0 [00:13<00:43, 4208.75it/s]     21%|##1       | 49524/234119.0 [00:13<00:44, 4171.99it/s]     21%|##1       | 49946/234119.0 [00:13<00:44, 4185.67it/s]     22%|##1       | 50368/234119.0 [00:13<00:43, 4194.47it/s]     22%|##1       | 50800/234119.0 [00:13<00:43, 4230.00it/s]     22%|##1       | 51237/234119.0 [00:13<00:42, 4271.50it/s]     22%|##2       | 51682/234119.0 [00:13<00:42, 4324.65it/s]     22%|##2       | 52120/234119.0 [00:13<00:41, 4338.04it/s]     22%|##2       | 52554/234119.0 [00:13<00:41, 4331.87it/s]     23%|##2       | 52988/234119.0 [00:14<00:42, 4276.48it/s]     23%|##2       | 53416/234119.0 [00:14<00:42, 4261.36it/s]     23%|##2       | 53843/234119.0 [00:14<00:42, 4214.06it/s]     23%|##3       | 54289/234119.0 [00:14<00:41, 4285.88it/s]     23%|##3       | 54733/234119.0 [00:14<00:41, 4329.77it/s]     24%|##3       | 55167/234119.0 [00:14<00:41, 4261.34it/s]     24%|##3       | 55597/234119.0 [00:14<00:41, 4268.67it/s]     24%|##3       | 56039/234119.0 [00:14<00:41, 4312.11it/s]     24%|##4       | 56471/234119.0 [00:14<00:41, 4291.05it/s]     24%|##4       | 56901/234119.0 [00:14<00:41, 4270.58it/s]     24%|##4       | 57329/234119.0 [00:15<00:42, 4160.87it/s]     25%|##4       | 57751/234119.0 [00:15<00:42, 4177.91it/s]     25%|##4       | 58170/234119.0 [00:15<00:42, 4166.07it/s]     25%|##5       | 58599/234119.0 [00:15<00:41, 4201.60it/s]     25%|##5       | 59044/234119.0 [00:15<00:40, 4273.63it/s]     25%|##5       | 59488/234119.0 [00:15<00:40, 4320.98it/s]     26%|##5       | 59924/234119.0 [00:15<00:40, 4331.35it/s]     26%|##5       | 60358/234119.0 [00:15<00:40, 4317.27it/s]     26%|##5       | 60790/234119.0 [00:15<00:40, 4296.77it/s]     26%|##6       | 61220/234119.0 [00:15<00:40, 4290.78it/s]     26%|##6       | 61650/234119.0 [00:16<00:40, 4208.02it/s]     27%|##6       | 62077/234119.0 [00:16<00:40, 4223.98it/s]     27%|##6       | 62502/234119.0 [00:16<00:40, 4231.14it/s]     27%|##6       | 62958/234119.0 [00:16<00:39, 4328.05it/s]     27%|##7       | 63392/234119.0 [00:16<00:40, 4261.35it/s]     27%|##7       | 63819/234119.0 [00:16<00:40, 4200.47it/s]     27%|##7       | 64270/234119.0 [00:16<00:39, 4288.99it/s]     28%|##7       | 64716/234119.0 [00:16<00:39, 4337.88it/s]     28%|##7       | 65160/234119.0 [00:16<00:38, 4367.85it/s]     28%|##8       | 65598/234119.0 [00:17<00:38, 4343.59it/s]     28%|##8       | 66033/234119.0 [00:17<00:39, 4301.34it/s]     28%|##8       | 66467/234119.0 [00:17<00:38, 4311.53it/s]     29%|##8       | 66906/234119.0 [00:17<00:38, 4332.50it/s]     29%|##8       | 67368/234119.0 [00:17<00:37, 4416.98it/s]     29%|##8       | 67817/234119.0 [00:17<00:37, 4436.72it/s]     29%|##9       | 68261/234119.0 [00:17<00:37, 4391.89it/s]     29%|##9       | 68701/234119.0 [00:17<00:37, 4390.49it/s]     30%|##9       | 69146/234119.0 [00:17<00:37, 4407.81it/s]     30%|##9       | 69601/234119.0 [00:17<00:36, 4447.74it/s]     30%|##9       | 70046/234119.0 [00:18<00:37, 4391.11it/s]     30%|###       | 70486/234119.0 [00:18<00:37, 4316.09it/s]     30%|###       | 70921/234119.0 [00:18<00:37, 4325.29it/s]     30%|###       | 71354/234119.0 [00:18<00:37, 4290.96it/s]     31%|###       | 71788/234119.0 [00:18<00:37, 4301.94it/s]     31%|###       | 72219/234119.0 [00:18<00:37, 4303.45it/s]     31%|###1      | 72658/234119.0 [00:18<00:37, 4327.12it/s]     31%|###1      | 73113/234119.0 [00:18<00:36, 4393.29it/s]     31%|###1      | 73565/234119.0 [00:18<00:36, 4431.09it/s]     32%|###1      | 74018/234119.0 [00:18<00:35, 4459.36it/s]     32%|###1      | 74465/234119.0 [00:19<00:36, 4362.75it/s]     32%|###1      | 74902/234119.0 [00:19<00:36, 4316.97it/s]     32%|###2      | 75335/234119.0 [00:19<00:37, 4280.71it/s]     32%|###2      | 75764/234119.0 [00:19<00:37, 4249.84it/s]     33%|###2      | 76205/234119.0 [00:19<00:36, 4295.90it/s]     33%|###2      | 76635/234119.0 [00:19<00:36, 4296.20it/s]     33%|###2      | 77080/234119.0 [00:19<00:36, 4334.85it/s]     33%|###3      | 77514/234119.0 [00:19<00:36, 4333.05it/s]     33%|###3      | 77948/234119.0 [00:19<00:36, 4313.90it/s]     33%|###3      | 78395/234119.0 [00:19<00:35, 4359.01it/s]     34%|###3      | 78831/234119.0 [00:20<00:36, 4256.48it/s]     34%|###3      | 79258/234119.0 [00:20<00:36, 4209.63it/s]     34%|###4      | 79686/234119.0 [00:20<00:36, 4227.65it/s]     34%|###4      | 80110/234119.0 [00:20<00:36, 4200.65it/s]     34%|###4      | 80542/234119.0 [00:20<00:36, 4235.66it/s]     35%|###4      | 80977/234119.0 [00:20<00:35, 4268.75it/s]     35%|###4      | 81412/234119.0 [00:20<00:35, 4291.99it/s]     35%|###4      | 81842/234119.0 [00:20<00:35, 4235.34it/s]     35%|###5      | 82266/234119.0 [00:20<00:36, 4208.00it/s]     35%|###5      | 82719/234119.0 [00:20<00:35, 4299.83it/s]     36%|###5      | 83150/234119.0 [00:21<00:35, 4232.89it/s]     36%|###5      | 83574/234119.0 [00:21<00:35, 4231.06it/s]     36%|###5      | 83998/234119.0 [00:21<00:35, 4230.85it/s]     36%|###6      | 84436/234119.0 [00:21<00:35, 4274.90it/s]     36%|###6      | 84864/234119.0 [00:21<00:35, 4264.37it/s]     36%|###6      | 85312/234119.0 [00:21<00:34, 4325.92it/s]     37%|###6      | 85758/234119.0 [00:21<00:33, 4363.73it/s]     37%|###6      | 86204/234119.0 [00:21<00:33, 4389.22it/s]     37%|###7      | 86643/234119.0 [00:21<00:34, 4298.92it/s]     37%|###7      | 87074/234119.0 [00:21<00:34, 4260.94it/s]     37%|###7      | 87501/234119.0 [00:22<00:35, 4175.79it/s]     38%|###7      | 87920/234119.0 [00:22<00:35, 4132.19it/s]     38%|###7      | 88334/234119.0 [00:22<00:35, 4132.72it/s]     38%|###7      | 88766/234119.0 [00:22<00:34, 4185.57it/s]     38%|###8      | 89187/234119.0 [00:22<00:34, 4192.25it/s]     38%|###8      | 89615/234119.0 [00:22<00:34, 4217.19it/s]     38%|###8      | 90037/234119.0 [00:22<00:34, 4217.94it/s]     39%|###8      | 90490/234119.0 [00:22<00:33, 4307.77it/s]     39%|###8      | 90921/234119.0 [00:22<00:33, 4269.37it/s]     39%|###9      | 91364/234119.0 [00:23<00:33, 4316.32it/s]     39%|###9      | 91805/234119.0 [00:23<00:32, 4342.65it/s]     39%|###9      | 92243/234119.0 [00:23<00:32, 4353.40it/s]     40%|###9      | 92679/234119.0 [00:23<00:32, 4320.82it/s]     40%|###9      | 93115/234119.0 [00:23<00:32, 4329.12it/s]     40%|###9      | 93552/234119.0 [00:23<00:32, 4338.98it/s]     40%|####      | 93990/234119.0 [00:23<00:32, 4349.94it/s]     40%|####      | 94426/234119.0 [00:23<00:32, 4335.48it/s]     41%|####      | 94862/234119.0 [00:23<00:32, 4340.82it/s]     41%|####      | 95297/234119.0 [00:23<00:32, 4313.63it/s]     41%|####      | 95729/234119.0 [00:24<00:32, 4298.68it/s]     41%|####1     | 96159/234119.0 [00:24<00:32, 4264.48it/s]     41%|####1     | 96586/234119.0 [00:24<00:32, 4170.56it/s]     41%|####1     | 97004/234119.0 [00:24<00:33, 4132.21it/s]     42%|####1     | 97432/234119.0 [00:24<00:32, 4174.22it/s]     42%|####1     | 97860/234119.0 [00:24<00:32, 4203.49it/s]     42%|####1     | 98302/234119.0 [00:24<00:31, 4266.72it/s]     42%|####2     | 98750/234119.0 [00:24<00:31, 4329.44it/s]     42%|####2     | 99196/234119.0 [00:24<00:30, 4366.49it/s]     43%|####2     | 99633/234119.0 [00:24<00:31, 4326.26it/s]     43%|####2     | 100077/234119.0 [00:25<00:30, 4356.59it/s]     43%|####2     | 100513/234119.0 [00:25<00:30, 4351.76it/s]     43%|####3     | 100949/234119.0 [00:25<00:31, 4293.83it/s]     43%|####3     | 101392/234119.0 [00:25<00:30, 4333.81it/s]     43%|####3     | 101827/234119.0 [00:25<00:30, 4336.56it/s]     44%|####3     | 102261/234119.0 [00:25<00:30, 4331.44it/s]     44%|####3     | 102697/234119.0 [00:25<00:30, 4337.30it/s]     44%|####4     | 103131/234119.0 [00:25<00:30, 4327.33it/s]     44%|####4     | 103564/234119.0 [00:25<00:30, 4306.91it/s]     44%|####4     | 103995/234119.0 [00:25<00:30, 4295.46it/s]     45%|####4     | 104426/234119.0 [00:26<00:30, 4299.50it/s]     45%|####4     | 104869/234119.0 [00:26<00:29, 4335.44it/s]     45%|####4     | 105303/234119.0 [00:26<00:29, 4296.29it/s]     45%|####5     | 105744/234119.0 [00:26<00:29, 4329.66it/s]     45%|####5     | 106191/234119.0 [00:26<00:29, 4369.27it/s]     46%|####5     | 106633/234119.0 [00:26<00:29, 4382.63it/s]     46%|####5     | 107087/234119.0 [00:26<00:28, 4428.42it/s]     46%|####5     | 107540/234119.0 [00:26<00:28, 4458.44it/s]     46%|####6     | 107986/234119.0 [00:26<00:28, 4405.83it/s]     46%|####6     | 108432/234119.0 [00:26<00:28, 4420.04it/s]     47%|####6     | 108875/234119.0 [00:27<00:28, 4397.68it/s]     47%|####6     | 109315/234119.0 [00:27<00:28, 4362.73it/s]     47%|####6     | 109752/234119.0 [00:27<00:28, 4359.13it/s]     47%|####7     | 110209/234119.0 [00:27<00:28, 4421.35it/s]     47%|####7     | 110652/234119.0 [00:27<00:28, 4381.97it/s]     47%|####7     | 111091/234119.0 [00:27<00:28, 4327.91it/s]     48%|####7     | 111546/234119.0 [00:27<00:27, 4391.96it/s]     48%|####7     | 111989/234119.0 [00:27<00:27, 4401.75it/s]     48%|####8     | 112436/234119.0 [00:27<00:27, 4421.80it/s]     48%|####8     | 112879/234119.0 [00:27<00:27, 4389.42it/s]     48%|####8     | 113319/234119.0 [00:28<00:27, 4343.37it/s]     49%|####8     | 113754/234119.0 [00:28<00:28, 4277.34it/s]     49%|####8     | 114195/234119.0 [00:28<00:27, 4314.81it/s]     49%|####8     | 114630/234119.0 [00:28<00:27, 4323.71it/s]     49%|####9     | 115063/234119.0 [00:28<00:27, 4299.67it/s]     49%|####9     | 115516/234119.0 [00:28<00:27, 4364.34it/s]     50%|####9     | 115966/234119.0 [00:28<00:26, 4403.54it/s]     50%|####9     | 116407/234119.0 [00:28<00:26, 4388.26it/s]     50%|####9     | 116861/234119.0 [00:28<00:26, 4432.24it/s]     50%|#####     | 117305/234119.0 [00:29<00:43, 2681.20it/s]     50%|#####     | 117744/234119.0 [00:29<00:38, 3031.20it/s]     50%|#####     | 118201/234119.0 [00:29<00:34, 3378.39it/s]     51%|#####     | 118655/234119.0 [00:29<00:31, 3662.21it/s]     51%|#####     | 119089/234119.0 [00:29<00:29, 3837.56it/s]     51%|#####1    | 119538/234119.0 [00:29<00:28, 4013.12it/s]     51%|#####1    | 119979/234119.0 [00:29<00:27, 4122.49it/s]     51%|#####1    | 120413/234119.0 [00:29<00:27, 4167.88it/s]     52%|#####1    | 120865/234119.0 [00:30<00:26, 4268.90it/s]     52%|#####1    | 121315/234119.0 [00:30<00:26, 4335.62it/s]     52%|#####2    | 121757/234119.0 [00:30<00:25, 4335.02it/s]     52%|#####2    | 122196/234119.0 [00:30<00:26, 4287.94it/s]     52%|#####2    | 122629/234119.0 [00:30<00:25, 4298.64it/s]     53%|#####2    | 123062/234119.0 [00:30<00:25, 4291.04it/s]     53%|#####2    | 123494/234119.0 [00:30<00:25, 4275.12it/s]     53%|#####2    | 123934/234119.0 [00:30<00:25, 4311.99it/s]     53%|#####3    | 124367/234119.0 [00:30<00:25, 4239.26it/s]     53%|#####3    | 124808/234119.0 [00:30<00:25, 4288.38it/s]     54%|#####3    | 125259/234119.0 [00:31<00:25, 4353.81it/s]     54%|#####3    | 125702/234119.0 [00:31<00:24, 4375.09it/s]     54%|#####3    | 126140/234119.0 [00:31<00:24, 4347.77it/s]     54%|#####4    | 126576/234119.0 [00:31<00:25, 4274.56it/s]     54%|#####4    | 127016/234119.0 [00:31<00:24, 4311.14it/s]     54%|#####4    | 127448/234119.0 [00:31<00:24, 4305.81it/s]     55%|#####4    | 127897/234119.0 [00:31<00:24, 4359.19it/s]     55%|#####4    | 128334/234119.0 [00:31<00:24, 4345.77it/s]     55%|#####5    | 128783/234119.0 [00:31<00:24, 4385.56it/s]     55%|#####5    | 129223/234119.0 [00:31<00:23, 4388.90it/s]     55%|#####5    | 129670/234119.0 [00:32<00:23, 4412.21it/s]     56%|#####5    | 130112/234119.0 [00:32<00:23, 4385.57it/s]     56%|#####5    | 130551/234119.0 [00:32<00:23, 4362.77it/s]     56%|#####5    | 130988/234119.0 [00:32<00:24, 4295.71it/s]     56%|#####6    | 131435/234119.0 [00:32<00:23, 4346.10it/s]     56%|#####6    | 131870/234119.0 [00:32<00:23, 4317.99it/s]     57%|#####6    | 132302/234119.0 [00:32<00:23, 4292.30it/s]     57%|#####6    | 132733/234119.0 [00:32<00:23, 4295.16it/s]     57%|#####6    | 133165/234119.0 [00:32<00:23, 4299.39it/s]     57%|#####7    | 133599/234119.0 [00:32<00:23, 4311.16it/s]     57%|#####7    | 134040/234119.0 [00:33<00:23, 4338.15it/s]     57%|#####7    | 134474/234119.0 [00:33<00:23, 4297.16it/s]     58%|#####7    | 134905/234119.0 [00:33<00:23, 4300.68it/s]     58%|#####7    | 135336/234119.0 [00:33<00:23, 4261.39it/s]     58%|#####7    | 135770/234119.0 [00:33<00:22, 4283.08it/s]     58%|#####8    | 136205/234119.0 [00:33<00:22, 4300.23it/s]     58%|#####8    | 136639/234119.0 [00:33<00:22, 4310.23it/s]     59%|#####8    | 137077/234119.0 [00:33<00:22, 4329.75it/s]     59%|#####8    | 137511/234119.0 [00:33<00:22, 4308.81it/s]     59%|#####8    | 137942/234119.0 [00:33<00:22, 4251.46it/s]     59%|#####9    | 138378/234119.0 [00:34<00:22, 4280.68it/s]     59%|#####9    | 138829/234119.0 [00:34<00:21, 4346.77it/s]     59%|#####9    | 139273/234119.0 [00:34<00:21, 4372.45it/s]     60%|#####9    | 139711/234119.0 [00:34<00:21, 4310.61it/s]     60%|#####9    | 140146/234119.0 [00:34<00:21, 4320.37it/s]     60%|######    | 140584/234119.0 [00:34<00:21, 4336.58it/s]     60%|######    | 141021/234119.0 [00:34<00:21, 4346.42it/s]     60%|######    | 141456/234119.0 [00:34<00:21, 4338.58it/s]     61%|######    | 141890/234119.0 [00:34<00:21, 4329.76it/s]     61%|######    | 142327/234119.0 [00:34<00:21, 4336.97it/s]     61%|######    | 142761/234119.0 [00:35<00:21, 4335.73it/s]     61%|######1   | 143196/234119.0 [00:35<00:20, 4337.39it/s]     61%|######1   | 143630/234119.0 [00:35<00:20, 4327.18it/s]     62%|######1   | 144063/234119.0 [00:35<00:21, 4282.19it/s]     62%|######1   | 144492/234119.0 [00:35<00:21, 4205.95it/s]     62%|######1   | 144926/234119.0 [00:35<00:21, 4244.01it/s]     62%|######2   | 145369/234119.0 [00:35<00:20, 4295.69it/s]     62%|######2   | 145809/234119.0 [00:35<00:20, 4326.51it/s]     62%|######2   | 146253/234119.0 [00:35<00:20, 4358.30it/s]     63%|######2   | 146699/234119.0 [00:35<00:19, 4386.80it/s]     63%|######2   | 147139/234119.0 [00:36<00:19, 4390.30it/s]     63%|######3   | 147588/234119.0 [00:36<00:19, 4419.39it/s]     63%|######3   | 148037/234119.0 [00:36<00:19, 4438.44it/s]     63%|######3   | 148481/234119.0 [00:36<00:19, 4352.03it/s]     64%|######3   | 148917/234119.0 [00:36<00:19, 4311.74it/s]     64%|######3   | 149349/234119.0 [00:36<00:19, 4293.19it/s]     64%|######3   | 149801/234119.0 [00:36<00:19, 4359.53it/s]     64%|######4   | 150243/234119.0 [00:36<00:19, 4377.42it/s]     64%|######4   | 150683/234119.0 [00:36<00:19, 4383.74it/s]     65%|######4   | 151122/234119.0 [00:36<00:19, 4335.04it/s]     65%|######4   | 151569/234119.0 [00:37<00:18, 4374.60it/s]     65%|######4   | 152007/234119.0 [00:37<00:18, 4368.20it/s]     65%|######5   | 152461/234119.0 [00:37<00:18, 4416.97it/s]     65%|######5   | 152903/234119.0 [00:37<00:18, 4345.04it/s]     65%|######5   | 153338/234119.0 [00:37<00:18, 4327.62it/s]     66%|######5   | 153771/234119.0 [00:37<00:18, 4260.57it/s]     66%|######5   | 154226/234119.0 [00:37<00:18, 4344.98it/s]     66%|######6   | 154661/234119.0 [00:37<00:18, 4248.42it/s]     66%|######6   | 155101/234119.0 [00:37<00:18, 4292.53it/s]     66%|######6   | 155536/234119.0 [00:38<00:18, 4309.26it/s]     67%|######6   | 155984/234119.0 [00:38<00:17, 4358.13it/s]     67%|######6   | 156421/234119.0 [00:38<00:17, 4350.78it/s]     67%|######7   | 156861/234119.0 [00:38<00:17, 4362.64it/s]     67%|######7   | 157298/234119.0 [00:38<00:17, 4309.54it/s]     67%|######7   | 157730/234119.0 [00:38<00:17, 4266.26it/s]     68%|######7   | 158172/234119.0 [00:38<00:17, 4307.80it/s]     68%|######7   | 158622/234119.0 [00:38<00:17, 4363.94it/s]     68%|######7   | 159059/234119.0 [00:38<00:17, 4318.18it/s]     68%|######8   | 159503/234119.0 [00:38<00:17, 4352.71it/s]     68%|######8   | 159939/234119.0 [00:39<00:17, 4292.86it/s]     68%|######8   | 160369/234119.0 [00:39<00:17, 4269.00it/s]     69%|######8   | 160811/234119.0 [00:39<00:17, 4311.69it/s]     69%|######8   | 161243/234119.0 [00:39<00:16, 4297.94it/s]     69%|######9   | 161673/234119.0 [00:39<00:17, 4226.30it/s]     69%|######9   | 162096/234119.0 [00:39<00:17, 4185.58it/s]     69%|######9   | 162523/234119.0 [00:39<00:17, 4210.32it/s]     70%|######9   | 162959/234119.0 [00:39<00:16, 4251.60it/s]     70%|######9   | 163390/234119.0 [00:39<00:16, 4268.38it/s]     70%|######9   | 163825/234119.0 [00:39<00:16, 4292.42it/s]     70%|#######   | 164255/234119.0 [00:40<00:16, 4290.36it/s]     70%|#######   | 164685/234119.0 [00:40<00:16, 4282.95it/s]     71%|#######   | 165141/234119.0 [00:40<00:15, 4364.00it/s]     71%|#######   | 165579/234119.0 [00:40<00:15, 4367.38it/s]     71%|#######   | 166016/234119.0 [00:40<00:15, 4310.99it/s]     71%|#######1  | 166448/234119.0 [00:40<00:16, 4223.14it/s]     71%|#######1  | 166871/234119.0 [00:40<00:15, 4214.31it/s]     71%|#######1  | 167312/234119.0 [00:40<00:15, 4269.63it/s]     72%|#######1  | 167740/234119.0 [00:40<00:15, 4244.27it/s]     72%|#######1  | 168185/234119.0 [00:40<00:15, 4303.23it/s]     72%|#######2  | 168616/234119.0 [00:41<00:15, 4280.99it/s]     72%|#######2  | 169047/234119.0 [00:41<00:15, 4288.40it/s]     72%|#######2  | 169497/234119.0 [00:41<00:14, 4349.83it/s]     73%|#######2  | 169950/234119.0 [00:41<00:14, 4401.48it/s]     73%|#######2  | 170393/234119.0 [00:41<00:14, 4407.69it/s]     73%|#######2  | 170834/234119.0 [00:41<00:14, 4386.37it/s]     73%|#######3  | 171273/234119.0 [00:41<00:14, 4368.97it/s]     73%|#######3  | 171710/234119.0 [00:41<00:14, 4358.59it/s]     74%|#######3  | 172149/234119.0 [00:41<00:14, 4366.41it/s]     74%|#######3  | 172599/234119.0 [00:41<00:13, 4405.97it/s]     74%|#######3  | 173040/234119.0 [00:42<00:13, 4375.95it/s]     74%|#######4  | 173482/234119.0 [00:42<00:13, 4386.43it/s]     74%|#######4  | 173935/234119.0 [00:42<00:13, 4428.72it/s]     74%|#######4  | 174378/234119.0 [00:42<00:13, 4406.83it/s]     75%|#######4  | 174819/234119.0 [00:42<00:13, 4344.71it/s]     75%|#######4  | 175254/234119.0 [00:42<00:13, 4288.89it/s]     75%|#######5  | 175701/234119.0 [00:42<00:13, 4339.83it/s]     75%|#######5  | 176136/234119.0 [00:42<00:13, 4327.50it/s]     75%|#######5  | 176579/234119.0 [00:42<00:13, 4356.81it/s]     76%|#######5  | 177016/234119.0 [00:42<00:13, 4358.81it/s]     76%|#######5  | 177453/234119.0 [00:43<00:12, 4360.02it/s]     76%|#######5  | 177905/234119.0 [00:43<00:12, 4407.01it/s]     76%|#######6  | 178346/234119.0 [00:43<00:12, 4379.02it/s]     76%|#######6  | 178786/234119.0 [00:43<00:12, 4383.03it/s]     77%|#######6  | 179225/234119.0 [00:43<00:12, 4337.54it/s]     77%|#######6  | 179669/234119.0 [00:43<00:12, 4367.42it/s]     77%|#######6  | 180115/234119.0 [00:43<00:12, 4392.09it/s]     77%|#######7  | 180555/234119.0 [00:43<00:12, 4372.54it/s]     77%|#######7  | 180993/234119.0 [00:43<00:12, 4371.89it/s]     77%|#######7  | 181434/234119.0 [00:43<00:12, 4381.95it/s]     78%|#######7  | 181875/234119.0 [00:44<00:11, 4388.35it/s]     78%|#######7  | 182314/234119.0 [00:44<00:11, 4372.16it/s]     78%|#######8  | 182752/234119.0 [00:44<00:11, 4301.07it/s]     78%|#######8  | 183183/234119.0 [00:44<00:11, 4273.86it/s]     78%|#######8  | 183611/234119.0 [00:44<00:11, 4243.48it/s]     79%|#######8  | 184036/234119.0 [00:44<00:11, 4174.37it/s]     79%|#######8  | 184454/234119.0 [00:44<00:11, 4171.72it/s]     79%|#######8  | 184872/234119.0 [00:44<00:11, 4160.48it/s]     79%|#######9  | 185289/234119.0 [00:44<00:11, 4154.70it/s]     79%|#######9  | 185705/234119.0 [00:45<00:11, 4129.72it/s]     79%|#######9  | 186124/234119.0 [00:45<00:11, 4145.28it/s]     80%|#######9  | 186556/234119.0 [00:45<00:11, 4194.57it/s]     80%|#######9  | 186976/234119.0 [00:45<00:11, 4183.05it/s]     80%|########  | 187401/234119.0 [00:45<00:11, 4202.77it/s]     80%|########  | 187829/234119.0 [00:45<00:10, 4223.61it/s]     80%|########  | 188256/234119.0 [00:45<00:10, 4236.63it/s]     81%|########  | 188689/234119.0 [00:45<00:10, 4263.74it/s]     81%|########  | 189126/234119.0 [00:45<00:10, 4295.48it/s]     81%|########  | 189568/234119.0 [00:45<00:10, 4331.60it/s]     81%|########1 | 190002/234119.0 [00:46<00:10, 4322.08it/s]     81%|########1 | 190435/234119.0 [00:46<00:10, 4305.58it/s]     82%|########1 | 190866/234119.0 [00:46<00:10, 4293.57it/s]     82%|########1 | 191296/234119.0 [00:46<00:10, 4265.28it/s]     82%|########1 | 191723/234119.0 [00:46<00:10, 4226.33it/s]     82%|########2 | 192146/234119.0 [00:46<00:09, 4226.08it/s]     82%|########2 | 192579/234119.0 [00:46<00:09, 4255.00it/s]     82%|########2 | 193013/234119.0 [00:46<00:09, 4280.08it/s]     83%|########2 | 193442/234119.0 [00:46<00:09, 4242.65it/s]     83%|########2 | 193867/234119.0 [00:46<00:09, 4230.24it/s]     83%|########2 | 194291/234119.0 [00:47<00:09, 4202.97it/s]     83%|########3 | 194712/234119.0 [00:47<00:09, 4182.30it/s]     83%|########3 | 195141/234119.0 [00:47<00:09, 4213.40it/s]     84%|########3 | 195565/234119.0 [00:47<00:09, 4218.79it/s]     84%|########3 | 196004/234119.0 [00:47<00:08, 4265.78it/s]     84%|########3 | 196435/234119.0 [00:47<00:08, 4278.12it/s]     84%|########4 | 196863/234119.0 [00:47<00:08, 4260.71it/s]     84%|########4 | 197290/234119.0 [00:47<00:08, 4257.40it/s]     84%|########4 | 197718/234119.0 [00:47<00:08, 4262.24it/s]     85%|########4 | 198145/234119.0 [00:47<00:08, 4256.95it/s]     85%|########4 | 198571/234119.0 [00:48<00:08, 4184.16it/s]     85%|########4 | 198990/234119.0 [00:48<00:08, 4164.90it/s]     85%|########5 | 199407/234119.0 [00:48<00:08, 4138.54it/s]     85%|########5 | 199833/234119.0 [00:48<00:08, 4172.50it/s]     86%|########5 | 200257/234119.0 [00:48<00:08, 4189.68it/s]     86%|########5 | 200677/234119.0 [00:48<00:08, 4168.30it/s]     86%|########5 | 201099/234119.0 [00:48<00:07, 4182.46it/s]     86%|########6 | 201518/234119.0 [00:48<00:07, 4170.97it/s]     86%|########6 | 201936/234119.0 [00:48<00:07, 4165.55it/s]     86%|########6 | 202353/234119.0 [00:48<00:07, 4147.83it/s]     87%|########6 | 202768/234119.0 [00:49<00:07, 4137.25it/s]     87%|########6 | 203207/234119.0 [00:49<00:07, 4209.96it/s]     87%|########6 | 203629/234119.0 [00:49<00:07, 4209.24it/s]     87%|########7 | 204050/234119.0 [00:49<00:07, 4194.67it/s]     87%|########7 | 204483/234119.0 [00:49<00:06, 4234.46it/s]     88%|########7 | 204916/234119.0 [00:49<00:06, 4260.61it/s]     88%|########7 | 205343/234119.0 [00:49<00:06, 4227.39it/s]     88%|########7 | 205767/234119.0 [00:49<00:06, 4229.58it/s]     88%|########8 | 206194/234119.0 [00:49<00:06, 4240.40it/s]     88%|########8 | 206624/234119.0 [00:49<00:06, 4257.31it/s]     88%|########8 | 207050/234119.0 [00:50<00:06, 4153.02it/s]     89%|########8 | 207466/234119.0 [00:50<00:06, 4120.11it/s]     89%|########8 | 207879/234119.0 [00:50<00:06, 4115.73it/s]     89%|########8 | 208306/234119.0 [00:50<00:06, 4158.73it/s]     89%|########9 | 208723/234119.0 [00:50<00:06, 4135.80it/s]     89%|########9 | 209144/234119.0 [00:50<00:06, 4154.77it/s]     90%|########9 | 209571/234119.0 [00:50<00:05, 4181.53it/s]     90%|########9 | 210007/234119.0 [00:50<00:05, 4234.31it/s]     90%|########9 | 210440/234119.0 [00:50<00:05, 4260.85it/s]     90%|######### | 210867/234119.0 [00:50<00:05, 4262.16it/s]     90%|######### | 211294/234119.0 [00:51<00:05, 4185.46it/s]     90%|######### | 211713/234119.0 [00:51<00:05, 4170.40it/s]     91%|######### | 212131/234119.0 [00:51<00:05, 4123.30it/s]     91%|######### | 212565/234119.0 [00:51<00:05, 4184.80it/s]     91%|######### | 213005/234119.0 [00:51<00:04, 4246.72it/s]     91%|#########1| 213444/234119.0 [00:51<00:04, 4288.35it/s]     91%|#########1| 213883/234119.0 [00:51<00:04, 4318.23it/s]     92%|#########1| 214315/234119.0 [00:51<00:04, 4309.08it/s]     92%|#########1| 214747/234119.0 [00:51<00:04, 4269.94it/s]     92%|#########1| 215175/234119.0 [00:51<00:04, 4217.57it/s]     92%|#########2| 215607/234119.0 [00:52<00:04, 4245.73it/s]     92%|#########2| 216041/234119.0 [00:52<00:04, 4272.16it/s]     92%|#########2| 216478/234119.0 [00:52<00:04, 4299.07it/s]     93%|#########2| 216909/234119.0 [00:52<00:04, 4297.23it/s]     93%|#########2| 217339/234119.0 [00:52<00:03, 4292.01it/s]     93%|#########3| 217769/234119.0 [00:52<00:03, 4227.09it/s]     93%|#########3| 218197/234119.0 [00:52<00:03, 4240.95it/s]     93%|#########3| 218622/234119.0 [00:53<00:06, 2482.54it/s]     94%|#########3| 219026/234119.0 [00:53<00:05, 2791.67it/s]     94%|#########3| 219456/234119.0 [00:53<00:04, 3125.07it/s]     94%|#########3| 219896/234119.0 [00:53<00:04, 3428.87it/s]     94%|#########4| 220323/234119.0 [00:53<00:03, 3641.67it/s]     94%|#########4| 220737/234119.0 [00:53<00:03, 3773.79it/s]     94%|#########4| 221174/234119.0 [00:53<00:03, 3937.92it/s]     95%|#########4| 221606/234119.0 [00:53<00:03, 4044.34it/s]     95%|#########4| 222027/234119.0 [00:53<00:02, 4079.89it/s]     95%|#########5| 222447/234119.0 [00:53<00:02, 4100.37it/s]     95%|#########5| 222866/234119.0 [00:54<00:02, 4102.39it/s]     95%|#########5| 223285/234119.0 [00:54<00:02, 4127.47it/s]     96%|#########5| 223708/234119.0 [00:54<00:02, 4155.32it/s]     96%|#########5| 224129/234119.0 [00:54<00:02, 4170.34it/s]     96%|#########5| 224565/234119.0 [00:54<00:02, 4226.73it/s]     96%|#########6| 224991/234119.0 [00:54<00:02, 4235.30it/s]     96%|#########6| 225416/234119.0 [00:54<00:02, 4217.49it/s]     96%|#########6| 225844/234119.0 [00:54<00:01, 4236.11it/s]     97%|#########6| 226269/234119.0 [00:54<00:01, 4182.50it/s]     97%|#########6| 226690/234119.0 [00:54<00:01, 4188.30it/s]     97%|#########7| 227112/234119.0 [00:55<00:01, 4195.78it/s]     97%|#########7| 227532/234119.0 [00:55<00:01, 4165.84it/s]     97%|#########7| 227949/234119.0 [00:55<00:01, 4143.18it/s]     98%|#########7| 228364/234119.0 [00:55<00:01, 4131.66it/s]     98%|#########7| 228778/234119.0 [00:55<00:01, 4091.62it/s]     98%|#########7| 229188/234119.0 [00:55<00:01, 4052.20it/s]     98%|#########8| 229594/234119.0 [00:55<00:01, 4021.39it/s]     98%|#########8| 230024/234119.0 [00:55<00:00, 4099.53it/s]     98%|#########8| 230435/234119.0 [00:55<00:00, 4075.16it/s]     99%|#########8| 230843/234119.0 [00:55<00:00, 4069.24it/s]     99%|#########8| 231251/234119.0 [00:56<00:00, 4058.36it/s]     99%|#########8| 231657/234119.0 [00:56<00:00, 4026.64it/s]     99%|#########9| 232067/234119.0 [00:56<00:00, 4048.18it/s]     99%|#########9| 232472/234119.0 [00:56<00:00, 4038.10it/s]     99%|#########9| 232914/234119.0 [00:56<00:00, 4149.51it/s]    100%|#########9| 233336/234119.0 [00:56<00:00, 4167.48it/s]    100%|#########9| 233753/234119.0 [00:56<00:00, 4149.10it/s]    100%|##########| 234119/234119.0 [00:56<00:00, 4118.06it/s]
    Optimizing level 2 [max iter: 10000]
    Optimizing level 1 [max iter: 1000]
    Optimizing level 0 [max iter: 100]
    Optimizing level 2 [max iter: 10000]
    Optimizing level 1 [max iter: 1000]
    Optimizing level 0 [max iter: 100]
    Optimizing level 2 [max iter: 10000]
    Optimizing level 1 [max iter: 1000]
    Optimizing level 0 [max iter: 100]
      0%|          | 0/28280 [00:00<?, ?it/s]      0%|          | 2/28280 [00:00<27:10, 17.34it/s]      0%|          | 4/28280 [00:05<13:44:55,  1.75s/it]      0%|          | 22/28280 [00:06<1:38:35,  4.78it/s]      3%|2         | 784/28280 [00:06<01:49, 251.17it/s]     11%|#         | 3088/28280 [00:06<00:20, 1239.70it/s]     22%|##1       | 6160/28280 [00:06<00:07, 2868.85it/s]     29%|##9       | 8208/28280 [00:06<00:04, 4027.74it/s]     36%|###6      | 10256/28280 [00:06<00:03, 5299.85it/s]     44%|####3     | 12304/28280 [00:06<00:02, 6526.07it/s]     51%|#####     | 14352/28280 [00:07<00:01, 7700.24it/s]     58%|#####7    | 16400/28280 [00:07<00:01, 8150.38it/s]     65%|######5   | 18448/28280 [00:07<00:01, 6733.45it/s]     72%|#######2  | 20496/28280 [00:08<00:02, 3580.47it/s]     80%|#######9  | 22544/28280 [00:10<00:02, 2334.57it/s]     87%|########6 | 24592/28280 [00:12<00:01, 1855.51it/s]     94%|#########4| 26640/28280 [00:14<00:01, 1521.38it/s]     95%|#########5| 26972/28280 [00:15<00:01, 1011.35it/s]     97%|#########6| 27304/28280 [00:16<00:00, 1028.08it/s]     97%|#########7| 27504/28280 [00:17<00:00, 840.60it/s]      98%|#########7| 27651/28280 [00:17<00:00, 847.90it/s]     99%|#########8| 27944/28280 [00:17<00:00, 869.73it/s]     99%|#########9| 28072/28280 [00:17<00:00, 895.46it/s]    100%|##########| 28280/28280 [00:17<00:00, 1603.70it/s]
      0%|          | 0/28280 [00:00<?, ?it/s]      0%|          | 28/28280 [00:00<01:48, 259.36it/s]      0%|          | 124/28280 [00:00<00:50, 559.58it/s]      2%|1         | 508/28280 [00:00<00:23, 1157.20it/s]      2%|2         | 636/28280 [00:00<00:26, 1050.70it/s]      3%|3         | 892/28280 [00:00<00:19, 1422.95it/s]      4%|3         | 1043/28280 [00:00<00:19, 1374.78it/s]      5%|5         | 1532/28280 [00:01<00:20, 1327.06it/s]      6%|6         | 1788/28280 [00:01<00:19, 1335.71it/s]      7%|7         | 2044/28280 [00:01<00:18, 1439.46it/s]      8%|8         | 2300/28280 [00:01<00:18, 1416.53it/s]      9%|9         | 2556/28280 [00:01<00:17, 1450.70it/s]     11%|#         | 3068/28280 [00:02<00:14, 1800.01it/s]     12%|#1        | 3324/28280 [00:02<00:14, 1724.66it/s]     13%|#2        | 3580/28280 [00:02<00:17, 1380.06it/s]     14%|#3        | 3836/28280 [00:02<00:20, 1210.06it/s]     14%|#4        | 4092/28280 [00:03<00:17, 1365.34it/s]     15%|#5        | 4348/28280 [00:03<00:17, 1330.02it/s]     16%|#6        | 4604/28280 [00:03<00:20, 1139.44it/s]     18%|#8        | 5116/28280 [00:03<00:17, 1325.76it/s]     19%|#8        | 5372/28280 [00:04<00:23, 983.82it/s]      20%|#9        | 5628/28280 [00:04<00:22, 1005.44it/s]     21%|##        | 5884/28280 [00:04<00:21, 1048.62it/s]     22%|##1       | 6140/28280 [00:05<00:22, 963.36it/s]      23%|##2       | 6396/28280 [00:05<00:27, 805.25it/s]     24%|##3       | 6652/28280 [00:05<00:24, 897.38it/s]     24%|##4       | 6908/28280 [00:05<00:20, 1044.71it/s]     25%|##5       | 7164/28280 [00:06<00:17, 1193.10it/s]     26%|##6       | 7420/28280 [00:06<00:22, 929.28it/s]      27%|##7       | 7676/28280 [00:06<00:24, 841.51it/s]     28%|##8       | 7932/28280 [00:06<00:19, 1038.60it/s]     29%|##8       | 8188/28280 [00:07<00:17, 1148.68it/s]     30%|##9       | 8444/28280 [00:07<00:22, 871.61it/s]      31%|###       | 8700/28280 [00:07<00:24, 796.62it/s]     32%|###1      | 8956/28280 [00:08<00:20, 934.15it/s]     33%|###2      | 9212/28280 [00:08<00:23, 810.45it/s]     33%|###3      | 9468/28280 [00:08<00:21, 865.94it/s]     34%|###4      | 9724/28280 [00:08<00:19, 933.74it/s]     35%|###5      | 9980/28280 [00:09<00:19, 937.29it/s]     36%|###6      | 10236/28280 [00:09<00:22, 805.82it/s]     37%|###7      | 10492/28280 [00:09<00:21, 841.47it/s]     38%|###8      | 10748/28280 [00:10<00:20, 863.45it/s]     39%|###8      | 11004/28280 [00:10<00:16, 1069.04it/s]     40%|###9      | 11260/28280 [00:10<00:18, 941.53it/s]      41%|####      | 11516/28280 [00:10<00:17, 961.09it/s]     42%|####1     | 11772/28280 [00:11<00:15, 1040.68it/s]     43%|####2     | 12028/28280 [00:11<00:12, 1263.46it/s]     43%|####3     | 12284/28280 [00:11<00:15, 1044.38it/s]     44%|####4     | 12540/28280 [00:11<00:14, 1104.22it/s]     45%|####5     | 12796/28280 [00:11<00:13, 1190.91it/s]     46%|####6     | 13052/28280 [00:12<00:13, 1167.03it/s]     47%|####7     | 13308/28280 [00:12<00:11, 1332.82it/s]     49%|####8     | 13820/28280 [00:12<00:08, 1729.33it/s]     51%|#####     | 14332/28280 [00:12<00:06, 2221.85it/s]     58%|#####7    | 16380/28280 [00:12<00:02, 5392.66it/s]     69%|######8   | 19452/28280 [00:12<00:00, 9612.88it/s]     76%|#######6  | 21500/28280 [00:13<00:00, 11006.82it/s]     83%|########3 | 23548/28280 [00:13<00:00, 11045.90it/s]     91%|######### | 25596/28280 [00:13<00:00, 11220.34it/s]     98%|#########7| 27644/28280 [00:13<00:00, 11459.18it/s]    100%|##########| 28280/28280 [00:13<00:00, 2080.90it/s] 
      0%|          | 0/2 [00:00<?, ?it/s]     50%|#####     | 1/2 [00:00<00:00,  4.06it/s]    100%|##########| 2/2 [00:00<00:00,  4.78it/s]    100%|##########| 2/2 [00:00<00:00,  4.65it/s]
      0%|          | 0/2 [00:00<?, ?it/s]     50%|#####     | 1/2 [00:00<00:00,  5.26it/s]    100%|##########| 2/2 [00:00<00:00,  5.38it/s]    100%|##########| 2/2 [00:00<00:00,  5.36it/s]




.. GENERATED FROM PYTHON SOURCE LINES 135-146

Visualize a montage
----------------------
One way to examine the output of the pyAFQ pipeline is by creating a montage
of images of a particular bundle across a group of participants (or, in this
case, the one participant that was analyzed).

.. note::

  The montage file is copied to the present working directory so that it gets
  properly rendered into the web-page containing this example. It is not
  necessary to do this when running this type of analysis.

.. GENERATED FROM PYTHON SOURCE LINES 146-151

.. code-block:: default


    my_afq.combine_bundle("L_OR")
    montage = my_afq.montage("L_OR", (1, 1), "Axial")
    shutil.copy(montage[0], op.split(montage[0])[-1])




.. image-sg:: /auto_examples/images/sphx_glr_plot_optic_radiations_001.png
   :alt: plot optic radiations
   :srcset: /auto_examples/images/sphx_glr_plot_optic_radiations_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/1 [00:00<?, ?it/s]    100%|##########| 1/1 [00:00<00:00, 11.33it/s]
      0%|          | 0/1 [00:00<?, ?it/s]    100%|##########| 1/1 [00:04<00:00,  4.43s/it]    100%|##########| 1/1 [00:04<00:00,  4.44s/it]

    'bundle-L_OR_view-Axial_idx-0_montage.png'



.. GENERATED FROM PYTHON SOURCE LINES 152-158

Interactive bundle visualization
--------------------------------
Another way to examine the outputs is to export the individual bundle
figures, which show the streamlines, as well as the ROIs used to define the
bundle. This is an html file, which contains an interactive figure that can
be navigated, zoomed, rotated, etc.

.. GENERATED FROM PYTHON SOURCE LINES 158-162

.. code-block:: default


    bundle_html = my_afq.export("indiv_bundles_figures")
    plotly.io.show(bundle_html["NDARAA948VFH"]["L_OR"])




.. raw:: html
    :file: images/sphx_glr_plot_optic_radiations_002.html





.. GENERATED FROM PYTHON SOURCE LINES 163-186

References
----------
.. [1] Caffarra S, Joo SJ, Bloom D, Kruper J, Rokem A, Yeatman JD. Development
    of the visual white matter pathways mediates development of
    electrophysiological responses in visual cortex. Hum Brain Mapp.
    2021;42(17):5785-5797.

.. [2] Caffarra S, Kanopka K, Kruper J, Richie-Halford A, Roy E, Rokem A,
    Yeatman JD. Development of the alpha rhythm is linked to visual white
    matter pathways and visual detection performance. bioRxiv.
    doi:10.1101/2022.09.03.506461

.. [3] Alexander LM, Escalera J, Ai L, et al. An open resource for
    transdiagnostic research in pediatric mental health and learning
    disorders. Sci Data. 2017;4:170181.

.. [4] Richie-Halford A, Cieslak M, Ai L, et al. An analysis-ready and quality
    controlled resource for pediatric brain white-matter research. Scientific
    Data. 2022;9(1):1-27.

.. [5] Cieslak M, Cook PA, He X, et al. QSIPrep: an integrative platform for
    preprocessing and reconstructing diffusion MRI data. Nat Methods.
    2021;18(7):775-778.


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 23 minutes  26.090 seconds)


.. _sphx_glr_download_auto_examples_plot_optic_radiations.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_optic_radiations.py <plot_optic_radiations.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_optic_radiations.ipynb <plot_optic_radiations.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
