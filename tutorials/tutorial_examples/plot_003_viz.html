

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visualizing AFQ derivatives &#8212; AFQ 1.3 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/tutorial_examples/plot_003_viz';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How To" href="../../howto/index.html" />
    <link rel="prev" title="How pyAFQ uses BIDS" href="plot_002_bids_layout.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="AFQ 1.3 documentation - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="AFQ 1.3 documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Getting started with pyAFQ
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../howto/index.html">
                        How To
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../explanations/index.html">
                        Explanations
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../reference/index.html">
                        Reference Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../reference/api/index.html">
                        API Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/yeatmanlab/pyAFQ" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Getting started with pyAFQ
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../howto/index.html">
                        How To
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../explanations/index.html">
                        Explanations
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../reference/index.html">
                        Reference Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../reference/api/index.html">
                        API Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/yeatmanlab/pyAFQ" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Tutorials: getting started with the pyAFQ Python library</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="plot_001_afq_api.html">Getting started programming with pyAFQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_002_bids_layout.html">How pyAFQ uses BIDS</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Visualizing AFQ derivatives</a></li>
</ul>
</li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Getting started with pyAFQ</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Tutorials: getting started with the pyAFQ Python library</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Visualizing...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-tutorials-tutorial-examples-plot-003-viz-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="visualizing-afq-derivatives">
<span id="sphx-glr-tutorials-tutorial-examples-plot-003-viz-py"></span><h1>Visualizing AFQ derivatives<a class="headerlink" href="#visualizing-afq-derivatives" title="Permalink to this heading">#</a></h1>
<p>Visualizing the results of a pyAFQ analysis is useful because it allows us to
inspect the results of the analysis and to communicate the results to others.
The pyAFQ pipeline produces a number of different kinds of outputs, including
visualizations that can be used for quality control and for quick examination
of the results of the analysis.</p>
<p>However, when communicating the results of pyAFQ analysis, it is often useful
to have more specific control over the visualization that is produced. In
addition, it is often useful to have visualizations that are visually appealing
and striking. In this tutorial, we will use the <a class="reference external" href="https://fury.gl/">fury</a>
library <a class="footnote-reference brackets" href="#id4" id="id1">1</a> to visualize outputs of pyAFQ as publication-ready figures.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span> <span class="k">as</span> <span class="nn">op</span>
<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">dipy.io.streamline</span> <span class="kn">import</span> <span class="n">load_trk</span>
<span class="kn">from</span> <span class="nn">dipy.tracking.streamline</span> <span class="kn">import</span> <span class="n">transform_streamlines</span>

<span class="kn">from</span> <span class="nn">fury</span> <span class="kn">import</span> <span class="n">actor</span><span class="p">,</span> <span class="n">window</span>
<span class="kn">from</span> <span class="nn">fury.colormap</span> <span class="kn">import</span> <span class="n">create_colormap</span>

<span class="kn">import</span> <span class="nn">AFQ.data.fetch</span> <span class="k">as</span> <span class="nn">afd</span>
<span class="kn">from</span> <span class="nn">AFQ.viz.utils</span> <span class="kn">import</span> <span class="n">PanelFigure</span>
</pre></div>
</div>
<div class="section" id="get-some-data-from-hbn-pod2">
<h2>Get some data from HBN POD2<a class="headerlink" href="#get-some-data-from-hbn-pod2" title="Permalink to this heading">#</a></h2>
<p>The Healthy Brain Network Preprocessed Open Diffusion Derivatives (HBN POD2)
is a collection of resources based on the Healthy Brain Network dataset
[2, 3]_. HBN POD2 includes data derivatives - including pyAFQ derivatives -
from more than 2,000 subjects. The data and the derivatives can be browsed at
<a class="reference external" href="https://fcp-indi.s3.amazonaws.com/index.html#data/Projects/HBN/BIDS_curated/">https://fcp-indi.s3.amazonaws.com/index.html#data/Projects/HBN/BIDS_curated/</a></p>
<p>Here, we will visualize the results from one subject, together with their
anatomy and using several variations. We start by downloading their
pyAFQ-processed data using fetcher functions that download both the
preprocessed data, as well as the pyAFQ-processed data (Note that this
will take up about 1.75 GB of disk space):</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">afd</span><span class="o">.</span><span class="n">fetch_hbn_preproc</span><span class="p">([</span><span class="s2">&quot;NDARAA948VFH&quot;</span><span class="p">])</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">study_path</span></a> <span class="o">=</span> <span class="n">afd</span><span class="o">.</span><span class="n">fetch_hbn_afq</span><span class="p">([</span><span class="s2">&quot;NDARAA948VFH&quot;</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>

<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">deriv_path</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">study_path</span></a><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">)</span>

<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">afq_path</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">deriv_path</span></a><span class="p">,</span>
    <span class="s1">&#39;afq&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sub-NDARAA948VFH&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ses-HBNsiteRU&#39;</span><span class="p">)</span>

<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">bundle_path</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">afq_path</span></a><span class="p">,</span>
                      <span class="s1">&#39;bundles&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="read-data-into-memory">
<h2>Read data into memory<a class="headerlink" href="#read-data-into-memory" title="Permalink to this heading">#</a></h2>
<p>The bundle coordinates from pyAFQ are always saved in the reference frame of
the diffusion data from which they are generated, so we need an image file
with the dMRI coordinates as a reference for loading the data (we could also
use <cite>“same”</cite> here).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fa_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">afq_path</span></a><span class="p">,</span>
                          <span class="s1">&#39;sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_space-T1w_desc-preproc_dwi_model-DKI_FA.nii.gz&#39;</span><span class="p">))</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fa</span></a> <span class="o">=</span> <span class="n">fa_img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
<span class="n">sft_arc</span> <span class="o">=</span> <span class="n">load_trk</span><span class="p">(</span><a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">bundle_path</span></a><span class="p">,</span>
                           <span class="s1">&#39;sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_space-T1w_desc-preproc_dwi_space-RASMM_model-CSD_desc-prob-afq-ARC_L_tractography.trk&#39;</span><span class="p">),</span> <span class="n">fa_img</span><span class="p">)</span>
<span class="n">sft_cst</span> <span class="o">=</span> <span class="n">load_trk</span><span class="p">(</span><a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">bundle_path</span></a><span class="p">,</span>
                           <span class="s1">&#39;sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_space-T1w_desc-preproc_dwi_space-RASMM_model-CSD_desc-prob-afq-CST_L_tractography.trk&#39;</span><span class="p">),</span> <span class="n">fa_img</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="transform-into-the-t1w-reference-frame">
<h2>Transform into the T1w reference frame<a class="headerlink" href="#transform-into-the-t1w-reference-frame" title="Permalink to this heading">#</a></h2>
<p>Our first goal is to visualize the bundles with a background of the
T1-weighted image, which provides anatomical context. We read in this data and
transform the bundle coordinates, first into the RASMM common coordinate frame
and then subsequently into the coordinate frame of the T1-weighted data (if
you find this confusing, you can brush up on this topic in the
<a class="reference external" href="https://nipy.org/nibabel/coordinate_systems.html">nibabel documentation</a>).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">t1w_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">deriv_path</span></a><span class="p">,</span>
                           <span class="s1">&#39;qsiprep/sub-NDARAA948VFH/anat/sub-NDARAA948VFH_desc-preproc_T1w.nii.gz&#39;</span><span class="p">))</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t1w</span></a> <span class="o">=</span> <span class="n">t1w_img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
<span class="n">sft_arc</span><span class="o">.</span><span class="n">to_rasmm</span><span class="p">()</span>
<span class="n">sft_cst</span><span class="o">.</span><span class="n">to_rasmm</span><span class="p">()</span>
<span class="n">arc_t1w</span> <span class="o">=</span> <span class="n">transform_streamlines</span><span class="p">(</span><span class="n">sft_arc</span><span class="o">.</span><span class="n">streamlines</span><span class="p">,</span>
                                <a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.inv.html#numpy.linalg.inv" title="numpy.linalg.inv" class="sphx-glr-backref-module-numpy-linalg sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span></a><span class="p">(</span><span class="n">t1w_img</span><span class="o">.</span><span class="n">affine</span><span class="p">))</span>
<span class="n">cst_t1w</span> <span class="o">=</span> <span class="n">transform_streamlines</span><span class="p">(</span><span class="n">sft_cst</span><span class="o">.</span><span class="n">streamlines</span><span class="p">,</span>
                                <a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.inv.html#numpy.linalg.inv" title="numpy.linalg.inv" class="sphx-glr-backref-module-numpy-linalg sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span></a><span class="p">(</span><span class="n">t1w_img</span><span class="o">.</span><span class="n">affine</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A virtual frame buffer is needed if you are running this example on
a machine that is not connected to a display (“headless”). If this is
the case, you can either set an environment variable called <cite>XVFB</cite> to <cite>1</cite>
or you can deindent the following code (and comment out the <cite>if</cite> statement)
to initialize the virtual frame buffer.</p>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;XVFB&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initializing XVFB&quot;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">xvfbwrapper</span>
    <span class="kn">from</span> <span class="nn">xvfbwrapper</span> <span class="kn">import</span> <span class="n">Xvfb</span>

    <span class="n">vdisplay</span> <span class="o">=</span> <span class="n">Xvfb</span><span class="p">()</span>
    <span class="n">vdisplay</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Initializing XVFB
</pre></div>
</div>
</div>
<div class="section" id="visualizing-bundles-with-principal-direction-coloring">
<h2>Visualizing bundles with principal direction coloring<a class="headerlink" href="#visualizing-bundles-with-principal-direction-coloring" title="Permalink to this heading">#</a></h2>
<p>The first visualization we will create will have the streamlines colored
according to their direction. The color of each streamline will be RGB encoded
according to the RAS of the average orientation of its segments. This is the
default behavior in fury.</p>
<p>Fury uses “actors” to render different kind of graphics. For the bundles, we
will use the <cite>line</cite> actor. These objects are wrappers around the <a class="reference external" href="https://vtk.org/doc/nightly/html/classvtkActor.html">vtkActor
class</a>, so methods of
that class (like <cite>GetProperty()</cite>) are available to use. We like to set the
aesthetics of the streamlines, so that they are rendered as tubes and with
slightly thicker line-width than the default. We create a function that sets
these properties of the line actor via the <cite>GetProperty</cite> method. We will
reuse this function later on, also setting the key-word arguments to the call
to <cite>actor.line</cite>, but for now we use the default setting, which colors each
streamline based on the RAS orientation, and we set the line width to 8.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">lines_as_tubes</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">line_width</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">line_actor</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">line_actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetRenderLinesAsTubes</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">line_actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetLineWidth</span><span class="p">(</span><span class="n">line_width</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">line_actor</span>


<span class="n">arc_actor</span> <span class="o">=</span> <span class="n">lines_as_tubes</span><span class="p">(</span><span class="n">arc_t1w</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">cst_actor</span> <span class="o">=</span> <span class="n">lines_as_tubes</span><span class="p">(</span><span class="n">cst_t1w</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="slicer-actors">
<h2>Slicer actors<a class="headerlink" href="#slicer-actors" title="Permalink to this heading">#</a></h2>
<p>The anatomical image is rendered using <cite>slicer</cite> actors. These are actors that
visualize one slice of a three dimensional volume. Again, we create a helper
function that will slice a volume along the x, y, and z dimensions. This
function returns a list of the slicers we want to include in our
visualization. This can be one, two, or three slicers, depending on how many
of {x,y,z} are set. If you are curious to understand what is going on in this
function, take a look at the documentation for the
<a href="#id2"><span class="problematic" id="id3">:met:`actor.slicer.display_extent`</span></a> method (hint: for every dimension you
select on, you want the full extent of the image on the two <em>other</em> two
dimensions). We call the function on the T1-weighted data, selecting the # x
slice that is half-way through the x dimension of the image (<cite>shape[0]</cite>) and
the z slice that is a third of a way through that x dimension of the image
(<cite>shape[-1]</cite>).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">slice_volume</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">slicer_actors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">slicer_actor_z</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">slicer</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">slicer_actor_z</span><span class="o">.</span><span class="n">display_extent</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">slicer_actors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slicer_actor_z</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">slicer_actor_y</span> <span class="o">=</span> <span class="n">slicer_actor_z</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">slicer_actor_y</span><span class="o">.</span><span class="n">display_extent</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">slicer_actors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slicer_actor_y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">slicer_actor_x</span> <span class="o">=</span> <span class="n">slicer_actor_z</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">slicer_actor_x</span><span class="o">.</span><span class="n">display_extent</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">slicer_actors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slicer_actor_x</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">slicer_actors</span>


<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slicers</span></a> <span class="o">=</span> <span class="n">slice_volume</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t1w</span></a><span class="p">,</span> <span class="n">x</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t1w</span><span class="o">.</span><span class="n">shape</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t1w</span><span class="o">.</span><span class="n">shape</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="making-a-scene">
<h2>Making a <cite>scene</cite><a class="headerlink" href="#making-a-scene" title="Permalink to this heading">#</a></h2>
<p>The next kind of fury object we will be working with is a <cite>window.Scene</cite>
object. This is the (3D!) canvas on which we are drawing the actors. We
initialize this object and call the <cite>scene.add</cite> method to add the actors.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>

<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">arc_actor</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cst_actor</span><span class="p">)</span>
<span class="k">for</span> <span class="n">slicer</span> <span class="ow">in</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slicers</span></a><span class="p">:</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">slicer</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="showing-the-visualization">
<h2>Showing the visualization<a class="headerlink" href="#showing-the-visualization" title="Permalink to this heading">#</a></h2>
<p>If you are working in an interactive session, you can call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1200</span><span class="p">,</span> <span class="mi">1200</span><span class="p">),</span> <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>to see what the visualization looks like. This would pop up a window that will
show you the visualization as it is now. You can interact with this
visualization using your mouse to rotate the image in 3D, and mouse+ctrl or
mouse+shift to pan and rotate it in plane, respectively. Use the scroll up and
scroll down in your mouse to zoom in and out. Once you have found a view of
the data that you like, you can close the window (as long as its open, it is
blocking execution of any further commands in the Python interpreter!) and
then you can query your scene for the “camera settings” by calling:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span><span class="o">.</span><span class="n">camera_info</span><span class="p">()</span>
</pre></div>
</div>
<p>This will print out to the screen something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Active Camera</span>
   <span class="n">Position</span> <span class="p">(</span><span class="mf">238.04</span><span class="p">,</span> <span class="mf">174.48</span><span class="p">,</span> <span class="mf">143.04</span><span class="p">)</span>
   <span class="n">Focal</span> <span class="n">Point</span> <span class="p">(</span><span class="mf">96.32</span><span class="p">,</span> <span class="mf">110.34</span><span class="p">,</span> <span class="mf">84.48</span><span class="p">)</span>
   <span class="n">View</span> <span class="n">Up</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.33</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.94</span><span class="p">)</span>
</pre></div>
</div>
<p>We can use the information we have gleaned to set the camera on subsequent
visualization that use this scene object.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">238.04</span><span class="p">,</span> <span class="mf">174.48</span><span class="p">,</span> <span class="mf">143.04</span><span class="p">),</span>
                 <span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="mf">96.32</span><span class="p">,</span> <span class="mf">110.34</span><span class="p">,</span> <span class="mf">84.48</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.33</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.94</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="record-the-visualization">
<h2>Record the visualization<a class="headerlink" href="#record-the-visualization" title="Permalink to this heading">#</a></h2>
<p>If you are not working in an interactive session, or you have already figured
out the camera settings that work for you, you can go ahead and record the
image into a png file. We use a pretty high resolution here (2400 by 2400) so
that we get a nice crisp image. That also means the file is pretty large.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out_folder</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">afd</span><span class="o">.</span><span class="n">afq_home</span></a><span class="p">,</span> <span class="s2">&quot;VizExample&quot;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/os.html#os.makedirs" title="os.makedirs" class="sphx-glr-backref-module-os sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out_folder</span></a><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span>
    <span class="n">scene</span><span class="p">,</span>
    <span class="n">out_path</span><span class="o">=</span><a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out_folder</span></a><span class="p">,</span> <span class="s1">&#39;arc_cst1.png&#39;</span><span class="p">),</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2400</span><span class="p">,</span> <span class="mi">2400</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-bundle-colors">
<h2>Setting bundle colors<a class="headerlink" href="#setting-bundle-colors" title="Permalink to this heading">#</a></h2>
<p>The default behavior produces a nice image! But we often want to be able to
differentiate streamlines based on the bundle to which they belong. For this,
we will set the color of each streamline, based on the bundle. We often use
the Tableau20 color palette to set the colors for the different bundles. The
<cite>actor.line</cite> initializer takes <cite>colors</cite> as a keyword argument and one of the
options to pass here is an RGB triplet, which will determine the color of all
of the streamlines in that actor. We can get the Tableau20 RGB triplets from
Matplotlib’s colormap module. We initialize our bundle actors again and clear
the scene before adding these new actors and adding back the slice actors. We
then call <cite>record</cite> to create this new figure.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.cm</span> <span class="kn">import</span> <span class="n">tab20</span>
<a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">color_arc</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">tab20</span><span class="o">.</span><span class="n">colors</span></a><span class="p">[</span><span class="mi">18</span><span class="p">]</span>
<a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">color_cst</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">tab20</span><span class="o">.</span><span class="n">colors</span></a><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="n">arc_actor</span> <span class="o">=</span> <span class="n">lines_as_tubes</span><span class="p">(</span><span class="n">arc_t1w</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">color_arc</span></a><span class="p">)</span>
<span class="n">cst_actor</span> <span class="o">=</span> <span class="n">lines_as_tubes</span><span class="p">(</span><span class="n">cst_t1w</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">color_cst</span></a><span class="p">)</span>

<span class="n">scene</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">arc_actor</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cst_actor</span><span class="p">)</span>
<span class="k">for</span> <span class="n">slicer</span> <span class="ow">in</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slicers</span></a><span class="p">:</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">slicer</span><span class="p">)</span>

<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span>
    <span class="n">scene</span><span class="p">,</span>
    <span class="n">out_path</span><span class="o">=</span><a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out_folder</span></a><span class="p">,</span> <span class="s1">&#39;arc_cst2.png&#39;</span><span class="p">),</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2400</span><span class="p">,</span> <span class="mi">2400</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-core-bundles-with-tract-profiles">
<h2>Adding core bundles with tract profiles<a class="headerlink" href="#adding-core-bundles-with-tract-profiles" title="Permalink to this heading">#</a></h2>
<p>Next, we’d like to add a representation of the core of each bundle and plot
the profile of some property along the length of the bundle. Another option
for setting streamline colors is for each point along a streamline to have a a
different color. Here, we will do this with only one streamline, which
represents the core of the fiber – it’s median trajectory, and with a profile
of the FA. This requires a few distinct steps. The first is adding another
actor for each of the core fibers. We determine the core bundle as the median
of the coordinates of the streamlines after each streamline is resampled to
100 equi-distant points. In the next step, we extract the FA profiles for each
of the bundles, using the <cite>afq_profile</cite> function. Before we do this, we make
sure that the streamlines are back in the voxel coordinate frame of the FA
volume. The core bundle and FA profile are put together into a new line actor,
which we initialize as a thick tube (line width of 40) and with a call to
create a colormap from the FA profiles (we can choose which color-map to use
here. In this case, we chose <cite>‘viridis’</cite>). Note that because we are passing
only one streamline into the line actor, we have to pass it inside of square
brackets (<cite>[]</cite>). This is because the <cite>actor.line</cite> initializer expects a
sequence of streamlines as input. Before plotting things again, we initialize
our bundle line actors again. This time, we set the opacity of the lines to
0.1, so that they do not occlude the view of the core bundle visualizations.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this case, the profile is FA, but you can use any sequence of 100
numbers in place of the FA profiles: group differences, p-values, etc.</p>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dipy.tracking.streamline</span> <span class="kn">import</span> <span class="n">set_number_of_points</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">core_arc</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.median.html#numpy.median" title="numpy.median" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">median</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.asarray.html#numpy.asarray" title="numpy.asarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">asarray</span></a><span class="p">(</span><span class="n">set_number_of_points</span><span class="p">(</span><span class="n">arc_t1w</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">core_cst</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.median.html#numpy.median" title="numpy.median" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">median</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.asarray.html#numpy.asarray" title="numpy.asarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">asarray</span></a><span class="p">(</span><span class="n">set_number_of_points</span><span class="p">(</span><span class="n">cst_t1w</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="kn">from</span> <span class="nn">dipy.stats.analysis</span> <span class="kn">import</span> <span class="n">afq_profile</span>
<span class="n">sft_arc</span><span class="o">.</span><span class="n">to_vox</span><span class="p">()</span>
<span class="n">sft_cst</span><span class="o">.</span><span class="n">to_vox</span><span class="p">()</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">arc_profile</span></a> <span class="o">=</span> <span class="n">afq_profile</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fa</span></a><span class="p">,</span> <span class="n">sft_arc</span><span class="o">.</span><span class="n">streamlines</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.eye.html#numpy.eye" title="numpy.eye" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">eye</span></a><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cst_profile</span></a> <span class="o">=</span> <span class="n">afq_profile</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fa</span></a><span class="p">,</span> <span class="n">sft_cst</span><span class="o">.</span><span class="n">streamlines</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.eye.html#numpy.eye" title="numpy.eye" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">eye</span></a><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="n">core_arc_actor</span> <span class="o">=</span> <span class="n">lines_as_tubes</span><span class="p">(</span>
    <span class="p">[</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">core_arc</span></a><span class="p">],</span>
    <span class="mi">40</span><span class="p">,</span>
    <span class="n">colors</span><span class="o">=</span><span class="n">create_colormap</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">arc_profile</span></a><span class="p">,</span> <span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">core_cst_actor</span> <span class="o">=</span> <span class="n">lines_as_tubes</span><span class="p">(</span>
    <span class="p">[</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">core_cst</span></a><span class="p">],</span>
    <span class="mi">40</span><span class="p">,</span>
    <span class="n">colors</span><span class="o">=</span><span class="n">create_colormap</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cst_profile</span></a><span class="p">,</span> <span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">scene</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<span class="n">arc_actor</span> <span class="o">=</span> <span class="n">lines_as_tubes</span><span class="p">(</span><span class="n">arc_t1w</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">color_arc</span></a><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">cst_actor</span> <span class="o">=</span> <span class="n">lines_as_tubes</span><span class="p">(</span><span class="n">cst_t1w</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">color_cst</span></a><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">arc_actor</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cst_actor</span><span class="p">)</span>
<span class="k">for</span> <span class="n">slicer</span> <span class="ow">in</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slicers</span></a><span class="p">:</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">slicer</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">core_arc_actor</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">core_cst_actor</span><span class="p">)</span>

<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span>
    <span class="n">scene</span><span class="p">,</span>
    <span class="n">out_path</span><span class="o">=</span><a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out_folder</span></a><span class="p">,</span> <span class="s1">&#39;arc_cst3.png&#39;</span><span class="p">),</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2400</span><span class="p">,</span> <span class="mi">2400</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-rois">
<h2>Adding ROIs<a class="headerlink" href="#adding-rois" title="Permalink to this heading">#</a></h2>
<p>Another element that we can add into the visualization are volume renderings
of regions of interest. For example, the waypoint ROIs that were used to
define the bundles. Here, we will add the waypoints that were used to define
the arcuate fasciculus in this subject. We start by reading this data in.
Because it is represented in the space of the diffusion data, it too needs to
be resampled into the T1-weighted space, before being visualized. After
resampling, we might have some values between 0 and 1 because of the
interpolation from the low resolution of the diffusion into the high
resolution of the T1-weighted. We will include in the volume rendering any
values larger than 0. The main change from the previous visualizations is the
adition of a <cite>contour_from_roi</cite> actor for each of the ROIs. We select another
color from the Tableau 20 palette to represent this, and use an opacity of
0.5.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this case, the surface rendered is of the waypoint ROIs, but very
similar code can be used to render other surfaces, provided a volume that
contains that surface. For example, the gray-white matter boundary could
be visualized provided an array with a binary representation of the volume #   enclosed in this boundary</p>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dipy.align</span> <span class="kn">import</span> <span class="n">resample</span>

<span class="n">waypoint1</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span>
        <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">afq_path</span></a><span class="p">,</span>
        <span class="s2">&quot;ROIs&quot;</span><span class="p">,</span> <span class="s2">&quot;sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_space-T1w_desc-preproc_dwi_desc-ROI-ARC_L-1-include.nii.gz&quot;</span><span class="p">))</span>

<span class="n">waypoint2</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span>
        <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">afq_path</span></a><span class="p">,</span>
        <span class="s2">&quot;ROIs&quot;</span><span class="p">,</span> <span class="s2">&quot;sub-NDARAA948VFH_ses-HBNsiteRU_acq-64dir_space-T1w_desc-preproc_dwi_desc-ROI-ARC_L-2-include.nii.gz&quot;</span><span class="p">))</span>

<span class="n">waypoint1_xform</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">waypoint1</span><span class="p">,</span> <span class="n">t1w_img</span><span class="p">)</span>
<span class="n">waypoint2_xform</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">waypoint2</span><span class="p">,</span> <span class="n">t1w_img</span><span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">waypoint1_data</span></a> <span class="o">=</span> <span class="n">waypoint1_xform</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">waypoint2_data</span></a> <span class="o">=</span> <span class="n">waypoint2_xform</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>

<span class="n">scene</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<span class="n">arc_actor</span> <span class="o">=</span> <span class="n">lines_as_tubes</span><span class="p">(</span><span class="n">arc_t1w</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">color_arc</span></a><span class="p">)</span>
<span class="n">cst_actor</span> <span class="o">=</span> <span class="n">lines_as_tubes</span><span class="p">(</span><span class="n">cst_t1w</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">color_cst</span></a><span class="p">)</span>

<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">arc_actor</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cst_actor</span><span class="p">)</span>
<span class="k">for</span> <span class="n">slicer</span> <span class="ow">in</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slicers</span></a><span class="p">:</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">slicer</span><span class="p">)</span>

<a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">surface_color</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">tab20</span><span class="o">.</span><span class="n">colors</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">waypoint1_actor</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">contour_from_roi</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">waypoint1_data</span></a><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">surface_color</span></a><span class="p">,</span>
                                         <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">waypoint2_actor</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">contour_from_roi</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">waypoint2_data</span></a><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">surface_color</span></a><span class="p">,</span>
                                         <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">waypoint1_actor</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">waypoint2_actor</span><span class="p">)</span>


<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span>
    <span class="n">scene</span><span class="p">,</span>
    <span class="n">out_path</span><span class="o">=</span><a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out_folder</span></a><span class="p">,</span> <span class="s1">&#39;arc_cst4.png&#39;</span><span class="p">),</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2400</span><span class="p">,</span> <span class="mi">2400</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="making-a-figure-out-of-many-fury-panels">
<h2>Making a Figure out of many fury panels<a class="headerlink" href="#making-a-figure-out-of-many-fury-panels" title="Permalink to this heading">#</a></h2>
<p>We can also make a figure that contains multiple panels, each of which
contains a different visualization. This is useful for communicating the
results of an analysis. Here, we will make a figure with four panels, using
some of the visualizations we have already created. We will use some
convenient methods from pyAFQ.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">pf</span> <span class="o">=</span> <span class="n">PanelFigure</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">pf</span><span class="o">.</span><span class="n">add_img</span><span class="p">(</span><a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out_folder</span></a><span class="p">,</span> <span class="s1">&#39;arc_cst1.png&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">pf</span><span class="o">.</span><span class="n">add_img</span><span class="p">(</span><a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out_folder</span></a><span class="p">,</span> <span class="s1">&#39;arc_cst2.png&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">pf</span><span class="o">.</span><span class="n">add_img</span><span class="p">(</span><a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out_folder</span></a><span class="p">,</span> <span class="s1">&#39;arc_cst3.png&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">pf</span><span class="o">.</span><span class="n">add_img</span><span class="p">(</span><a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">op</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out_folder</span></a><span class="p">,</span> <span class="s1">&#39;arc_cst4.png&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">pf</span><span class="o">.</span><span class="n">format_and_save_figure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;arc_cst_fig.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_003_viz_001.png" srcset="../../_images/sphx_glr_plot_003_viz_001.png" alt="plot 003 viz" class = "sphx-glr-single-img"/><img src="../../_images/sphx_glr_plot_003_viz_002.png" srcset="../../_images/sphx_glr_plot_003_viz_002.png" alt="plot 003 viz" class = "sphx-glr-single-img"/><div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a virtual buffer was started before, it’s a good idea to stop it.</p>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;XVFB&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stopping XVFB&quot;</span><span class="p">)</span>
    <span class="n">vdisplay</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Stopping XVFB
</pre></div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Garyfallidis et al., (2021). FURY: advanced scientific visualization.
Journal of Open Source Software, 6(64), 3384,
<a class="reference external" href="https://doi.org/10.21105/joss.03384">https://doi.org/10.21105/joss.03384</a></p>
</dd>
<dt class="label" id="id5"><span class="brackets">2</span></dt>
<dd><p>Alexander LM, Escalera J, Ai L, et al. An open resource for
transdiagnostic research in pediatric mental health and learning
disorders. Sci Data. 2017;4:170181.</p>
</dd>
<dt class="label" id="id6"><span class="brackets">3</span></dt>
<dd><p>Richie-Halford A, Cieslak M, Ai L, et al. An analysis-ready and
quality controlled resource for pediatric brain white-matter research.
Scientific Data. 2022;9(1):1-27.</p>
</dd>
</dl>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 23.299 seconds)</p>
<p><strong>Estimated memory usage:</strong>  24 MB</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-tutorials-tutorial-examples-plot-003-viz-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/51718fa6a298d00d5d4fc0d7c821fc27/plot_003_viz.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_003_viz.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/21991433a5d29effa4e65e9a47e76915/plot_003_viz.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_003_viz.py</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="plot_002_bids_layout.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">How pyAFQ uses BIDS</p>
      </div>
    </a>
    <a class="right-next"
       href="../../howto/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">How To</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#get-some-data-from-hbn-pod2">Get some data from HBN POD2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-data-into-memory">Read data into memory</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transform-into-the-t1w-reference-frame">Transform into the T1w reference frame</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-bundles-with-principal-direction-coloring">Visualizing bundles with principal direction coloring</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#slicer-actors">Slicer actors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#making-a-scene">Making a <cite>scene</cite></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#showing-the-visualization">Showing the visualization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#record-the-visualization">Record the visualization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-bundle-colors">Setting bundle colors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-core-bundles-with-tract-profiles">Adding core bundles with tract profiles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-rois">Adding ROIs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#making-a-figure-out-of-many-fury-panels">Making a Figure out of many fury panels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/yeatmanlab/pyAFQ/edit/master/docs/source/tutorials/tutorial_examples/plot_003_viz.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../_sources/tutorials/tutorial_examples/plot_003_viz.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>


  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2018--, The pyAFQ Contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-156363454-2");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>