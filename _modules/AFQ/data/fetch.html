

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AFQ.data.fetch &#8212; AFQ 1.2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" />
  <script src="../../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/AFQ/data/fetch';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <header>
  
    <div class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.png" class="logo__image only-light" alt="AFQ 1.2 documentation - Home"/>
    <script>document.write(`<img src="../../../_static/logo.png" class="logo__image only-dark" alt="AFQ 1.2 documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../tutorials/index.html">
                        Getting started with pyAFQ
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../howto/index.html">
                        How To
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../explanations/index.html">
                        Explanations
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../reference/index.html">
                        Reference Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../reference/api/index.html">
                        API Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/yeatmanlab/pyAFQ" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </div>
  
  </header>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../tutorials/index.html">
                        Getting started with pyAFQ
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../howto/index.html">
                        How To
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../explanations/index.html">
                        Explanations
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../reference/index.html">
                        Reference Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../reference/api/index.html">
                        API Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/yeatmanlab/pyAFQ" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    
    <li class="breadcrumb-item"><a href="../../AFQ.html" class="nav-link">AFQ</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">AFQ.data.fetch</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for AFQ.data.fetch</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">dipy.align</span> <span class="kn">import</span> <span class="n">resample</span>
<span class="kn">from</span> <span class="nn">dipy.segment.clustering</span> <span class="kn">import</span> <span class="n">QuickBundles</span>
<span class="kn">from</span> <span class="nn">dipy.segment.metric</span> <span class="kn">import</span> <span class="n">AveragePointwiseEuclideanMetric</span>
<span class="kn">from</span> <span class="nn">dipy.segment.featurespeed</span> <span class="kn">import</span> <span class="n">ResampleFeature</span>
<span class="kn">from</span> <span class="nn">dipy.io.streamline</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">load_tractogram</span><span class="p">,</span> <span class="n">save_tractogram</span><span class="p">,</span> <span class="n">StatefulTractogram</span><span class="p">,</span> <span class="n">Space</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">dipy.data.fetcher</span> <span class="kn">import</span> <span class="n">_make_fetcher</span>
<span class="kn">import</span> <span class="nn">dipy.data</span> <span class="k">as</span> <span class="nn">dpd</span>
<span class="kn">from</span> <span class="nn">AFQ.utils.path</span> <span class="kn">import</span> <span class="n">drop_extension</span><span class="p">,</span> <span class="n">apply_cmd_to_afq_derivs</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span> <span class="k">as</span> <span class="nn">op</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">from</span> <span class="nn">botocore</span> <span class="kn">import</span> <span class="n">UNSIGNED</span>
<span class="kn">from</span> <span class="nn">botocore.client</span> <span class="kn">import</span> <span class="n">Config</span>


<span class="c1"># capture templateflow resource warning and log</span>
<span class="n">default_warning_format</span> <span class="o">=</span> <span class="n">warnings</span><span class="o">.</span><span class="n">formatwarning</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">formatwarning</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">captureWarnings</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pywarnings_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;py.warnings&#39;</span><span class="p">)</span>
    <span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">BASIC_FORMAT</span><span class="p">))</span>
    <span class="n">pywarnings_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>

    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
        <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">ResourceWarning</span><span class="p">,</span>
        <span class="n">module</span><span class="o">=</span><span class="s2">&quot;templateflow&quot;</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">templateflow</span> <span class="kn">import</span> <span class="n">api</span> <span class="k">as</span> <span class="n">tflow</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">captureWarnings</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">formatwarning</span> <span class="o">=</span> <span class="n">default_warning_format</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fetch_callosum_templates&quot;</span><span class="p">,</span> <span class="s2">&quot;read_callosum_templates&quot;</span><span class="p">,</span>
           <span class="s2">&quot;fetch_or_templates&quot;</span><span class="p">,</span> <span class="s2">&quot;read_or_templates&quot;</span><span class="p">,</span>
           <span class="s2">&quot;fetch_templates&quot;</span><span class="p">,</span> <span class="s2">&quot;read_templates&quot;</span><span class="p">,</span>
           <span class="s2">&quot;fetch_stanford_hardi_tractography&quot;</span><span class="p">,</span>
           <span class="s2">&quot;read_stanford_hardi_tractography&quot;</span><span class="p">,</span>
           <span class="s2">&quot;organize_stanford_data&quot;</span><span class="p">,</span>
           <span class="s2">&quot;fetch_stanford_hardi_lv1&quot;</span><span class="p">]</span>


<span class="c1"># Set a user-writeable file-system location to put files:</span>
<span class="k">if</span> <span class="s1">&#39;AFQ_HOME&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">afq_home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AFQ_HOME&#39;</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">afq_home</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">),</span> <span class="s1">&#39;AFQ_data&#39;</span><span class="p">)</span>

<span class="n">baseurl</span> <span class="o">=</span> <span class="s2">&quot;https://ndownloader.figshare.com/files/&quot;</span>


<span class="k">def</span> <span class="nf">_make_reusable_fetcher</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">baseurl</span><span class="p">,</span> <span class="n">remote_fnames</span><span class="p">,</span> <span class="n">local_fnames</span><span class="p">,</span>
                           <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">md5_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">make_fetcher_kwargs</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fetcher</span><span class="p">():</span>
        <span class="n">all_files_downloaded</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">local_fnames</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">fname</span><span class="p">)):</span>
                <span class="n">all_files_downloaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">all_files_downloaded</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">remote_fnames</span><span class="p">,</span> <span class="n">local_fnames</span><span class="p">)):</span>
                <span class="n">files</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">baseurl</span> <span class="o">+</span> <span class="n">f</span><span class="p">,</span> <span class="n">md5_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span>
                            <span class="n">md5_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">files</span><span class="p">,</span> <span class="n">folder</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_make_fetcher</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">baseurl</span><span class="p">,</span> <span class="n">remote_fnames</span><span class="p">,</span> <span class="n">local_fnames</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="o">**</span><span class="n">make_fetcher_kwargs</span><span class="p">)()</span>
    <span class="n">fetcher</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">fetcher</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>
    <span class="k">return</span> <span class="n">fetcher</span>


<span class="k">def</span> <span class="nf">_fetcher_to_template</span><span class="p">(</span><span class="n">fetcher</span><span class="p">,</span> <span class="n">as_img</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resample_to</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resample_to</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">resample_to</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">resample_to</span><span class="p">)</span>
    <span class="n">files</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">fetcher</span><span class="p">()</span>
    <span class="n">template_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">as_img</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resample_to</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">resample</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">(),</span>
                                           <span class="n">resample_to</span><span class="p">,</span>
                                           <span class="n">img</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span>
                                           <span class="n">resample_to</span><span class="o">.</span><span class="n">affine</span><span class="p">)</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">(),</span>
                                  <span class="n">resample_to</span><span class="o">.</span><span class="n">affine</span><span class="p">)</span>
        <span class="n">template_dict</span><span class="p">[</span><span class="n">drop_extension</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span> <span class="o">=</span> <span class="n">img</span>
    <span class="k">return</span> <span class="n">template_dict</span>


<span class="n">callosum_fnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Callosum_midsag.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;L_AntFrontal.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;L_Motor.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;L_Occipital.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;L_Orbital.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;L_PostParietal.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;L_SupFrontal.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;L_SupParietal.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;L_Temporal.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;R_AntFrontal.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;R_Motor.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;R_Occipital.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;R_Orbital.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;R_PostParietal.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;R_SupFrontal.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;R_SupParietal.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;R_Temporal.nii.gz&quot;</span><span class="p">]</span>

<span class="n">callosum_remote_fnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;5273794&quot;</span><span class="p">,</span> <span class="s2">&quot;5273797&quot;</span><span class="p">,</span> <span class="s2">&quot;5273800&quot;</span><span class="p">,</span> <span class="s2">&quot;5273803&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;5273806&quot;</span><span class="p">,</span> <span class="s2">&quot;5273809&quot;</span><span class="p">,</span> <span class="s2">&quot;5273812&quot;</span><span class="p">,</span> <span class="s2">&quot;5273815&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;5273821&quot;</span><span class="p">,</span> <span class="s2">&quot;5273818&quot;</span><span class="p">,</span> <span class="s2">&quot;5273824&quot;</span><span class="p">,</span> <span class="s2">&quot;5273827&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;5273830&quot;</span><span class="p">,</span> <span class="s2">&quot;5273833&quot;</span><span class="p">,</span> <span class="s2">&quot;5273836&quot;</span><span class="p">,</span> <span class="s2">&quot;5273839&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;5273842&quot;</span><span class="p">]</span>

<span class="n">callosum_md5_hashes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;709fa90baadeacd64f1d62b5049a4125&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;987c6169de807c4e93dc2cbd7a25d506&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;0da114123d0b0097b96fe450a459550b&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;6d845bd10504f67f1dc17f9000076d7e&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;e16c7873ef4b08d26b77ef746dab8237&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;47193fd4df1ea17367817466de798b90&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;7e78bf9671e6945f4b2f5e7c30595a3c&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;8adbb947377ff7b484c88d8c0ffc2125&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;0fd981a4d0847e0642ff96e84fe44e47&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;87c4855efa406d8fb004cffb8259180e&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;c7969bcf5f2343fd9ce9c49b336cf14c&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;bb4372b88991932150205ffb22aa6cb7&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;d198d4e7db18ddc7236cf143ecb8342e&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;d0f6edef64b0c710c92e634496085dda&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;85eaee44665f244db5adae2e259833f6&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;25f24eb22879a05d12bda007c81ea55a&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;2664e0b8c2d9c59f13649a89bfcce399&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="fetch_callosum_templates"><a class="viewcode-back" href="../../../reference/api/AFQ/data/fetch/index.html#AFQ.data.fetch.fetch_callosum_templates">[docs]</a><span class="n">fetch_callosum_templates</span> <span class="o">=</span> <span class="n">_make_reusable_fetcher</span><span class="p">(</span>
    <span class="s2">&quot;fetch_callosum_templates&quot;</span><span class="p">,</span>
    <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span>
            <span class="s1">&#39;callosum_templates&#39;</span><span class="p">),</span>
    <span class="n">baseurl</span><span class="p">,</span> <span class="n">callosum_remote_fnames</span><span class="p">,</span>
    <span class="n">callosum_fnames</span><span class="p">,</span>
    <span class="n">md5_list</span><span class="o">=</span><span class="n">callosum_md5_hashes</span><span class="p">,</span>
    <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Download AFQ callosum templates&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_callosum_templates"><a class="viewcode-back" href="../../../reference/api/AFQ/data/fetch/index.html#AFQ.data.fetch.read_callosum_templates">[docs]</a><span class="k">def</span> <span class="nf">read_callosum_templates</span><span class="p">(</span><span class="n">as_img</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resample_to</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load AFQ callosum templates from file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    as_img : bool, optional</span>
<span class="sd">        If True, values are `Nifti1Image`. Otherwise, values are</span>
<span class="sd">        paths to Nifti files. Default: True</span>
<span class="sd">    resample_to : str or nibabel image class instance, optional</span>
<span class="sd">        A template image to resample to. Typically, this should be the</span>
<span class="sd">        template to which individual-level data are registered. Defaults to</span>
<span class="sd">        the MNI template. Default: False</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict with: keys: names of template ROIs and values: nibabel Nifti1Image</span>
<span class="sd">    objects from each of the ROI nifti files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;AFQ&#39;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;loading callosum templates&#39;</span><span class="p">)</span>
    <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

    <span class="n">template_dict</span> <span class="o">=</span> <span class="n">_fetcher_to_template</span><span class="p">(</span>
        <span class="n">fetch_callosum_templates</span><span class="p">,</span>
        <span class="n">as_img</span><span class="o">=</span><span class="n">as_img</span><span class="p">,</span>
        <span class="n">resample_to</span><span class="o">=</span><span class="n">resample_to</span><span class="p">)</span>

    <span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;callosum templates loaded in </span><span class="si">{</span><span class="n">toc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tic</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">template_dict</span></div>


<span class="c1">##########################################################################</span>
<span class="c1"># Pediatric templates:</span>
<span class="c1"># --------------------</span>
<span class="c1">#</span>
<span class="c1"># Templates include the UNC 0-1-2 Infant Atlases and waypoint ROIs matched</span>
<span class="c1"># to the atlas.</span>
<span class="c1">#</span>
<span class="c1"># Information on:</span>
<span class="c1">#</span>
<span class="c1"># - atlas: https://www.nitrc.org/projects/pediatricatlas</span>
<span class="c1">#</span>
<span class="c1"># - pediatric templates: https://github.com/yeatmanlab/AFQ/tree/babyAFQ</span>
<span class="c1">#</span>
<span class="c1"># Templates downloaded from:</span>
<span class="c1">#</span>
<span class="c1"># - https://figshare.com/articles/dataset/ROIs_probabilistic_maps_and_transform_data_for_pediatric_automated_fiber_quantification/13027487  # noqa</span>
<span class="c1">#</span>

<span class="n">pediatric_fnames</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;ATR_roi1_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;ATR_roi1_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATR_roi2_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;ATR_roi2_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATR_roi3_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;ATR_roi3_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CGC_roi1_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;CGC_roi1_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CGC_roi2_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;CGC_roi2_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CGC_roi3_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;CGC_roi3_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CST_roi1_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;CST_roi1_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CST_roi2_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;CST_roi2_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FA_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;FA_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FP_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;FP_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HCC_roi1_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;HCC_roi1_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HCC_roi2_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;HCC_roi2_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IFO_roi1_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;IFO_roi1_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IFO_roi2_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;IFO_roi2_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IFO_roi3_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;IFO_roi3_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ILF_roi1_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;ILF_roi1_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ILF_roi2_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;ILF_roi2_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LH_Parietal.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;RH_Parietal.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MdLF_roi1_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;MdLF_roi1_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SLF_roi1_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;SLF_roi1_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SLF_roi2_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;SLF_roi2_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SLFt_roi2_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;SLFt_roi2_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SLFt_roi3_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;SLFt_roi3_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;UNC_roi1_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;UNC_roi1_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;UNC_roi2_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;UNC_roi2_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;UNC_roi3_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;UNC_roi3_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;VOF_box_L.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;VOF_box_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;UNCNeo-withCerebellum-for-babyAFQ.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;UNCNeo_JHU_tracts_prob-for-babyAFQ.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mid-saggital.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OR_rightV1.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OR_rightThal.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OR_right_roi3.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OR_leftV1.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OR_leftThal.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OR_left_roi3.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pARC_R_start.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pARC_L_start.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;VOF_box_small_L.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;VOF_box_small_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;VOF_L_start.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;VOF_R_start.nii.gz&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">pediatric_md5_hashes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;2efe0deb19ac9e175404bf0cb29d9dbd&quot;</span><span class="p">,</span> <span class="s2">&quot;c2e07cd50699527bd7b0cbbe88703c56&quot;</span><span class="p">,</span>
    <span class="s2">&quot;76b36d8d6759df58131644281ed16bd2&quot;</span><span class="p">,</span> <span class="s2">&quot;645102225bad33da30bafd41d24b3ab0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;45ec94d42fdc9448afa6760c656920e9&quot;</span><span class="p">,</span> <span class="s2">&quot;54e3cb1b8c242be279f1410d8bb3c383&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1ee9f7e8b21ef8ceee81d5a7a178ef33&quot;</span><span class="p">,</span> <span class="s2">&quot;4f11097f7ae317aa8d612511be79e2f1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1c4c0823c23b676d6d35004d93b9c695&quot;</span><span class="p">,</span> <span class="s2">&quot;d4830d558cc8f707ebec912b32d197a5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;c405e0dbd9a4091c77b3d1ad200229b4&quot;</span><span class="p">,</span> <span class="s2">&quot;ec0aeccc6661d2ee5ed79259383cdcee&quot;</span><span class="p">,</span>
    <span class="s2">&quot;2802cd227b550f6e85df0fec1d515c29&quot;</span><span class="p">,</span> <span class="s2">&quot;385addb999dc6d76957d2a35c4ee74bb&quot;</span><span class="p">,</span>
    <span class="s2">&quot;b79f01829bd95682faaf545c72b1d52c&quot;</span><span class="p">,</span> <span class="s2">&quot;b79f01829bd95682faaf545c72b1d52c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;e49ba370edca96734d9376f551d413db&quot;</span><span class="p">,</span> <span class="s2">&quot;f59e9e69e06325198f70047cd63c3bdc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ae3bd2931f95adae0280a8f75cd3ca9b&quot;</span><span class="p">,</span> <span class="s2">&quot;c409a0036b8c2dd4d03d11fbc6bfbdcd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;c2597a474ea5ec9e3126c35fd238f6b2&quot;</span><span class="p">,</span> <span class="s2">&quot;67af59c934147c9f9ff6e0b76c4cc6eb&quot;</span><span class="p">,</span>
    <span class="s2">&quot;72d0bbc0b6162e9291fdc450c103a1f0&quot;</span><span class="p">,</span> <span class="s2">&quot;51f5041be63ad0ac10d1ac09e3bf1a8e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;6200f5cdc1402dce46dedd505468b147&quot;</span><span class="p">,</span> <span class="s2">&quot;83cb5bf6b9b1eda63c8643871e84a6d4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;2a5d8d309b1256d6e48958e112201c2c&quot;</span><span class="p">,</span> <span class="s2">&quot;ba24d0915fdff215a403480d0a7745c9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1001e833d1344274d543ffd02a66af80&quot;</span><span class="p">,</span> <span class="s2">&quot;03e20c5eebcd4d439c4ffb36d26a10d9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;6200f5cdc1402dce46dedd505468b147&quot;</span><span class="p">,</span> <span class="s2">&quot;83cb5bf6b9b1eda63c8643871e84a6d4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;a6ae325cce2dc4bb21b52ee4c6ca844f&quot;</span><span class="p">,</span> <span class="s2">&quot;a96a31df8f96ccf1c5f871a18e4a2d72&quot;</span><span class="p">,</span>
    <span class="s2">&quot;65b7378ca85689a5f23b1b84a6ed78f0&quot;</span><span class="p">,</span> <span class="s2">&quot;ce0d0ea696ef51c671aa118e11192e2d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ce4918086ca1e829698576bcf95db62b&quot;</span><span class="p">,</span> <span class="s2">&quot;96168d2eff74ec2acf9065f499732526&quot;</span><span class="p">,</span>
    <span class="s2">&quot;6b20ba319d44472ec21d6ece937605bb&quot;</span><span class="p">,</span> <span class="s2">&quot;26b1cf6ec8bd365dde42e3efe9beeac2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;0b3ccf06564d973bfcfff9a87e74f8b5&quot;</span><span class="p">,</span> <span class="s2">&quot;84f3426033a2b225b0920b2622864375&quot;</span><span class="p">,</span>
    <span class="s2">&quot;5351b3cb7efa9aa8e83e266342809ebe&quot;</span><span class="p">,</span> <span class="s2">&quot;4e8a34aaba4e0f22a6149f38620dc39d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;682c08f66e8c2cf9e4e60f5ce308c76c&quot;</span><span class="p">,</span> <span class="s2">&quot;9077affd4f3a8a1d6b44678cde4b3bf4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;5adf36f00669cc547d5eb978acf46266&quot;</span><span class="p">,</span> <span class="s2">&quot;66a8002688ffdf3943722361da90ec6a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;efb5ae138df92019541861f9aa6a4d57&quot;</span><span class="p">,</span> <span class="s2">&quot;757ec61078b2e9f9a073871b3216ff7a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ff1e238c52a21f8cc5d44ac614d9627f&quot;</span><span class="p">,</span> <span class="s2">&quot;cf16dd2767c6ab2d3fceb2890f6c3e41&quot;</span><span class="p">,</span>
    <span class="s2">&quot;6016621e244b60b9c69fd44b055e4a03&quot;</span><span class="p">,</span> <span class="s2">&quot;fd495a2c94b6b13bfb4cd63e293d3fc0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bf81a23d80f55e5f1eb0c16717193105&quot;</span><span class="p">,</span>
    <span class="s2">&quot;6f8bf8f70216788d14d9a49a3c664b16&quot;</span><span class="p">,</span>
    <span class="s2">&quot;19df0297d6a2ac21da5e432645d63174&quot;</span><span class="p">,</span>
    <span class="s2">&quot;b4ffb957a2adbb8b76966e4ea28dbdf1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;3de1bc5aae4c76164f34515e2e84939c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;705ba1cbfc42ce64a54dda2b732f81f2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bc6d4f880d3eb281358af1c764779704&quot;</span><span class="p">,</span>
    <span class="s2">&quot;a3b6a7be067aa12af273482baee1498d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;f035813314960eb91f3a4dae508a68e5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;728461f81fcfa8f02ff3af969ab6499c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;5c1c87ee71c512b38a0711b93bb7e9fe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;4652bcf7a1f2b7cdeec52956eb884795&quot;</span><span class="p">,</span>
    <span class="s2">&quot;e1c4bf76d2c98dcf6ffe00399a6e8b07&quot;</span><span class="p">,</span>
    <span class="s2">&quot;0ecabd68fa9c56614e2a694359c0a545&quot;</span><span class="p">,</span>
    <span class="s2">&quot;4c93bea7a72ac2b7475201acef5a1fc4&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">pediatric_remote_fnames</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;24880625&quot;</span><span class="p">,</span> <span class="s2">&quot;24880628&quot;</span><span class="p">,</span> <span class="s2">&quot;24880631&quot;</span><span class="p">,</span> <span class="s2">&quot;24880634&quot;</span><span class="p">,</span> <span class="s2">&quot;24880637&quot;</span><span class="p">,</span> <span class="s2">&quot;24880640&quot;</span><span class="p">,</span>
    <span class="s2">&quot;24880643&quot;</span><span class="p">,</span> <span class="s2">&quot;24880646&quot;</span><span class="p">,</span> <span class="s2">&quot;24880649&quot;</span><span class="p">,</span> <span class="s2">&quot;24880652&quot;</span><span class="p">,</span> <span class="s2">&quot;24880655&quot;</span><span class="p">,</span> <span class="s2">&quot;24880661&quot;</span><span class="p">,</span>
    <span class="s2">&quot;24880664&quot;</span><span class="p">,</span> <span class="s2">&quot;24880667&quot;</span><span class="p">,</span> <span class="s2">&quot;24880670&quot;</span><span class="p">,</span> <span class="s2">&quot;24880673&quot;</span><span class="p">,</span> <span class="s2">&quot;24880676&quot;</span><span class="p">,</span> <span class="s2">&quot;24880679&quot;</span><span class="p">,</span>
    <span class="s2">&quot;24880685&quot;</span><span class="p">,</span> <span class="s2">&quot;24880688&quot;</span><span class="p">,</span> <span class="s2">&quot;24880691&quot;</span><span class="p">,</span> <span class="s2">&quot;24880694&quot;</span><span class="p">,</span> <span class="s2">&quot;24880697&quot;</span><span class="p">,</span> <span class="s2">&quot;24880700&quot;</span><span class="p">,</span>
    <span class="s2">&quot;24880703&quot;</span><span class="p">,</span> <span class="s2">&quot;24880706&quot;</span><span class="p">,</span> <span class="s2">&quot;24880712&quot;</span><span class="p">,</span> <span class="s2">&quot;24880715&quot;</span><span class="p">,</span> <span class="s2">&quot;24880718&quot;</span><span class="p">,</span> <span class="s2">&quot;24880721&quot;</span><span class="p">,</span>
    <span class="s2">&quot;24880724&quot;</span><span class="p">,</span> <span class="s2">&quot;24880727&quot;</span><span class="p">,</span> <span class="s2">&quot;24880730&quot;</span><span class="p">,</span> <span class="s2">&quot;24880733&quot;</span><span class="p">,</span> <span class="s2">&quot;24880736&quot;</span><span class="p">,</span> <span class="s2">&quot;24880748&quot;</span><span class="p">,</span>
    <span class="s2">&quot;24880739&quot;</span><span class="p">,</span> <span class="s2">&quot;24880742&quot;</span><span class="p">,</span> <span class="s2">&quot;24880754&quot;</span><span class="p">,</span> <span class="s2">&quot;24880757&quot;</span><span class="p">,</span> <span class="s2">&quot;24880760&quot;</span><span class="p">,</span> <span class="s2">&quot;24880763&quot;</span><span class="p">,</span>
    <span class="s2">&quot;24880769&quot;</span><span class="p">,</span> <span class="s2">&quot;24880772&quot;</span><span class="p">,</span> <span class="s2">&quot;24880775&quot;</span><span class="p">,</span> <span class="s2">&quot;24880778&quot;</span><span class="p">,</span> <span class="s2">&quot;24880781&quot;</span><span class="p">,</span> <span class="s2">&quot;24880787&quot;</span><span class="p">,</span>
    <span class="s2">&quot;24880790&quot;</span><span class="p">,</span> <span class="s2">&quot;24880793&quot;</span><span class="p">,</span> <span class="s2">&quot;24880796&quot;</span><span class="p">,</span> <span class="s2">&quot;24880802&quot;</span><span class="p">,</span> <span class="s2">&quot;24880805&quot;</span><span class="p">,</span> <span class="s2">&quot;24880808&quot;</span><span class="p">,</span>
    <span class="s2">&quot;24880616&quot;</span><span class="p">,</span> <span class="s2">&quot;24880613&quot;</span><span class="p">,</span> <span class="s2">&quot;24986396&quot;</span><span class="p">,</span>
    <span class="s2">&quot;42120480&quot;</span><span class="p">,</span>
    <span class="s2">&quot;42120483&quot;</span><span class="p">,</span>
    <span class="s2">&quot;42120486&quot;</span><span class="p">,</span>
    <span class="s2">&quot;42120489&quot;</span><span class="p">,</span>
    <span class="s2">&quot;42120492&quot;</span><span class="p">,</span>
    <span class="s2">&quot;42120495&quot;</span><span class="p">,</span>
    <span class="s2">&quot;42121791&quot;</span><span class="p">,</span>
    <span class="s2">&quot;42121794&quot;</span><span class="p">,</span>
    <span class="s2">&quot;42121836&quot;</span><span class="p">,</span>
    <span class="s2">&quot;42121839&quot;</span><span class="p">,</span>
    <span class="s2">&quot;42121803&quot;</span><span class="p">,</span>
    <span class="s2">&quot;42121806&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">fetch_pediatric_templates</span> <span class="o">=</span> <span class="n">_make_reusable_fetcher</span><span class="p">(</span>
    <span class="s1">&#39;fetch_pediatric_templates&#39;</span><span class="p">,</span>
    <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span> <span class="s1">&#39;pediatric_templates&#39;</span><span class="p">),</span>
    <span class="s1">&#39;https://ndownloader.figshare.com/files/&#39;</span><span class="p">,</span>
    <span class="n">pediatric_remote_fnames</span><span class="p">,</span>
    <span class="n">pediatric_fnames</span><span class="p">,</span>
    <span class="n">md5_list</span><span class="o">=</span><span class="n">pediatric_md5_hashes</span><span class="p">,</span>
    <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Download pediatric templates&#39;</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">read_pediatric_templates</span><span class="p">(</span><span class="n">as_img</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resample_to</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load pediatric pyAFQ templates.</span>

<span class="sd">    Used to create pediatric `bundle_dict`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    as_img : bool, optional</span>
<span class="sd">        If True, values are `Nifti1Image`. Otherwise, values are</span>
<span class="sd">        paths to Nifti files. Default: True</span>
<span class="sd">    resample_to : str or nibabel image class instance, optional</span>
<span class="sd">        A template image to resample to. Typically, this should be the</span>
<span class="sd">        template to which individual-level data are registered. Defaults to</span>
<span class="sd">        the MNI template. Default: False</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict :</span>
<span class="sd">        keys = names of template ROIs, and</span>
<span class="sd">        values = `Nifti1Image` from each of the ROI nifti files.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading pediatric templates...&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pediatric_templates</span> <span class="o">=</span> <span class="n">_fetcher_to_template</span><span class="p">(</span>
        <span class="n">fetch_pediatric_templates</span><span class="p">,</span>
        <span class="n">as_img</span><span class="o">=</span><span class="n">as_img</span><span class="p">,</span>
        <span class="n">resample_to</span><span class="o">=</span><span class="n">resample_to</span><span class="p">)</span>

    <span class="c1"># For the arcuate (AF/ARC), reuse the SLF ROIs</span>
    <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;ARC_roi1_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;SLF_roi1_L&#39;</span><span class="p">]</span>
    <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;ARC_roi1_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;SLF_roi1_R&#39;</span><span class="p">]</span>
    <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;ARC_roi2_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;SLFt_roi2_L&#39;</span><span class="p">]</span>
    <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;ARC_roi2_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;SLFt_roi2_R&#39;</span><span class="p">]</span>
    <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;ARC_roi3_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;SLFt_roi3_L&#39;</span><span class="p">]</span>
    <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;ARC_roi3_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;SLFt_roi3_R&#39;</span><span class="p">]</span>

    <span class="c1"># For the middle longitudinal fasciculus (MdLF) reuse ILF ROI</span>
    <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;MdLF_roi2_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;ILF_roi2_L&#39;</span><span class="p">]</span>
    <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;MdLF_roi2_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pediatric_templates</span><span class="p">[</span><span class="s1">&#39;ILF_roi2_R&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">pediatric_templates</span>


<span class="k">def</span> <span class="nf">read_resample_roi</span><span class="p">(</span><span class="n">roi</span><span class="p">,</span> <span class="n">resample_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads an roi from file-name/img and resamples it to conform with</span>
<span class="sd">    another file-name/img.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    roi : str or nibabel image class instance.</span>
<span class="sd">        Should contain a binary volume with 1s in the region of interest and</span>
<span class="sd">        0s elsewhere.</span>

<span class="sd">    resample_to : str or nibabel image class instance, optional</span>
<span class="sd">        A template image to resample to. Typically, this should be the</span>
<span class="sd">        template to which individual-level data are registered. Defaults to</span>
<span class="sd">        the MNI template.</span>

<span class="sd">    threshold: bool or float</span>
<span class="sd">        If set to False (default), resampled result is returned. Otherwise,</span>
<span class="sd">        the resampled result is thresholded at this value and binarized.</span>
<span class="sd">        This is not applied if the input ROI is already in the space of the</span>
<span class="sd">        output.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    nibabel image class instance that contains the binary ROI resampled into</span>
<span class="sd">    the requested space.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">roi</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">roi</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">resample_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">resample_to</span> <span class="o">=</span> <span class="n">read_mni_template</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resample_to</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">resample_to</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">resample_to</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">resample_to</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">resample_to</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span> <span class="n">roi</span><span class="o">.</span><span class="n">affine</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">roi</span>

    <span class="n">as_array</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span>
        <span class="n">roi</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">(),</span>
        <span class="n">resample_to</span><span class="p">,</span>
        <span class="n">roi</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span>
        <span class="n">resample_to</span><span class="o">.</span><span class="n">affine</span><span class="p">)</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">threshold</span><span class="p">:</span>
        <span class="n">as_array</span> <span class="o">=</span> <span class="p">(</span><span class="n">as_array</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span>
        <span class="n">as_array</span><span class="p">,</span>
        <span class="n">resample_to</span><span class="o">.</span><span class="n">affine</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">img</span>


<span class="n">template_fnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ATR_roi1_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ATR_roi1_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ATR_roi2_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ATR_roi2_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ATR_L_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ATR_R_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CGC_roi1_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CGC_roi1_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CGC_roi2_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CGC_roi2_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CGC_L_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CGC_R_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CST_roi1_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CST_roi1_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CST_roi2_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CST_roi2_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CST_L_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CST_R_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;FA_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;FA_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;FA_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;FP_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;FP_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;FP_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;HCC_roi1_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;HCC_roi1_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;HCC_roi2_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;HCC_roi2_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;HCC_L_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;HCC_R_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;IFO_roi1_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;IFO_roi1_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;IFO_roi2_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;IFO_roi2_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;IFO_L_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;IFO_R_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ILF_roi1_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ILF_roi1_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ILF_roi2_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ILF_roi2_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ILF_L_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ILF_R_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;SLF_roi1_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;SLF_roi1_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;SLF_roi2_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;SLF_roi2_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;SLFt_roi2_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;SLFt_roi2_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;SLF_L_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;SLF_R_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;UNC_roi1_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;UNC_roi1_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;UNC_roi2_L.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;UNC_roi2_R.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;UNC_L_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;UNC_R_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ARC_L_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ARC_R_prob_map.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;VOF_R_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;VOF_R_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;VOF_L_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;VOF_L_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;pARC_R_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;pARC_L_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ARC_R_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ARC_R_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ARC_L_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ARC_L_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;UNC_R_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;UNC_R_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;UNC_L_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;UNC_L_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;SLF_R_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;SLF_R_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;SLF_L_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;SLF_L_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ILF_R_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ILF_R_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ILF_L_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ILF_L_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;IFO_R_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;IFO_R_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;IFO_L_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;IFO_L_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;FA_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;FA_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;FP_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;FP_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CGC_R_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CGC_L_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CST_R_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CST_R_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CST_L_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;CST_L_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ATR_R_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ATR_R_start.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ATR_L_end.nii.gz&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ATR_L_start.nii.gz&quot;</span><span class="p">]</span>


<span class="n">template_remote_fnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;5273680&quot;</span><span class="p">,</span> <span class="s2">&quot;5273683&quot;</span><span class="p">,</span> <span class="s2">&quot;5273686&quot;</span><span class="p">,</span> <span class="s2">&quot;5273689&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;11458274&quot;</span><span class="p">,</span> <span class="s2">&quot;11458277&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;5273695&quot;</span><span class="p">,</span> <span class="s2">&quot;5273692&quot;</span><span class="p">,</span> <span class="s2">&quot;5273698&quot;</span><span class="p">,</span> <span class="s2">&quot;5273701&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;11458268&quot;</span><span class="p">,</span> <span class="s2">&quot;11458271&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;5273704&quot;</span><span class="p">,</span> <span class="s2">&quot;5273707&quot;</span><span class="p">,</span> <span class="s2">&quot;5273710&quot;</span><span class="p">,</span> <span class="s2">&quot;5273713&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;11458262&quot;</span><span class="p">,</span> <span class="s2">&quot;11458265&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;5273716&quot;</span><span class="p">,</span> <span class="s2">&quot;5273719&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;11458220&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;5273722&quot;</span><span class="p">,</span> <span class="s2">&quot;5273725&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;11458226&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;5273728&quot;</span><span class="p">,</span> <span class="s2">&quot;5273731&quot;</span><span class="p">,</span> <span class="s2">&quot;5273734&quot;</span><span class="p">,</span> <span class="s2">&quot;5273746&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;11458259&quot;</span><span class="p">,</span> <span class="s2">&quot;11458256&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;5273737&quot;</span><span class="p">,</span> <span class="s2">&quot;5273740&quot;</span><span class="p">,</span> <span class="s2">&quot;5273743&quot;</span><span class="p">,</span> <span class="s2">&quot;5273749&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;11458250&quot;</span><span class="p">,</span> <span class="s2">&quot;11458253&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;5273752&quot;</span><span class="p">,</span> <span class="s2">&quot;5273755&quot;</span><span class="p">,</span> <span class="s2">&quot;5273758&quot;</span><span class="p">,</span> <span class="s2">&quot;5273761&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;11458244&quot;</span><span class="p">,</span> <span class="s2">&quot;11458247&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;5273764&quot;</span><span class="p">,</span> <span class="s2">&quot;5273767&quot;</span><span class="p">,</span> <span class="s2">&quot;5273770&quot;</span><span class="p">,</span> <span class="s2">&quot;5273773&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;5273776&quot;</span><span class="p">,</span> <span class="s2">&quot;5273791&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;11458238&quot;</span><span class="p">,</span> <span class="s2">&quot;11458241&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;5273779&quot;</span><span class="p">,</span> <span class="s2">&quot;5273782&quot;</span><span class="p">,</span> <span class="s2">&quot;5273785&quot;</span><span class="p">,</span> <span class="s2">&quot;5273788&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;11458223&quot;</span><span class="p">,</span> <span class="s2">&quot;11458229&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;11458232&quot;</span><span class="p">,</span> <span class="s2">&quot;11458235&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40943957&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40943960&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40943966&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40943969&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40943972&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40943975&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40943978&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40943981&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40943984&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40943987&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40943990&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40943993&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40943996&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40943999&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944002&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944005&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944008&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944011&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944014&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944017&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944020&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944023&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944026&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944029&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944032&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944035&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944038&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944041&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944044&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944047&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944050&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944053&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944056&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944059&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944062&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944065&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944068&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944074&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944077&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;40944080&quot;</span><span class="p">]</span>


<span class="n">template_md5_hashes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;6b7aaed1a2982fd0ea436a223133908b&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;fd60d46d4e3cbd906c86e4c9e4fd6e2a&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;3aba60b169a35c38640de4ec29d362c8&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;12716a5688a1809fbaed1d58d2e68b59&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;c5637f471df861d9bbb45604db34770b&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;850cc4c04d7241747063fe3cd440b2ce&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;8e8973bc7838c8744914d402f52d91ca&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;c5fa4e6e685e695c006823b6784d2407&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;e1fab77f21d5303ed52285f015e24f0b&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;5f89defec3753fd75cd688c7bfb20a36&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;a4f3cd65b06fb25f63d5dab7592f00f2&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;7e73ab02db30a3ad6bd9e82148c2486e&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;f9db3154955a20b67c2dda758800d14c&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;73941510c798c1ed1b03e2bd481cd5c7&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;660cdc031ee0716d60159c7d933119ea&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;660cdc031ee0716d60159c7d933119ea&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;fd012bc89f6bed7bd54530195496bac4&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;3406906a86e633cc102127cf210a1063&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;9040a7953dcbbf131d135c866182d8ef&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;a72e17194824fcd838a594a2eb50c72e&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;627d7bb2e6d55f8243da815a36d9ff1a&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;55adbe9b8279185eedbe342149e1ff90&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;5a7412a3cf0fb185eec53d1989df2f7c&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;1aa36e83ae7b5555bb19d776ede9c18d&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;ba453196ff179b0e31172806e313b52c&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;d85c6574526b296935f34bf4f65cd493&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;9b81646317f59c7db087f27e2f85679e&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;9806e82c250e4604534b96917f87b7e8&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;213d3fb1ccd756d878f9b50b765b1c8f&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;f1e7e6bc51aa0aa279c54fb3805fb5e3&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;0e68a9feaaddcc9b4d667c2f15903368&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;d45020a87ee4bb496edd350631d91f6a&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;75c2c911826ec4b23159f9bd80e3c039&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;55d616ea9e0c646adc1aafa0f5fbe625&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;dee83fa6b03cfa5e0f5c965953aa6778&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;a13eef7059c98568adfefbab660e434e&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;045b7d5c6341997f3f0120c3a4212ad8&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;d174b1359ba982b03840436c93b7bbb4&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;fff9753f394fc4c73fb2ae40b3b4dde0&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;cd278b4dd6ff77481ea9ac16485a5ae2&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;7bdf5111265107091c7a2fca9215de30&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;7d4a43714504e6e930f922c9bc2a13d5&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;af2bcedf47e193686af329b9a8e259da&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;9a1122943579d11ba169d3ad87a75625&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;627903f7a06627bfd4153dc9245fa390&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;1714cd7f989c3435bdd5a2076e6272a0&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;1fa2114049707a4e05b53f9d95730375&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;b6663067d5ea53c70cb8803948f8adf7&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;d3e068997ebc60407bd6e9576e47dede&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;27ecfbd1d2f98213e52d73b7d70fe0e7&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;fa141bb2d951bec486916acda3652d95&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;d391d073e86e28588be9a6d01b2e7a82&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;a3e085562e6b8111c7ebc358f9450c8b&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;d65c67910807504735e034f7ea92d590&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;93cb24a9128db1a6c34a09eaf79fe7f0&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;71a7455cb4062dc39b1677c118c7b5a5&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;19590c712f1776da1fdba64d4eb7f1f6&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;04d5af0feb2c1b5b52a87ccbbf148e4b&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;53c277be990d00f7de04f2ea35e74d73&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;d37d815fd1bdaaf3a9d2dcfc3ccb1345&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;95ed3189d8ac152945e6be1eb24381a3&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;a9007e6f2d6ae13ef182f65057c06573&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;c6eb9ee33b7caf691749e266f89e8ec4&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;a06b2e2e52c09a601f683dc39859a7f1&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;bee876a34fdb03e69a418b791f90975a&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;680749c9e4565bc02492019d57d8e7d7&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;ffc157e9f73a43eff23821f2cfca614a&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;a92beacd59ff2c90408edc7407a571c4&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;1c0b570bb2d622718b01ee2c429a5d15&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;4d3db603f7cc86b5696b1514c5b43e0e&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;96c644616e8724b4d071c64981363e6c&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;9be681028226aa9b70fac46f8e376282&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;e19274bd1ee58906c03f5f9a7c4f01c5&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;1d33ac68aeb8eb444c07b5a853414727&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;ca3c698154d77217c9480123a49c73dd&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;b17d876c0ca51f0e3ec6177382aa4ecf&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;6ff7e2dd357affc7c4e4d79f5f5866e9&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;96c644616e8724b4d071c64981363e6c&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;de045095d914d4929409e062fc1a09b6&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;e19274bd1ee58906c03f5f9a7c4f01c5&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;69009da4aa52607962ec99b9e248a39f&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;2b106da3ed88e4cc9a5b4c391cf3445d&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;de045095d914d4929409e062fc1a09b6&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;0d28a8e367646f9f0036ba7a100e49e5&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;69009da4aa52607962ec99b9e248a39f&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;1c0b570bb2d622718b01ee2c429a5d15&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;ffc157e9f73a43eff23821f2cfca614a&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;69009da4aa52607962ec99b9e248a39f&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;de045095d914d4929409e062fc1a09b6&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;9d897a3ab960931c5119a9bbfc6d7838&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;0046be49e39cf8c639418c805de8b9e2&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;67d8f24bd749d8a9094ccb9d8e63fa25&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;5736d28551296253f879c4b0d450b70e&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;67d8f24bd749d8a9094ccb9d8e63fa25&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;5736d28551296253f879c4b0d450b70e&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;5f2c0c0f1b7b32ba0a8474a460a2b980&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;ffc157e9f73a43eff23821f2cfca614a&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;a8d308a93b26242c04b878c733cb252f&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;1c0b570bb2d622718b01ee2c429a5d15&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="fetch_templates"><a class="viewcode-back" href="../../../reference/api/AFQ/data/fetch/index.html#AFQ.data.fetch.fetch_templates">[docs]</a><span class="n">fetch_templates</span> <span class="o">=</span> <span class="n">_make_reusable_fetcher</span><span class="p">(</span>
    <span class="s2">&quot;fetch_templates&quot;</span><span class="p">,</span>
    <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">),</span>
    <span class="n">baseurl</span><span class="p">,</span> <span class="n">template_remote_fnames</span><span class="p">,</span>
    <span class="n">template_fnames</span><span class="p">,</span> <span class="n">md5_list</span><span class="o">=</span><span class="n">template_md5_hashes</span><span class="p">,</span>
    <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Download AFQ templates&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_templates"><a class="viewcode-back" href="../../../reference/api/AFQ/data/fetch/index.html#AFQ.data.fetch.read_templates">[docs]</a><span class="k">def</span> <span class="nf">read_templates</span><span class="p">(</span><span class="n">as_img</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resample_to</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load AFQ templates from file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    as_img : bool, optional</span>
<span class="sd">        If True, values are `Nifti1Image`. Otherwise, values are</span>
<span class="sd">        paths to Nifti files. Default: True</span>
<span class="sd">    resample_to : str or nibabel image class instance, optional</span>
<span class="sd">        A template image to resample to. Typically, this should be the</span>
<span class="sd">        template to which individual-level data are registered. Defaults to</span>
<span class="sd">        the MNI template. Default: False</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict with: keys: names of template ROIs and values: nibabel Nifti1Image</span>
<span class="sd">    objects from each of the ROI nifti files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;AFQ&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;loading AFQ templates&#39;</span><span class="p">)</span>
    <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

    <span class="n">template_dict</span> <span class="o">=</span> <span class="n">_fetcher_to_template</span><span class="p">(</span>
        <span class="n">fetch_templates</span><span class="p">,</span>
        <span class="n">as_img</span><span class="o">=</span><span class="n">as_img</span><span class="p">,</span>
        <span class="n">resample_to</span><span class="o">=</span><span class="n">resample_to</span><span class="p">)</span>

    <span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AFQ templates loaded in </span><span class="si">{</span><span class="n">toc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tic</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">template_dict</span></div>


<span class="n">cp_fnames</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;ICP_L_inferior_prob.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ICP_L_superior_prob.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ICP_R_inferior_prob.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ICP_R_superior_prob.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MCP_L_inferior_prob.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MCP_L_superior_prob.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MCP_R_inferior_prob.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MCP_R_superior_prob.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SCP_L_inferior_prob.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SCP_L_inter_prob.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SCP_L_superior_prob.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SCP_R_inferior_prob.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SCP_R_inter_prob.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SCP_R_superior_prob.nii.gz&quot;</span><span class="p">]</span>

<span class="n">cp_remote_fnames</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;40897772&quot;</span><span class="p">,</span>
    <span class="s2">&quot;40897787&quot;</span><span class="p">,</span>
    <span class="s2">&quot;40897805&quot;</span><span class="p">,</span>
    <span class="s2">&quot;40897769&quot;</span><span class="p">,</span>
    <span class="s2">&quot;40897778&quot;</span><span class="p">,</span>
    <span class="s2">&quot;40897799&quot;</span><span class="p">,</span>
    <span class="s2">&quot;40897784&quot;</span><span class="p">,</span>
    <span class="s2">&quot;40897808&quot;</span><span class="p">,</span>
    <span class="s2">&quot;40897772&quot;</span><span class="p">,</span>
    <span class="s2">&quot;40897781&quot;</span><span class="p">,</span>
    <span class="s2">&quot;40897793&quot;</span><span class="p">,</span>
    <span class="s2">&quot;40897790&quot;</span><span class="p">,</span>
    <span class="s2">&quot;40897775&quot;</span><span class="p">,</span>
    <span class="s2">&quot;40897796&quot;</span><span class="p">]</span>

<span class="n">cp_md5_hashes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;7ec3a78f30aefe8c7e2a99773941b8f4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fc6b088f359201aff480d8e2f7b17eef&quot;</span><span class="p">,</span>
    <span class="s2">&quot;e9688ff4554b768f79a64731705107f9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;f1959600d6aaae58d7ba4ce5e63c5e3b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;e68c669d58bd2cbb3490bd952957009e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;eb7643fd54f6046cd71b7ac085679594&quot;</span><span class="p">,</span>
    <span class="s2">&quot;746da79d0639630c1eb872b2895814ee&quot;</span><span class="p">,</span>
    <span class="s2">&quot;3f69b20a8a7dec4839cef461667d18a5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;4d95b3d3804352eae6e66fe024f1baf5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;a9410ab5fe3240cc8ef929062d54cc9e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;531babda0dd284bda4a5b4b1303f8266&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dde4907d7914dfe71ed07436b073bd75&quot;</span><span class="p">,</span>
    <span class="s2">&quot;c02f2fcb48c33fe4b2988087075e9566&quot;</span><span class="p">,</span>
    <span class="s2">&quot;62e32e090cd326790c3fdbc6acb8eb75&quot;</span><span class="p">]</span>

<span class="n">fetch_cp_templates</span> <span class="o">=</span> <span class="n">_make_reusable_fetcher</span><span class="p">(</span>
    <span class="s2">&quot;fetch_cb_templates&quot;</span><span class="p">,</span>
    <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span>
            <span class="s1">&#39;cp_templates&#39;</span><span class="p">),</span>
    <span class="n">baseurl</span><span class="p">,</span> <span class="n">cp_remote_fnames</span><span class="p">,</span>
    <span class="n">cp_fnames</span><span class="p">,</span>
    <span class="n">md5_list</span><span class="o">=</span><span class="n">cp_md5_hashes</span><span class="p">,</span>
    <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Download AFQ cerebellar penducles templates&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">read_cp_templates</span><span class="p">(</span><span class="n">as_img</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resample_to</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load AFQ Cerebellar penducles templates from file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    as_img : bool, optional</span>
<span class="sd">        If True, values are `Nifti1Image`. Otherwise, values are</span>
<span class="sd">        paths to Nifti files. Default: True</span>
<span class="sd">    resample_to : str or nibabel image class instance, optional</span>
<span class="sd">        A template image to resample to. Typically, this should be the</span>
<span class="sd">        template to which individual-level data are registered. Defaults to</span>
<span class="sd">        the MNI template. Default: False</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict with: keys: names of template ROIs and values: nibabel Nifti1Image</span>
<span class="sd">    objects from each of the ROI nifti files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;AFQ&#39;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;loading or templates&#39;</span><span class="p">)</span>
    <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

    <span class="n">template_dict</span> <span class="o">=</span> <span class="n">_fetcher_to_template</span><span class="p">(</span>
        <span class="n">fetch_cp_templates</span><span class="p">,</span>
        <span class="n">as_img</span><span class="o">=</span><span class="n">as_img</span><span class="p">,</span>
        <span class="n">resample_to</span><span class="o">=</span><span class="n">resample_to</span><span class="p">)</span>

    <span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;Cerebellar peduncles templates loaded in </span><span class="si">{</span><span class="n">toc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tic</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">template_dict</span>


<span class="n">or_fnames</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;left_thal_MNI.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;left_V1_MNI.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;right_thal_MNI.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;right_V1_MNI.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;left_OP_MNI.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;left_OR_1.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;left_OR_2.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;left_pos_thal_MNI.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;left_TP_MNI.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;right_OP_MNI.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;right_OR_1.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;right_OR_2.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;right_pos_thal_MNI.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;right_TP_MNI.nii.gz&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">or_remote_fnames</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;36514170&quot;</span><span class="p">,</span>
    <span class="s2">&quot;26831633&quot;</span><span class="p">,</span>
    <span class="s2">&quot;36514173&quot;</span><span class="p">,</span>
    <span class="s2">&quot;26831639&quot;</span><span class="p">,</span>
    <span class="s2">&quot;26831642&quot;</span><span class="p">,</span>
    <span class="s2">&quot;26831645&quot;</span><span class="p">,</span>
    <span class="s2">&quot;26831648&quot;</span><span class="p">,</span>
    <span class="s2">&quot;26831651&quot;</span><span class="p">,</span>
    <span class="s2">&quot;26831654&quot;</span><span class="p">,</span>
    <span class="s2">&quot;26831657&quot;</span><span class="p">,</span>
    <span class="s2">&quot;26831660&quot;</span><span class="p">,</span>
    <span class="s2">&quot;26831663&quot;</span><span class="p">,</span>
    <span class="s2">&quot;26831666&quot;</span><span class="p">,</span>
    <span class="s2">&quot;26831669&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">or_md5_hashes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;a45126a727c4b5d843b2f7aae181825f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ad996c67bf5cc59fc3a7b60255873b67&quot;</span><span class="p">,</span>
    <span class="s2">&quot;7a75c3ddd25335277a099626dbc946ac&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cc88fb4671311404eb9dfa8fa11a59e0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;9cff03af586d9dd880750cef3e0bf63f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ff728ba3ffa5d1600bcd19fdef8182c4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;4f1978e418a3169609375c28b3eba0fd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fd163893081b520f4594171aeea04f39&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bf795d197912b5e074d248d2763c6930&quot;</span><span class="p">,</span>
    <span class="s2">&quot;13efde1efe0de52683cbf352ecba457e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;75c7bd2092950578e599a2dcb218909f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;8f3890fa8c26a568503226757f7e7d6c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;f239aa3140809152da8884ff879dde1b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;60a748567e4dd81b40ad8967a14cb09e&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">ar_fnames</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;AAL_Thal_R.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AAL_Thal_L.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AAL_TempSup_L.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AAL_TempSup_R.nii.gz&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">ar_remote_fnames</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;43817367&quot;</span><span class="p">,</span>
    <span class="s2">&quot;43817370&quot;</span><span class="p">,</span>
    <span class="s2">&quot;43817373&quot;</span><span class="p">,</span>
    <span class="s2">&quot;43817376&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">ar_md5_hashes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;5f2c0c0f1b7b32ba0a8474a460a2b980&quot;</span><span class="p">,</span>
    <span class="s2">&quot;a8d308a93b26242c04b878c733cb252f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;92a255f706dd4e09268c5bc6bf2876e4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ec0a3ef3cb3a4c549dd783dc8aeceeee&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="n">fetch_ar_templates</span> <span class="o">=</span> <span class="n">_make_reusable_fetcher</span><span class="p">(</span>
    <span class="s2">&quot;fetch_ar_templates&quot;</span><span class="p">,</span>
    <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span>
            <span class="s1">&#39;ar_templates&#39;</span><span class="p">),</span>
    <span class="n">baseurl</span><span class="p">,</span> <span class="n">ar_remote_fnames</span><span class="p">,</span>
    <span class="n">ar_fnames</span><span class="p">,</span>
    <span class="n">md5_list</span><span class="o">=</span><span class="n">ar_md5_hashes</span><span class="p">,</span>
    <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Download AFQ or templates&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">read_ar_templates</span><span class="p">(</span><span class="n">as_img</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resample_to</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load AFQ AR templates from file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    as_img : bool, optional</span>
<span class="sd">        If True, values are `Nifti1Image`. Otherwise, values are</span>
<span class="sd">        paths to Nifti files. Default: True</span>
<span class="sd">    resample_to : str or nibabel image class instance, optional</span>
<span class="sd">        A template image to resample to. Typically, this should be the</span>
<span class="sd">        template to which individual-level data are registered. Defaults to</span>
<span class="sd">        the MNI template. Default: False</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict with: keys: names of template ROIs and values: nibabel Nifti1Image</span>
<span class="sd">    objects from each of the ROI nifti files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;AFQ&#39;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;loading ar templates&#39;</span><span class="p">)</span>
    <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

    <span class="n">template_dict</span> <span class="o">=</span> <span class="n">_fetcher_to_template</span><span class="p">(</span>
        <span class="n">fetch_ar_templates</span><span class="p">,</span>
        <span class="n">as_img</span><span class="o">=</span><span class="n">as_img</span><span class="p">,</span>
        <span class="n">resample_to</span><span class="o">=</span><span class="n">resample_to</span><span class="p">)</span>

    <span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;or templates loaded in </span><span class="si">{</span><span class="n">toc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tic</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">template_dict</span>


<div class="viewcode-block" id="fetch_or_templates"><a class="viewcode-back" href="../../../reference/api/AFQ/data/fetch/index.html#AFQ.data.fetch.fetch_or_templates">[docs]</a><span class="n">fetch_or_templates</span> <span class="o">=</span> <span class="n">_make_reusable_fetcher</span><span class="p">(</span>
    <span class="s2">&quot;fetch_or_templates&quot;</span><span class="p">,</span>
    <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span>
            <span class="s1">&#39;or_templates&#39;</span><span class="p">),</span>
    <span class="n">baseurl</span><span class="p">,</span> <span class="n">or_remote_fnames</span><span class="p">,</span>
    <span class="n">or_fnames</span><span class="p">,</span>
    <span class="n">md5_list</span><span class="o">=</span><span class="n">or_md5_hashes</span><span class="p">,</span>
    <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Download AFQ or templates&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_or_templates"><a class="viewcode-back" href="../../../reference/api/AFQ/data/fetch/index.html#AFQ.data.fetch.read_or_templates">[docs]</a><span class="k">def</span> <span class="nf">read_or_templates</span><span class="p">(</span><span class="n">as_img</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resample_to</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load AFQ OR templates from file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    as_img : bool, optional</span>
<span class="sd">        If True, values are `Nifti1Image`. Otherwise, values are</span>
<span class="sd">        paths to Nifti files. Default: True</span>
<span class="sd">    resample_to : str or nibabel image class instance, optional</span>
<span class="sd">        A template image to resample to. Typically, this should be the</span>
<span class="sd">        template to which individual-level data are registered. Defaults to</span>
<span class="sd">        the MNI template. Default: False</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict with: keys: names of template ROIs and values: nibabel Nifti1Image</span>
<span class="sd">    objects from each of the ROI nifti files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;AFQ&#39;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;loading or templates&#39;</span><span class="p">)</span>
    <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

    <span class="n">template_dict</span> <span class="o">=</span> <span class="n">_fetcher_to_template</span><span class="p">(</span>
        <span class="n">fetch_or_templates</span><span class="p">,</span>
        <span class="n">as_img</span><span class="o">=</span><span class="n">as_img</span><span class="p">,</span>
        <span class="n">resample_to</span><span class="o">=</span><span class="n">resample_to</span><span class="p">)</span>

    <span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;or templates loaded in </span><span class="si">{</span><span class="n">toc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tic</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">template_dict</span></div>


<span class="n">stanford_hardi_tractography_remote_fnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;5325715&quot;</span><span class="p">,</span> <span class="s2">&quot;5325718&quot;</span><span class="p">,</span> <span class="s2">&quot;25289735&quot;</span><span class="p">]</span>
<span class="n">stanford_hardi_tractography_hashes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;6f4bdae702031a48d1cd3811e7a42ef9&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;f20854b4f710577c58bd01072cfb4de6&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;294bfd1831861e8635eef8834ff18892&#39;</span><span class="p">]</span>
<span class="n">stanford_hardi_tractography_fnames</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;mapping.nii.gz&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tractography_subsampled.trk&#39;</span><span class="p">,</span>
    <span class="s1">&#39;full_segmented_cleaned_tractography.trk&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="fetch_stanford_hardi_tractography"><a class="viewcode-back" href="../../../reference/api/AFQ/data/fetch/index.html#AFQ.data.fetch.fetch_stanford_hardi_tractography">[docs]</a><span class="n">fetch_stanford_hardi_tractography</span> <span class="o">=</span> <span class="n">_make_reusable_fetcher</span><span class="p">(</span>
    <span class="s2">&quot;fetch_stanford_hardi_tractography&quot;</span><span class="p">,</span>
    <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span>
            <span class="s1">&#39;stanford_hardi_tractography&#39;</span><span class="p">),</span>
    <span class="n">baseurl</span><span class="p">,</span>
    <span class="n">stanford_hardi_tractography_remote_fnames</span><span class="p">,</span>
    <span class="n">stanford_hardi_tractography_fnames</span><span class="p">,</span>
    <span class="n">md5_list</span><span class="o">=</span><span class="n">stanford_hardi_tractography_hashes</span><span class="p">,</span>
    <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Download Stanford HARDI tractography and mapping. For testing</span>
<span class="s2">           purposes&quot;&quot;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_stanford_hardi_tractography"><a class="viewcode-back" href="../../../reference/api/AFQ/data/fetch/index.html#AFQ.data.fetch.read_stanford_hardi_tractography">[docs]</a><span class="k">def</span> <span class="nf">read_stanford_hardi_tractography</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a minimal tractography from the Stanford dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">files</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">fetch_stanford_hardi_tractography</span><span class="p">()</span>
    <span class="n">files_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">files_dict</span><span class="p">[</span><span class="s1">&#39;mapping.nii.gz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
        <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span>
                <span class="s1">&#39;stanford_hardi_tractography&#39;</span><span class="p">,</span>
                <span class="s1">&#39;mapping.nii.gz&#39;</span><span class="p">))</span>

    <span class="c1"># We need the original data as reference</span>
    <span class="n">dwi_img</span><span class="p">,</span> <span class="n">gtab</span> <span class="o">=</span> <span class="n">dpd</span><span class="o">.</span><span class="n">read_stanford_hardi</span><span class="p">()</span>

    <span class="n">files_dict</span><span class="p">[</span><span class="s1">&#39;tractography_subsampled.trk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_tractogram</span><span class="p">(</span>
        <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span>
                <span class="s1">&#39;stanford_hardi_tractography&#39;</span><span class="p">,</span>
                <span class="s1">&#39;tractography_subsampled.trk&#39;</span><span class="p">),</span>
        <span class="n">dwi_img</span><span class="p">,</span>
        <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">trk_header_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">streamlines</span>

    <span class="n">files_dict</span><span class="p">[</span><span class="s1">&#39;full_segmented_cleaned_tractography.trk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_tractogram</span><span class="p">(</span>
        <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">afq_home</span><span class="p">,</span>
            <span class="s1">&#39;stanford_hardi_tractography&#39;</span><span class="p">,</span>
            <span class="s1">&#39;full_segmented_cleaned_tractography.trk&#39;</span><span class="p">),</span>
        <span class="n">dwi_img</span><span class="p">)</span><span class="o">.</span><span class="n">streamlines</span>

    <span class="k">return</span> <span class="n">files_dict</span></div>


<span class="k">def</span> <span class="nf">to_bids_description</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;dataset_description.json&#39;</span><span class="p">,</span>
                        <span class="n">BIDSVersion</span><span class="o">=</span><span class="s2">&quot;1.4.0&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dumps a dict into a bids description at the given location&quot;&quot;&quot;</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;BIDSVersion&quot;</span><span class="p">:</span> <span class="n">BIDSVersion</span><span class="p">})</span>
    <span class="n">desc_file</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">desc_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">organize_cfin_data</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create the expected file-system structure for the</span>
<span class="sd">    CFIN multi b-value diffusion data-set.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dpd</span><span class="o">.</span><span class="n">fetch_cfin_multib</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">afq_home</span>

    <span class="n">bids_path</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;cfin_multib&#39;</span><span class="p">,)</span>
    <span class="n">derivatives_path</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="s1">&#39;derivatives&#39;</span><span class="p">)</span>
    <span class="n">dmriprep_folder</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">derivatives_path</span><span class="p">,</span> <span class="s1">&#39;dmriprep&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">derivatives_path</span><span class="p">):</span>
        <span class="n">anat_folder</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dmriprep_folder</span><span class="p">,</span> <span class="s1">&#39;sub-01&#39;</span><span class="p">,</span> <span class="s1">&#39;ses-01&#39;</span><span class="p">,</span> <span class="s1">&#39;anat&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">anat_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dwi_folder</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dmriprep_folder</span><span class="p">,</span> <span class="s1">&#39;sub-01&#39;</span><span class="p">,</span> <span class="s1">&#39;ses-01&#39;</span><span class="p">,</span> <span class="s1">&#39;dwi&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dwi_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">t1_img</span> <span class="o">=</span> <span class="n">dpd</span><span class="o">.</span><span class="n">read_cfin_t1</span><span class="p">()</span>
        <span class="n">nib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">t1_img</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">anat_folder</span><span class="p">,</span> <span class="s1">&#39;sub-01_ses-01_T1w.nii.gz&#39;</span><span class="p">))</span>
        <span class="n">dwi_img</span><span class="p">,</span> <span class="n">gtab</span> <span class="o">=</span> <span class="n">dpd</span><span class="o">.</span><span class="n">read_cfin_dwi</span><span class="p">()</span>
        <span class="n">nib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">dwi_img</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dwi_folder</span><span class="p">,</span> <span class="s1">&#39;sub-01_ses-01_dwi.nii.gz&#39;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dwi_folder</span><span class="p">,</span> <span class="s1">&#39;sub-01_ses-01_dwi.bvec&#39;</span><span class="p">),</span> <span class="n">gtab</span><span class="o">.</span><span class="n">bvecs</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dwi_folder</span><span class="p">,</span> <span class="s1">&#39;sub-01_ses-01_dwi.bval&#39;</span><span class="p">),</span> <span class="n">gtab</span><span class="o">.</span><span class="n">bvals</span><span class="p">)</span>

    <span class="n">to_bids_description</span><span class="p">(</span>
        <span class="n">bids_path</span><span class="p">,</span>
        <span class="o">**</span><span class="p">{</span><span class="s2">&quot;BIDSVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
           <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;CFIN&quot;</span><span class="p">,</span>
           <span class="s2">&quot;Subjects&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sub-01&quot;</span><span class="p">]})</span>

    <span class="n">to_bids_description</span><span class="p">(</span>
        <span class="n">dmriprep_folder</span><span class="p">,</span>
        <span class="o">**</span><span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;CFIN&quot;</span><span class="p">,</span>
           <span class="s2">&quot;PipelineDescription&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;dipy&quot;</span><span class="p">},</span>
           <span class="s2">&quot;GeneratedBy&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;dipy&quot;</span><span class="p">}]})</span>


<div class="viewcode-block" id="organize_stanford_data"><a class="viewcode-back" href="../../../reference/api/AFQ/data/fetch/index.html#AFQ.data.fetch.organize_stanford_data">[docs]</a><span class="k">def</span> <span class="nf">organize_stanford_data</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clear_previous_afq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If necessary, downloads the Stanford HARDI dataset into DIPY directory and</span>
<span class="sd">    creates a BIDS compliant file-system structure in AFQ data directory:</span>


<span class="sd">    ~/AFQ_data/</span>
<span class="sd">     stanford_hardi</span>
<span class="sd">     dataset_description.json</span>
<span class="sd">     derivatives</span>
<span class="sd">         freesurfer</span>
<span class="sd">            dataset_description.json</span>
<span class="sd">            sub-01</span>
<span class="sd">                ses-01</span>
<span class="sd">                    anat</span>
<span class="sd">                        sub-01_ses-01_T1w.nii.gz</span>
<span class="sd">                        sub-01_ses-01_seg.nii.gz</span>
<span class="sd">         vistasoft</span>
<span class="sd">             dataset_description.json</span>
<span class="sd">             sub-01</span>
<span class="sd">                 ses-01</span>
<span class="sd">                     dwi</span>
<span class="sd">                         sub-01_ses-01_dwi.bval</span>
<span class="sd">                         sub-01_ses-01_dwi.bvec</span>
<span class="sd">                         sub-01_ses-01_dwi.nii.gz</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str or None</span>
<span class="sd">        Path to download dataset to, by default it is ~/AFQ_data/.</span>
<span class="sd">    clear_previous_afq : str or None</span>
<span class="sd">        Whether to clear previous afq results in the stanford</span>
<span class="sd">        hardi dataset. If not None, can be &quot;all&quot;, &quot;track&quot;, &quot;recog&quot;, &quot;prof&quot;.</span>
<span class="sd">        Default: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;AFQ&#39;</span><span class="p">)</span>

    <span class="c1"># fetches data for first subject and session</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;fetching Stanford HARDI data&#39;</span><span class="p">)</span>
    <span class="n">dpd</span><span class="o">.</span><span class="n">fetch_stanford_hardi</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">afq_home</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;creating AFQ home directory: </span><span class="si">{</span><span class="n">afq_home</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">afq_home</span>

    <span class="n">bids_path</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;stanford_hardi&#39;</span><span class="p">,)</span>
    <span class="n">derivatives_path</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="s1">&#39;derivatives&#39;</span><span class="p">)</span>
    <span class="n">dmriprep_folder</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">derivatives_path</span><span class="p">,</span> <span class="s1">&#39;vistasoft&#39;</span><span class="p">)</span>
    <span class="n">freesurfer_folder</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">derivatives_path</span><span class="p">,</span> <span class="s1">&#39;freesurfer&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">clear_previous_afq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">op</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">derivatives_path</span><span class="p">):</span>
        <span class="n">afq_folder</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">derivatives_path</span><span class="p">,</span> <span class="s1">&#39;afq&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clear_previous_afq</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">afq_folder</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">afq_folder</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">apply_cmd_to_afq_derivs</span><span class="p">(</span>
                <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_folder</span><span class="p">,</span> <span class="s2">&quot;sub-01/ses-01&quot;</span><span class="p">),</span>
                <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_folder</span><span class="p">,</span> <span class="s2">&quot;sub-01/ses-01/sub-01_ses-01&quot;</span><span class="p">),</span>
                <span class="n">dependent_on</span><span class="o">=</span><span class="n">clear_previous_afq</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">derivatives_path</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;creating derivatives directory: </span><span class="si">{</span><span class="n">derivatives_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># anatomical data</span>
        <span class="n">anat_folder</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">freesurfer_folder</span><span class="p">,</span> <span class="s1">&#39;sub-01&#39;</span><span class="p">,</span> <span class="s1">&#39;ses-01&#39;</span><span class="p">,</span> <span class="s1">&#39;anat&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">anat_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">t1_img</span> <span class="o">=</span> <span class="n">dpd</span><span class="o">.</span><span class="n">read_stanford_t1</span><span class="p">()</span>
        <span class="n">nib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">t1_img</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">anat_folder</span><span class="p">,</span> <span class="s1">&#39;sub-01_ses-01_T1w.nii.gz&#39;</span><span class="p">))</span>

        <span class="n">seg_img</span> <span class="o">=</span> <span class="n">dpd</span><span class="o">.</span><span class="n">read_stanford_labels</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">seg_img</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">anat_folder</span><span class="p">,</span>
                                  <span class="s1">&#39;sub-01_ses-01_seg.nii.gz&#39;</span><span class="p">))</span>

        <span class="c1"># diffusion-weighted imaging data</span>
        <span class="n">dwi_folder</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dmriprep_folder</span><span class="p">,</span> <span class="s1">&#39;sub-01&#39;</span><span class="p">,</span> <span class="s1">&#39;ses-01&#39;</span><span class="p">,</span> <span class="s1">&#39;dwi&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dwi_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">dwi_img</span><span class="p">,</span> <span class="n">gtab</span> <span class="o">=</span> <span class="n">dpd</span><span class="o">.</span><span class="n">read_stanford_hardi</span><span class="p">()</span>
        <span class="n">nib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">dwi_img</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dwi_folder</span><span class="p">,</span> <span class="s1">&#39;sub-01_ses-01_dwi.nii.gz&#39;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dwi_folder</span><span class="p">,</span> <span class="s1">&#39;sub-01_ses-01_dwi.bvec&#39;</span><span class="p">),</span> <span class="n">gtab</span><span class="o">.</span><span class="n">bvecs</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dwi_folder</span><span class="p">,</span> <span class="s1">&#39;sub-01_ses-01_dwi.bval&#39;</span><span class="p">),</span> <span class="n">gtab</span><span class="o">.</span><span class="n">bvals</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Dataset is already in place. If you want to fetch it &#39;</span>
                    <span class="o">+</span> <span class="s1">&#39;again please first remove the folder &#39;</span>
                    <span class="o">+</span> <span class="n">derivatives_path</span><span class="p">)</span>

    <span class="c1"># Dump out the description of the dataset</span>
    <span class="n">to_bids_description</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span>
                        <span class="o">**</span><span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;Stanford HARDI&quot;</span><span class="p">,</span> <span class="s2">&quot;Subjects&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sub-01&quot;</span><span class="p">]})</span>

    <span class="c1"># And descriptions of the pipelines in the derivatives:</span>
    <span class="n">to_bids_description</span><span class="p">(</span><span class="n">dmriprep_folder</span><span class="p">,</span>
                        <span class="o">**</span><span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;Stanford HARDI&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;PipelineDescription&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;vistasoft&quot;</span><span class="p">},</span>
                           <span class="s2">&quot;GeneratedBy&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;vistasoft&quot;</span><span class="p">}]})</span>
    <span class="n">to_bids_description</span><span class="p">(</span><span class="n">freesurfer_folder</span><span class="p">,</span>
                        <span class="o">**</span><span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;Stanford HARDI&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;PipelineDescription&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;freesurfer&quot;</span><span class="p">},</span>
                           <span class="s2">&quot;GeneratedBy&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;freesurfer&quot;</span><span class="p">}]})</span></div>


<div class="viewcode-block" id="fetch_stanford_hardi_lv1"><a class="viewcode-back" href="../../../reference/api/AFQ/data/fetch/index.html#AFQ.data.fetch.fetch_stanford_hardi_lv1">[docs]</a><span class="n">fetch_stanford_hardi_lv1</span> <span class="o">=</span> <span class="n">_make_reusable_fetcher</span><span class="p">(</span>
    <span class="s2">&quot;fetch_stanford_hardi_lv1&quot;</span><span class="p">,</span>
    <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span>
            <span class="s1">&#39;stanford_hardi&#39;</span><span class="p">,</span>
            <span class="s1">&#39;derivatives/freesurfer/sub-01/ses-01/anat&#39;</span><span class="p">),</span>
    <span class="s1">&#39;https://stacks.stanford.edu/file/druid:ng782rw8378/&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;SUB1_LV1.nii.gz&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;sub-01_ses-01_desc-LV1_anat.nii.gz&quot;</span><span class="p">],</span>
    <span class="n">md5_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;e403c602e53e5491414f86af5f08a913&quot;</span><span class="p">],</span>
    <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Download the LV1 segmentation for the Standord Hardi subject&quot;</span><span class="p">,</span>
    <span class="n">unzip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<span class="n">fetch_hcp_atlas_16_bundles</span> <span class="o">=</span> <span class="n">_make_reusable_fetcher</span><span class="p">(</span>
    <span class="s2">&quot;fetch_hcp_atlas_16_bundles&quot;</span><span class="p">,</span>
    <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span>
            <span class="s1">&#39;hcp_atlas_16_bundles&#39;</span><span class="p">),</span>
    <span class="s1">&#39;https://ndownloader.figshare.com/files/&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;11921522&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;atlas_16_bundles.zip&quot;</span><span class="p">],</span>
    <span class="n">md5_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;b071f3e851f21ba1749c02fc6beb3118&quot;</span><span class="p">],</span>
    <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Download minimal Recobundles atlas&quot;</span><span class="p">,</span>
    <span class="n">unzip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">fetch_hcp_atlas_80_bundles</span> <span class="o">=</span> <span class="n">_make_reusable_fetcher</span><span class="p">(</span>
    <span class="s2">&quot;fetch_hcp_atlas_80_bundles&quot;</span><span class="p">,</span>
    <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span>
            <span class="s1">&#39;hcp_atlas_80_bundles&#39;</span><span class="p">),</span>
    <span class="s1">&#39;https://ndownloader.figshare.com/files/&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;13638644&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;Atlas_80_Bundles.zip&quot;</span><span class="p">],</span>
    <span class="n">md5_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;78331d527a10ec000d4f33bac472e099&quot;</span><span class="p">],</span>
    <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Download 80-bundle Recobundles atlas&quot;</span><span class="p">,</span>
    <span class="n">unzip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">read_hcp_atlas</span><span class="p">(</span><span class="n">n_bundles</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">as_file</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    as_file : bool, optional</span>
<span class="sd">        If True, values are paths to sls. Otherwise, the sl</span>
<span class="sd">        are located and the centroids calculated. Default: False</span>

<span class="sd">    n_bundles : int</span>
<span class="sd">        16 or 80, which selects among the two different</span>
<span class="sd">        atlases:</span>

<span class="sd">        https://figshare.com/articles/Simple_model_bundle_atlas_for_RecoBundles/6483614  # noqa</span>

<span class="sd">        https://figshare.com/articles/Advanced_Atlas_of_80_Bundles_in_MNI_space/7375883  # noqa</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bundle_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">n_bundles</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">fetch_hcp_atlas_16_bundles</span><span class="p">()</span>
        <span class="n">atlas_folder</span> <span class="o">=</span> <span class="s2">&quot;Atlas_in_MNI_Space_16_bundles&quot;</span>
    <span class="k">elif</span> <span class="n">n_bundles</span> <span class="o">==</span> <span class="mi">80</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">fetch_hcp_atlas_80_bundles</span><span class="p">()</span>
        <span class="n">atlas_folder</span> <span class="o">=</span> <span class="s2">&quot;Atlas_80_Bundles&quot;</span>

    <span class="n">whole_brain</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">folder</span><span class="p">,</span>
        <span class="n">atlas_folder</span><span class="p">,</span>
        <span class="s1">&#39;whole_brain&#39;</span><span class="p">,</span>
        <span class="s1">&#39;whole_brain_MNI.trk&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">as_file</span><span class="p">:</span>
        <span class="n">whole_brain</span> <span class="o">=</span> <span class="n">load_tractogram</span><span class="p">(</span>
            <span class="n">whole_brain</span><span class="p">,</span>
            <span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">streamlines</span>

    <span class="n">bundle_dict</span><span class="p">[</span><span class="s1">&#39;whole_brain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">whole_brain</span>
    <span class="n">bundle_files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span>
        <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">folder</span><span class="p">,</span>
            <span class="n">atlas_folder</span><span class="p">,</span>
            <span class="s2">&quot;bundles&quot;</span><span class="p">,</span> <span class="s2">&quot;*.trk&quot;</span><span class="p">))</span>
    <span class="n">centroid_folder</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">folder</span><span class="p">,</span>
        <span class="n">atlas_folder</span><span class="p">,</span>
        <span class="s2">&quot;centroid&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">centroid_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">bundle_file</span> <span class="ow">in</span> <span class="n">bundle_files</span><span class="p">:</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="n">drop_extension</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">bundle_file</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">centroid_file</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">centroid_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bundle</span><span class="si">}</span><span class="s2">.trk&quot;</span><span class="p">)</span>
        <span class="n">bundle_dict</span><span class="p">[</span><span class="n">bundle</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">centroid_file</span><span class="p">):</span>
            <span class="n">bundle_sl</span> <span class="o">=</span> <span class="n">load_tractogram</span><span class="p">(</span>
                <span class="n">bundle_file</span><span class="p">,</span>
                <span class="s1">&#39;same&#39;</span><span class="p">,</span>
                <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">feature</span> <span class="o">=</span> <span class="n">ResampleFeature</span><span class="p">(</span><span class="n">nb_points</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">metric</span> <span class="o">=</span> <span class="n">AveragePointwiseEuclideanMetric</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
            <span class="n">qb</span> <span class="o">=</span> <span class="n">QuickBundles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="p">[</span><span class="n">qb</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">bundle_sl</span><span class="o">.</span><span class="n">streamlines</span><span class="p">)</span><span class="o">.</span><span class="n">centroids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">save_tractogram</span><span class="p">(</span>
                <span class="n">StatefulTractogram</span><span class="p">(</span>
                    <span class="n">cluster</span><span class="p">,</span> <span class="n">bundle_sl</span><span class="p">,</span> <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">),</span>
                <span class="n">centroid_file</span><span class="p">,</span>
                <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">as_file</span><span class="p">:</span>
            <span class="n">bundle_dict</span><span class="p">[</span><span class="n">bundle</span><span class="p">][</span><span class="s1">&#39;sl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_tractogram</span><span class="p">(</span>
                <span class="n">bundle_file</span><span class="p">,</span>
                <span class="s1">&#39;same&#39;</span><span class="p">,</span>
                <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">streamlines</span>
            <span class="n">bundle_dict</span><span class="p">[</span><span class="n">bundle</span><span class="p">][</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_tractogram</span><span class="p">(</span>
                <span class="n">centroid_file</span><span class="p">,</span>
                <span class="s2">&quot;same&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">streamlines</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bundle_dict</span><span class="p">[</span><span class="n">bundle</span><span class="p">][</span><span class="s1">&#39;sl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bundle_file</span>
            <span class="n">bundle_dict</span><span class="p">[</span><span class="n">bundle</span><span class="p">][</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">centroid_file</span>

    <span class="c1"># For some reason, this file-name has a 0 in it, instead of an O:</span>
    <span class="n">bundle_dict</span><span class="p">[</span><span class="s2">&quot;IFOF_R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bundle_dict</span><span class="p">[</span><span class="s2">&quot;IF0F_R&quot;</span><span class="p">]</span>
    <span class="c1"># In the 80-bundle case, there are two files, and both have identical</span>
    <span class="c1"># content, so this is fine:</span>
    <span class="k">del</span> <span class="n">bundle_dict</span><span class="p">[</span><span class="s2">&quot;IF0F_R&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">bundle_dict</span>


<span class="n">fetch_aal_atlas</span> <span class="o">=</span> <span class="n">_make_reusable_fetcher</span><span class="p">(</span>
    <span class="s2">&quot;fetch_aal_atlas&quot;</span><span class="p">,</span>
    <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span>
            <span class="s1">&#39;aal_atlas&#39;</span><span class="p">),</span>
    <span class="s1">&#39;https://ndownloader.figshare.com/files/&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;28416852&quot;</span><span class="p">,</span>
     <span class="s2">&quot;28416855&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;MNI_AAL_AndMore.nii.gz&quot;</span><span class="p">,</span>
     <span class="s2">&quot;MNI_AAL.txt&quot;</span><span class="p">],</span>
    <span class="n">md5_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;69395b75a16f00294a80eb9428bf7855&quot;</span><span class="p">,</span>
              <span class="s2">&quot;59fd3284b17de2fbe411ca1c7afe8c65&quot;</span><span class="p">],</span>
    <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Download the AAL atlas&quot;</span><span class="p">,</span>
    <span class="n">unzip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">read_aal_atlas</span><span class="p">(</span><span class="n">resample_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads the AAL atlas [1]_.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    template : nib.Nifti1Image class instance, optional</span>
<span class="sd">        If provided, this is the template used and AAL atlas should be</span>
<span class="sd">        registered and aligned to this template</span>


<span class="sd">    .. [1] Tzourio-Mazoyer N, Landeau B, Papathanassiou D, Crivello F, Etard O,</span>
<span class="sd">           Delcroix N, Mazoyer B, Joliot M. (2002). Automated anatomical</span>
<span class="sd">           labeling of activations in SPM using a macroscopic anatomical</span>
<span class="sd">           parcellation of the MNI MRI single-subject brain. Neuroimage. 2002;</span>
<span class="sd">           15(1):273-89.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_dict</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">fetch_aal_atlas</span><span class="p">()</span>
    <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">file_dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">):</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">resample_to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
        <span class="n">oo</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">oo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resample</span><span class="p">(</span>
                <span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ii</span><span class="p">],</span>
                <span class="n">resample_to</span><span class="p">,</span>
                <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span>
                <span class="n">resample_to</span><span class="o">.</span><span class="n">affine</span><span class="p">)</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">())</span>
        <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">oo</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                            <span class="n">resample_to</span><span class="o">.</span><span class="n">affine</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_dict</span>


<span class="k">def</span> <span class="nf">_apply_mask</span><span class="p">(</span><span class="n">template_img</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function, gets MNI brain mask and applies it to template_img.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    template_img : nib.Nifti1Image</span>
<span class="sd">        Unmasked template</span>
<span class="sd">    resolution : int, optional</span>
<span class="sd">        Resolution of mask. Default: 1</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Masked template as nib.Nifti1Image</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tflow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MNI152NLin2009cAsym&#39;</span><span class="p">,</span>
                                      <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
                                      <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;brain&#39;</span><span class="p">,</span>
                                      <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;mask&#39;</span><span class="p">)))</span>

    <span class="n">template_data</span> <span class="o">=</span> <span class="n">template_img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
    <span class="n">mask_data</span> <span class="o">=</span> <span class="n">mask_img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">mask_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">template_data</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="n">mask_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span>
            <span class="n">resample</span><span class="p">(</span>
                <span class="n">mask_data</span><span class="p">,</span>
                <span class="n">template_data</span><span class="p">,</span>
                <span class="n">mask_img</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span>
                <span class="n">template_img</span><span class="o">.</span><span class="n">affine</span><span class="p">)</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">(),</span>
            <span class="n">template_img</span><span class="o">.</span><span class="n">affine</span><span class="p">)</span>
        <span class="n">mask_data</span> <span class="o">=</span> <span class="n">mask_img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>

    <span class="n">out_data</span> <span class="o">=</span> <span class="n">template_data</span> <span class="o">*</span> <span class="n">mask_data</span>
    <span class="k">return</span> <span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">out_data</span><span class="p">,</span> <span class="n">template_img</span><span class="o">.</span><span class="n">affine</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">read_mni_template</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;T2w&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Reads the MNI T1w or T2w template</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    resolution : int, optional.</span>
<span class="sd">        Either 1 or 2, the resolution in mm of the voxels. Default: 1.</span>

<span class="sd">    mask : bool, optional</span>
<span class="sd">        Whether to mask the data with a brain-mask before returning the image.</span>
<span class="sd">        Default : True</span>

<span class="sd">    weight: str, optional</span>
<span class="sd">        Which relaxation technique to use.</span>
<span class="sd">        Should be either &quot;T2w&quot; or &quot;T1w&quot;.</span>
<span class="sd">        Default : &quot;T2w&quot;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    nib.Nifti1Image class instance</span>
<span class="sd">    containing masked or unmasked T1w or template.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">template_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tflow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MNI152NLin2009cAsym&#39;</span><span class="p">,</span>
                                          <span class="n">desc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                          <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
                                          <span class="n">suffix</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span>
                                          <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;nii.gz&#39;</span><span class="p">)))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mask</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">template_img</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_apply_mask</span><span class="p">(</span><span class="n">template_img</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>


<span class="n">fetch_biobank_templates</span> <span class="o">=</span> \
    <span class="n">_make_reusable_fetcher</span><span class="p">(</span>
        <span class="s2">&quot;fetch_biobank_templates&quot;</span><span class="p">,</span>
        <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span>
                <span class="s1">&#39;biobank_templates&#39;</span><span class="p">),</span>
        <span class="s2">&quot;http://biobank.ctsu.ox.ac.uk/showcase/showcase/docs/&quot;</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">&quot;bmri_group_means.zip&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;bmri_group_means.zip&quot;</span><span class="p">],</span>
        <span class="n">data_size</span><span class="o">=</span><span class="s2">&quot;1.1 GB&quot;</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Download UK Biobank templates&quot;</span><span class="p">,</span>
        <span class="n">unzip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">read_ukbb_fa_template</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads the UK Biobank FA template</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mask : bool, optional</span>
<span class="sd">        Whether to mask the data with a brain-mask before returning the image.</span>
<span class="sd">        Default : True</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    nib.Nifti1Image class instance containing the FA template.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fa_folder</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">afq_home</span><span class="p">,</span>
        <span class="s1">&#39;biobank_templates&#39;</span><span class="p">,</span>
        <span class="s1">&#39;UKBiobank_BrainImaging_GroupMeanTemplates&#39;</span>
    <span class="p">)</span>
    <span class="n">fa_path</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">fa_folder</span><span class="p">,</span>
        <span class="s1">&#39;dti_FA.nii.gz&#39;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fa_path</span><span class="p">):</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;AFQ&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Downloading brain MRI group mean statistics from UK Biobank. &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;This download is approximately 1.1 GB. &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;It is currently necessary to access the FA template.&quot;</span><span class="p">)</span>

        <span class="n">files</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">fetch_biobank_templates</span><span class="p">()</span>

        <span class="c1"># remove zip</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>

        <span class="c1"># remove non-FA related directories</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">fa_folder</span><span class="p">):</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fa_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">full_path</span> <span class="o">!=</span> <span class="n">fa_path</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">full_path</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>

    <span class="n">template_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fa_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">mask</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">template_img</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_apply_mask</span><span class="p">(</span><span class="n">template_img</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">fetch_hcp</span><span class="p">(</span><span class="n">subjects</span><span class="p">,</span>
              <span class="n">hcp_bucket</span><span class="o">=</span><span class="s1">&#39;hcp-openaccess&#39;</span><span class="p">,</span>
              <span class="n">profile_name</span><span class="o">=</span><span class="s2">&quot;hcp&quot;</span><span class="p">,</span>
              <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">study</span><span class="o">=</span><span class="s1">&#39;HCP_1200&#39;</span><span class="p">,</span>
              <span class="n">aws_access_key_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch HCP diffusion data and arrange it in a manner that resembles the</span>
<span class="sd">    BIDS [1]_ specification.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    subjects : list</span>
<span class="sd">        Each item is an integer, identifying one of the HCP subjects</span>
<span class="sd">    hcp_bucket : string, optional</span>
<span class="sd">        The name of the HCP S3 bucket. Default: &quot;hcp-openaccess&quot;</span>
<span class="sd">    profile_name : string, optional</span>
<span class="sd">        The name of the AWS profile used for access. Default: &quot;hcp&quot;</span>
<span class="sd">    path : string, optional</span>
<span class="sd">        Path to save files into. Default: &#39;~/AFQ_data&#39;</span>
<span class="sd">    study : string, optional</span>
<span class="sd">        Which HCP study to grab. Default: &#39;HCP_1200&#39;</span>
<span class="sd">    aws_access_key_id : string, optional</span>
<span class="sd">        AWS credentials to HCP AWS S3. Will only be used if `profile_name` is</span>
<span class="sd">        set to False.</span>
<span class="sd">    aws_secret_access_key : string, optional</span>
<span class="sd">        AWS credentials to HCP AWS S3. Will only be used if `profile_name` is</span>
<span class="sd">        set to False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict with remote and local names of these files,</span>
<span class="sd">    path to BIDS derivative dataset</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    To use this function with its default setting, you need to have a</span>
<span class="sd">    file &#39;~/.aws/credentials&#39;, that includes a section:</span>

<span class="sd">    [hcp]</span>
<span class="sd">    AWS_ACCESS_KEY_ID=XXXXXXXXXXXXXXXX</span>
<span class="sd">    AWS_SECRET_ACCESS_KEY=XXXXXXXXXXXXXXXX</span>

<span class="sd">    The keys are credentials that you can get from HCP</span>
<span class="sd">    (see https://wiki.humanconnectome.org/display/PublicData/How+To+Connect+to+Connectome+Data+via+AWS)  # noqa</span>

<span class="sd">    Local filenames are changed to match our expected conventions.</span>

<span class="sd">    .. [1] Gorgolewski et al. (2016). The brain imaging data structure,</span>
<span class="sd">           a format for organizing and describing outputs of neuroimaging</span>
<span class="sd">           experiments. Scientific Data, 3::160044. DOI: 10.1038/sdata.2016.44.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">profile_name</span><span class="p">:</span>
        <span class="n">boto3</span><span class="o">.</span><span class="n">setup_default_session</span><span class="p">(</span><span class="n">profile_name</span><span class="o">=</span><span class="n">profile_name</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">aws_access_key_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">aws_secret_access_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">boto3</span><span class="o">.</span><span class="n">setup_default_session</span><span class="p">(</span>
            <span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">aws_access_key_id</span><span class="p">,</span>
            <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">aws_secret_access_key</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide either a `profile_name` or &quot;</span><span class="p">,</span>
                         <span class="s2">&quot;both `aws_access_key_id` and &quot;</span><span class="p">,</span>
                         <span class="s2">&quot;`aws_secret_access_key` as input to &#39;fetch_hcp&#39;&quot;</span><span class="p">)</span>

    <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
    <span class="n">bucket</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">hcp_bucket</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">afq_home</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">afq_home</span><span class="p">)</span>
        <span class="n">my_path</span> <span class="o">=</span> <span class="n">afq_home</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">my_path</span> <span class="o">=</span> <span class="n">path</span>

    <span class="n">base_dir</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">my_path</span><span class="p">,</span> <span class="n">study</span><span class="p">,</span> <span class="s1">&#39;derivatives&#39;</span><span class="p">,</span> <span class="s1">&#39;dmriprep&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">base_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">data_files</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">:</span>
        <span class="c1"># We make a single session folder per subject for this case, because</span>
        <span class="c1"># AFQ api expects session structure:</span>
        <span class="n">sub_dir</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;sub-</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sess_dir</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sub_dir</span><span class="p">,</span> <span class="s2">&quot;ses-01&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">sub_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sess_dir</span><span class="p">,</span> <span class="s1">&#39;dwi&#39;</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sess_dir</span><span class="p">,</span> <span class="s1">&#39;anat&#39;</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">data_files</span><span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sess_dir</span><span class="p">,</span> <span class="s1">&#39;dwi&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;sub-</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s1">_dwi.bval&#39;</span><span class="p">)]</span> <span class="o">=</span>\
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s1">/T1w/Diffusion/bvals&#39;</span>
        <span class="n">data_files</span><span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sess_dir</span><span class="p">,</span> <span class="s1">&#39;dwi&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;sub-</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s1">_dwi.bvec&#39;</span><span class="p">)]</span> <span class="o">=</span>\
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s1">/T1w/Diffusion/bvecs&#39;</span>
        <span class="n">data_files</span><span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sess_dir</span><span class="p">,</span> <span class="s1">&#39;dwi&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;sub-</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s1">_dwi.nii.gz&#39;</span><span class="p">)]</span> <span class="o">=</span>\
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s1">/T1w/Diffusion/data.nii.gz&#39;</span>
        <span class="n">data_files</span><span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sess_dir</span><span class="p">,</span> <span class="s1">&#39;anat&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;sub-</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s1">_T1w.nii.gz&#39;</span><span class="p">)]</span> <span class="o">=</span>\
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s1">/T1w/T1w_acpc_dc.nii.gz&#39;</span>
        <span class="n">data_files</span><span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sess_dir</span><span class="p">,</span> <span class="s1">&#39;anat&#39;</span><span class="p">,</span>
                           <span class="sa">f</span><span class="s1">&#39;sub-</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s1">_aparc+aseg_seg.nii.gz&#39;</span><span class="p">)]</span> <span class="o">=</span>\
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s1">/T1w/aparc+aseg.nii.gz&#39;</span>

    <span class="n">download_files</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data_files</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
            <span class="n">download_files</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_files</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">download_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">download_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">download_files</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">bucket</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">data_files</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">k</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Create the BIDS dataset description file text</span>
    <span class="n">hcp_acknowledgements</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Data were provided by the Human Connectome Project, WU-Minn Consortium (Principal Investigators: David Van Essen and Kamil Ugurbil; 1U54MH091657) funded by the 16 NIH Institutes and Centers that support the NIH Blueprint for Neuroscience Research; and by the McDonnell Center for Systems Neuroscience at Washington University.&quot;&quot;&quot;</span><span class="p">,</span>  <span class="c1"># noqa</span>
    <span class="n">to_bids_description</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">my_path</span><span class="p">,</span> <span class="n">study</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">study</span><span class="p">,</span>
                           <span class="s2">&quot;Acknowledgements&quot;</span><span class="p">:</span> <span class="n">hcp_acknowledgements</span><span class="p">,</span>
                           <span class="s2">&quot;Subjects&quot;</span><span class="p">:</span> <span class="n">subjects</span><span class="p">})</span>

    <span class="c1"># Create the BIDS derivatives description file text</span>
    <span class="n">to_bids_description</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span>
                        <span class="o">**</span><span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">study</span><span class="p">,</span>
                           <span class="s2">&quot;Acknowledgements&quot;</span><span class="p">:</span> <span class="n">hcp_acknowledgements</span><span class="p">,</span>
                           <span class="s2">&quot;PipelineDescription&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="s1">&#39;dmriprep&#39;</span><span class="p">},</span>
                           <span class="s2">&quot;GeneratedBy&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="s1">&#39;dmriprep&#39;</span><span class="p">}]})</span>

    <span class="k">return</span> <span class="n">data_files</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">my_path</span><span class="p">,</span> <span class="n">study</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">fetch_hbn_preproc</span><span class="p">(</span><span class="n">subjects</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetches data from the Healthy Brain Network POD2 study [1, 2]_.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    subjects : list</span>
<span class="sd">        Identifiers of the subjects to download.</span>
<span class="sd">        For example: [&quot;NDARAA112DMH&quot;, &quot;NDARAA117NEJ&quot;].</span>
<span class="sd">    path : string, optional</span>
<span class="sd">        Path to save files into. Default: &#39;~/AFQ_data&#39;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict with remote and local names of these files,</span>
<span class="sd">    path to BIDS derivative dataset</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    .. [1] Alexander LM, Escalera J, Ai L, et al. An open resource for</span>
<span class="sd">        transdiagnostic research in pediatric mental health and learning</span>
<span class="sd">        disorders. Sci Data. 2017;4:170181.</span>

<span class="sd">    .. [2] Richie-Halford A, Cieslak M, Ai L, et al. An analysis-ready and</span>
<span class="sd">        quality controlled resource for pediatric brain white-matter research.</span>
<span class="sd">        Scientific Data. 2022;9(1):1-27.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Anonymous access:</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">Config</span><span class="p">(</span><span class="n">signature_version</span><span class="o">=</span><span class="n">UNSIGNED</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">afq_home</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">afq_home</span><span class="p">)</span>
        <span class="n">my_path</span> <span class="o">=</span> <span class="n">afq_home</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">my_path</span> <span class="o">=</span> <span class="n">path</span>

    <span class="n">base_dir</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">my_path</span><span class="p">,</span> <span class="s2">&quot;HBN&quot;</span><span class="p">,</span> <span class="s1">&#39;derivatives&#39;</span><span class="p">,</span> <span class="s1">&#39;qsiprep&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">base_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">data_files</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">:</span>
        <span class="n">initial_query</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span>
            <span class="n">Bucket</span><span class="o">=</span><span class="s2">&quot;fcp-indi&quot;</span><span class="p">,</span>
            <span class="n">Prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;data/Projects/HBN/BIDS_curated/sub-</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>
        <span class="n">ses</span> <span class="o">=</span> <span class="n">initial_query</span><span class="p">[</span><span class="s1">&#39;Contents&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Key&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span>
            <span class="n">Bucket</span><span class="o">=</span><span class="s2">&quot;fcp-indi&quot;</span><span class="p">,</span>
            <span class="n">Prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;data/Projects/HBN/BIDS_curated/derivatives/qsiprep/sub-</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>  <span class="c1"># noqa</span>
        <span class="n">file_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">kk</span><span class="p">[</span><span class="s2">&quot;Key&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;Contents&quot;</span><span class="p">]]</span>
        <span class="n">sub_dir</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;sub-</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ses_dir</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sub_dir</span><span class="p">,</span> <span class="n">ses</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">sub_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sub_dir</span><span class="p">,</span> <span class="s1">&#39;anat&#39;</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sub_dir</span><span class="p">,</span> <span class="s1">&#39;figures&#39;</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ses_dir</span><span class="p">,</span> <span class="s1">&#39;dwi&#39;</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ses_dir</span><span class="p">,</span> <span class="s1">&#39;anat&#39;</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
            <span class="n">full</span> <span class="o">=</span> <span class="n">remote</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Projects&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/BIDS_curated&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">local</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">my_path</span><span class="p">,</span> <span class="n">full</span><span class="p">)</span>
            <span class="n">data_files</span><span class="p">[</span><span class="n">local</span><span class="p">]</span> <span class="o">=</span> <span class="n">remote</span>

    <span class="n">download_files</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data_files</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
            <span class="n">download_files</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_files</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">download_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">download_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">download_files</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">client</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="s2">&quot;fcp-indi&quot;</span><span class="p">,</span> <span class="n">download_files</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">k</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Create the BIDS dataset description file text</span>
    <span class="n">hbn_acknowledgements</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;XXX&quot;&quot;&quot;</span><span class="p">,</span>  <span class="c1"># noqa</span>
    <span class="n">to_bids_description</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">my_path</span><span class="p">,</span> <span class="s2">&quot;HBN&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;HBN&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;Acknowledgements&quot;</span><span class="p">:</span> <span class="n">hbn_acknowledgements</span><span class="p">,</span>
                           <span class="s2">&quot;Subjects&quot;</span><span class="p">:</span> <span class="n">subjects</span><span class="p">})</span>

    <span class="c1"># Create the BIDS derivatives description file text</span>
    <span class="n">to_bids_description</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span>
                        <span class="o">**</span><span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;HBN&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;Acknowledgements&quot;</span><span class="p">:</span> <span class="n">hbn_acknowledgements</span><span class="p">,</span>
                           <span class="s2">&quot;PipelineDescription&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="s1">&#39;qsiprep&#39;</span><span class="p">},</span>
                           <span class="s2">&quot;GeneratedBy&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="s1">&#39;qsiprep&#39;</span><span class="p">}]})</span>

    <span class="k">return</span> <span class="n">data_files</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">my_path</span><span class="p">,</span> <span class="s2">&quot;HBN&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">fetch_hbn_afq</span><span class="p">(</span><span class="n">subjects</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetches AFQ derivatives for Healthy Brain Network POD2 study [1, 2]_.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    subjects : list</span>
<span class="sd">        Identifiers of the subjects to download.</span>
<span class="sd">        For example: [&quot;NDARAA112DMH&quot;, &quot;NDARAA117NEJ&quot;].</span>
<span class="sd">    path : string, optional</span>
<span class="sd">        Path to save files into. Default: &#39;~/AFQ_data&#39;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict with remote and local names of these files,</span>
<span class="sd">    path to BIDS derivative dataset</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    .. [1] Alexander LM, Escalera J, Ai L, et al. An open resource for</span>
<span class="sd">        transdiagnostic research in pediatric mental health and learning</span>
<span class="sd">        disorders. Sci Data. 2017;4:170181.</span>

<span class="sd">    .. [2] Richie-Halford A, Cieslak M, Ai L, et al. An analysis-ready and</span>
<span class="sd">        quality controlled resource for pediatric brain white-matter research.</span>
<span class="sd">        Scientific Data. 2022;9(1):1-27.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Anonymous access:</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">Config</span><span class="p">(</span><span class="n">signature_version</span><span class="o">=</span><span class="n">UNSIGNED</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">afq_home</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">afq_home</span><span class="p">)</span>
        <span class="n">my_path</span> <span class="o">=</span> <span class="n">afq_home</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">my_path</span> <span class="o">=</span> <span class="n">path</span>

    <span class="n">base_dir</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">my_path</span><span class="p">,</span> <span class="s2">&quot;HBN&quot;</span><span class="p">,</span> <span class="s1">&#39;derivatives&#39;</span><span class="p">,</span> <span class="s1">&#39;afq&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">base_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">data_files</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">:</span>
        <span class="n">initial_query</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span>
            <span class="n">Bucket</span><span class="o">=</span><span class="s2">&quot;fcp-indi&quot;</span><span class="p">,</span>
            <span class="n">Prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;data/Projects/HBN/BIDS_curated/sub-</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>
        <span class="n">ses</span> <span class="o">=</span> <span class="n">initial_query</span><span class="p">[</span><span class="s1">&#39;Contents&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Key&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span>
            <span class="n">Bucket</span><span class="o">=</span><span class="s2">&quot;fcp-indi&quot;</span><span class="p">,</span>
            <span class="n">Prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;data/Projects/HBN/BIDS_curated/derivatives/afq/sub-</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>  <span class="c1"># noqa</span>
        <span class="n">file_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">kk</span><span class="p">[</span><span class="s2">&quot;Key&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;Contents&quot;</span><span class="p">]]</span>
        <span class="n">sub_dir</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;sub-</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ses_dir</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sub_dir</span><span class="p">,</span> <span class="n">ses</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">deriv_dir</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;bundles&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;clean_bundles&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;ROIs&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;tract_profile_plots&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;viz_bundles&quot;</span><span class="p">]:</span>
            <span class="n">this_deriv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ses_dir</span><span class="p">,</span> <span class="n">deriv_dir</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">this_deriv</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">this_deriv</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
            <span class="n">full</span> <span class="o">=</span> <span class="n">remote</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Projects&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/BIDS_curated&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">local</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">afq_home</span><span class="p">,</span> <span class="n">full</span><span class="p">)</span>
            <span class="n">data_files</span><span class="p">[</span><span class="n">local</span><span class="p">]</span> <span class="o">=</span> <span class="n">remote</span>

    <span class="n">download_files</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data_files</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
            <span class="n">download_files</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_files</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">download_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">download_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">download_files</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">client</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="s2">&quot;fcp-indi&quot;</span><span class="p">,</span> <span class="n">download_files</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">k</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Create the BIDS dataset description file text</span>
    <span class="n">hbn_acknowledgements</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;XXX&quot;&quot;&quot;</span><span class="p">,</span>  <span class="c1"># noqa</span>
    <span class="n">to_bids_description</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">my_path</span><span class="p">,</span> <span class="s2">&quot;HBN&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;HBN&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;Acknowledgements&quot;</span><span class="p">:</span> <span class="n">hbn_acknowledgements</span><span class="p">,</span>
                           <span class="s2">&quot;Subjects&quot;</span><span class="p">:</span> <span class="n">subjects</span><span class="p">})</span>

    <span class="c1"># Create the BIDS derivatives description file text</span>
    <span class="n">to_bids_description</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span>
                        <span class="o">**</span><span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;HBN&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;PipelineDescription&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="s1">&#39;afq&#39;</span><span class="p">},</span>
                           <span class="s2">&quot;GeneratedBy&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="s1">&#39;afq&#39;</span><span class="p">}]})</span>

    <span class="k">return</span> <span class="n">data_files</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">my_path</span><span class="p">,</span> <span class="s2">&quot;HBN&quot;</span><span class="p">)</span>
</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>


  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright 2018--, The pyAFQ Contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.1.
</p></div>
      
    </div>
  
</div>

  </footer>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-156363454-2");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>