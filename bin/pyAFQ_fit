#!/usr/bin/env python

from argparse import ArgumentParser

description = """Fit a DKI or DTI model, save files with derived maps"""
parser = ArgumentParser(description=description)

parser.add_argument("-t", "--model_type", metavar="model_type", required=True,
        choices=["dki", "dti"], help="fitting method ('dki' or 'dti')")

parser.add_argument("-d", "--dwi", nargs="+", required=True,
        help="DWI file or list of DWI files (separated by spaces)")

parser.add_argument("-l", "--bval", nargs="+", required=True,
        help="""b-value file or list of b-value files
                (separated by spaces)""")

parser.add_argument("-c", "--bvec", nargs="+", required=True,
        help="""b-vector file or list of b-vector files
                (separated by spaces)""")

parser.add_argument("-o", "--out_dir",
        help="""full path to directory for files to be saved 
                (will be created if it doesn't exist)""")

parser.add_argument("-m", "--mask",
        help="""binary mask, set to True or 1 in voxels to be processed.
                default: Process all voxels.""")

parser.add_argument('-b', '--b0_threshold', help="b0 threshold",
        default=0, type=float)

args = parser.parse_args()

if args.model_type == "dki":
    from AFQ import dki
    fit = dki.fit_dki
else:
    from AFQ import dti
    fit = dti.fit_dti

fit(args.dwi, args.bval, args.bvec, mask=args.mask,
        out_dir=args.out_dir, b0_threshold=args.b0_threshold)
